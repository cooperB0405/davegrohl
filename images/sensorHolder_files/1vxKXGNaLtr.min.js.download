!function(a){"use strict";var b={dir:function(){},error:function(){},group:function(){},groupCollapsed:function(){},groupEnd:function(){},info:function(){},log:function(){},time:function(){},timeEnd:function(){},trace:function(){},warn:function(){}},c=function(a,c){function d(b){var c=a.getVariable(["execution","scale"]);if(c&&Array.isArray(c)&&3===c.length){var d=0;d=c[0]>d?c[0]:d,d=c[1]>d?c[1]:d,d=c[2]>d?c[2]:d,0==d&&(d=1),d>100&&(d=100),1e-4>d&&(d=1e-4),b/=d}return b}function e(){var b=a.getVariable(["execution","tessTolerance"]);return void 0===b&&(b=d(.05),a.setVariable(["execution","tessTolerance"],b)),b}function f(a,b){return Math.abs(a-b)<1e-6}function g(a,b){"function"==typeof a?(a.prototype.toString=function(){return b},a.toString=function(){return""},a.toLocaleString=function(){return""},a.toValue=function(){return""}):"object"==typeof a&&(a.toString=function(){return b})}function h(a,b,c,d){d=d||function(){},Array.isArray(c)||(c=[c]);var e=[];b._impl._isWindingOrderCorrect()||e.push("source mesh");for(var f=0;f<c.length;f++)c[f]instanceof R||hb.panic(z),c[f]._impl._isWindingOrderCorrect()||e.push("meshes["+f+"]");if(e.length>0){var g="Inward pointing normals detected by right hand rule on meshes ("+e.join(",")+").";hb.warning(g)}for(var h=i(b),j,l=0;l<c.length;l++)j=i(c[l]),h=h[a](j);var m=k(h);m=V.repair(m,[U.NONMANIFOLD_EDGES]),d(m)}function i(a){if(void 0!==a.attributes.bsp&&void 0!==a.attributes.bsp.data)return a.attributes.bsp.data;void 0===a.attributes.bsp&&a.change.bind(l);var b=j(a),c={data:b};return a.attributes.bsp=c,b}function j(a){function b(a,b){var c=[e[3*a],e[3*a+1],e[3*a+2]];return new F.Vertex(c,b)}function c(a){var b=3*d[3*a],c=3*d[3*a+1],f=3*d[3*a+2],g=[e[b],e[b+1],e[b+2]],h=[e[c],e[c+1],e[c+2]],i=[e[f],e[f+1],e[f+2]],j=new F.Vector([h[0]-g[0],h[1]-g[1],h[2]-g[2]]),k=new F.Vector([i[0]-g[0],i[1]-g[1],i[2]-g[2]]),l=j.cross(k).unit();return l}for(var d=a._impl._triangles,e=a._impl._vertices,f=d.length/3,g=[],h,i=0;f>i;i++)h=c(i),g.push(new F.Polygon([b(d[3*i],h),b(d[3*i+1],h),b(d[3*i+2],h)]));var j=F.fromPolygons(g);return j}function k(a){function b(a){var b=a.pos;return[b.x,b.y,b.z]}for(var c=a.toPolygons(),d=new R,e,f,g=0,h=c.length;h>g;g++){e=c[g].vertices,f=e[0];for(var i=1,j=e.length-1;j>i;i++)d.triangle(b(f),b(e[i]),b(e[i+1]))}var k={data:a};return d.attributes.bsp=k,d}function l(a){if(a.data instanceof R){var b=a.data;delete b.attributes.bsp.data}}function m(a){if(a.data instanceof R){var b=a.data;delete b.attributes.edges.data}}function n(a){if(a.data instanceof R){var b=a.data;delete b.attributes.bounds.data}}function o(a){if(a.data instanceof R){var b=a.data;delete b.attributes.boundaries.data}}function p(){if(!lb){var b=a.module("tess");lb=b?b.Tess2:C.Tess2}return lb}function q(a,b){a&&(this._type=a,this._listeners=[],b&&(this._target=b))}function r(){this._type=void 0,this._target=void 0,this._data=void 0,this._bubbles=!0,this._cancelable=!0,this._timeStamp=new Date,this._originalEvent=void 0,Object.defineProperty(this,"target",{get:function(){return this._target},enumerable:!0}),Object.defineProperty(this,"type",{get:function(){return this._type},enumerable:!0}),Object.defineProperty(this,"data",{get:function(){return this._data},enumerable:!0}),Object.defineProperty(this,"bubbles",{get:function(){return this._bubbles},enumerable:!0}),Object.defineProperty(this,"cancelable",{get:function(){return this._cancelable},enumerable:!0}),Object.defineProperty(this,"timestamp",{get:function(){return this._timeStamp},enumerable:!0}),Object.defineProperty(this,"originalEvent",{get:function(){return this._originalEvent},enumerable:!0})}function s(a){var b=["parameters","presets","evaluate","preview","validate","configuration","randomize"];D.call(this,a,b)}function t(a){var b=["parameters","presets","evaluate","validate","configuration","randomize","shape"];D.call(this,a,b)}function u(a){var b=["parameters","evaluate"];D.call(this,a,b)}function v(a,b){this._localToParent=a,this._mesh=b}function w(a,b){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,value:new v(a,b)})}var x=a.module("libxmljs"),y={exports:{}};c&&(c.name="Autodesk Creative Platform Core",c.description="A broad and deep collection of 2D and 3D capabilities.",c.resources=[{id:"5HOLk65hYHM",name:"coordinate-system.png"},{id:"aqswKA2Js3T",name:"parameters.png"},{id:"1Ljg7qh9Htg",name:"cluster.png"},{id:"4QkaJCDf4Nr",name:"heart-from-canvas-flipped.png"},{id:"68mj4nuVDoF",name:"heart-from-canvas.png"},{id:"2vFXsCHSe8E",name:"customshape-category.png"},{id:"37BkpbF00y8",name:"cube-scripteditor.png"},{id:"hQf8B2vTnJl",name:"cube-twisted.png"},{id:"gWtIZlhXWAG",name:"cube.png"},{id:"finmSeq29y0",name:"customshape-scripteditor.png"},{id:"kXvMrBkvNoO",name:"dodecahedron-construction.png"},{id:"dTpcHUm02yH",name:"dodecahedron-debug-lines.png"},{id:"l3ErqZsE910",name:"icosahedron-scripteditor.png"},{id:"f6qkzuAn2y6",name:"matrix2.gif"},{id:"6EbpqJbk3mZ",name:"matrix2elements.gif"},{id:"jLuUMPvxtvG",name:"matrix2rotation.gif"},{id:"honrGXc4E23",name:"matrix3.gif"},{id:"cW9G5w4CcBC",name:"matrix3elements.gif"},{id:"fL2nQccUud5",name:"octahedron.png"},{id:"dAXPZiN9Pzy",name:"platonic-family-portrait.png"},{id:"9zV30z4SvN9",name:"platonics-2rows.png"},{id:"4Ah9qJ8FCt8",name:"pythagorean.gif"},{id:"859QAaOn3Kd",name:"scripteditor-examples-menu.png"},{id:"g7MbBXP3cDP",name:"sphere-lod1.png"},{id:"2gKfcIjNPha",name:"tetrahedron-editor-params.png"},{id:"cM4B529Vgm2",name:"tetrahedron-params.png"},{id:"5W1bX8Vy3GB",name:"tetrahedron.png"},{id:"bTp5dwuGwii",name:"bridge_boundaries_origin.png"},{id:"khlYlzcmmMu",name:"bridge_boundaries_result.png"},{id:"0iySnPeGQBZ",name:"debug_triangles.png"}]),!function(a){function b(){this.next=null,this.prev=null,this.anEdge=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0,this.n=0,this.idx=0}function c(){this.next=null,this.prev=null,this.anEdge=null,this.trail=null,this.n=0,this.marked=!1,this.inside=!1}function d(a){this.next=null,this.Sym=null,this.Onext=null,this.Lnext=null,this.Org=null,this.Lface=null,this.activeRegion=null,this.winding=0,this.side=a}function e(){var a=new b,e=new c,f=new d(0),g=new d(1);a.next=a.prev=a,a.anEdge=null,e.next=e.prev=e,e.anEdge=null,e.trail=null,e.marked=!1,e.inside=!1,f.next=f,f.Sym=g,f.Onext=null,f.Lnext=null,f.Org=null,f.Lface=null,f.winding=0,f.activeRegion=null,g.next=g,g.Sym=f,g.Onext=null,g.Lnext=null,g.Org=null,g.Lface=null,g.winding=0,g.activeRegion=null,this.vHead=a,this.fHead=e,this.eHead=f,this.eHeadSym=g}function f(){this.key=null,this.next=null,this.prev=null}function g(a,b){this.head=new f,this.head.next=this.head,this.head.prev=this.head,this.frame=a,this.leq=b}function h(){this.handle=null}function i(){this.key=null,this.node=null}function j(a,b){this.size=0,this.max=a,this.nodes=[],this.nodes.length=a+1;for(var c=0;c<this.nodes.length;c++)this.nodes[c]=new h;this.handles=[],this.handles.length=a+1;for(var c=0;c<this.handles.length;c++)this.handles[c]=new i;this.initialized=!1,this.freeList=0,this.leq=b,this.nodes[1].handle=1,this.handles[1].key=null}function k(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1}function l(){this.mesh=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.bmin=[0,0],this.bmax=[0,0],this.windingRule=m.WINDING_ODD,this.dict=null,this.pq=null,this.event=null,this.vertexIndexCounter=0,this.vertices=[],this.vertexIndices=[],this.vertexCount=0,this.elements=[],this.elementCount=0}var m={};a.Tess2=m,m.WINDING_ODD=0,m.WINDING_NONZERO=1,m.WINDING_POSITIVE=2,m.WINDING_NEGATIVE=3,m.WINDING_ABS_GEQ_TWO=4,m.POLYGONS=0,m.CONNECTED_POLYGONS=1,m.BOUNDARY_CONTOURS=2,m.tesselate=function(a){for(var b=a.debug||!1,c=new l,d=0;d<a.contours.length;d++)c.addContour(a.vertexSize||2,a.contours[d]);return c.tesselate(a.windingRule||m.WINDING_ODD,a.elementType||m.POLYGONS,a.polySize||3,a.vertexSize||2,a.normal||[0,0,1]),{vertices:c.vertices,vertexIndices:c.vertexIndices,vertexCount:c.vertexCount,elements:c.elements,elementCount:c.elementCount,mesh:b?c.mesh:void 0}};var n=function(a){if(!a)throw"Assertion Failed!"};d.prototype={get Rface(){return this.Sym.Lface},set Rface(a){this.Sym.Lface=a},get Dst(){return this.Sym.Org},set Dst(a){this.Sym.Org=a},get Oprev(){return this.Sym.Lnext},set Oprev(a){this.Sym.Lnext=a},get Lprev(){return this.Onext.Sym},set Lprev(a){this.Onext.Sym=a},get Dprev(){return this.Lnext.Sym},set Dprev(a){this.Lnext.Sym=a},get Rprev(){return this.Sym.Onext},set Rprev(a){this.Sym.Onext=a},get Dnext(){return this.Sym.Onext.Sym},set Dnext(a){this.Sym.Onext.Sym=a},get Rnext(){return this.Sym.Lnext.Sym},set Rnext(a){this.Sym.Lnext.Sym=a}},e.prototype={makeEdge_:function(a){var b=new d(0),c=new d(1);a.Sym.side<a.side&&(a=a.Sym);var e=a.Sym.next;return c.next=e,e.Sym.next=b,b.next=a,a.Sym.next=c,b.Sym=c,b.Onext=b,b.Lnext=c,b.Org=null,b.Lface=null,b.winding=0,b.activeRegion=null,c.Sym=b,c.Onext=c,c.Lnext=b,c.Org=null,c.Lface=null,c.winding=0,c.activeRegion=null,b},splice_:function(a,b){var c=a.Onext,d=b.Onext;c.Sym.Lnext=b,d.Sym.Lnext=a,a.Onext=d,b.Onext=c},makeVertex_:function(a,b,c){var d=a;n(null!==d);var e=c.prev;d.prev=e,e.next=d,d.next=c,c.prev=d,d.anEdge=b;var f=b;do f.Org=d,f=f.Onext;while(f!==b)},makeFace_:function(a,b,c){var d=a;n(null!==d);var e=c.prev;d.prev=e,e.next=d,d.next=c,c.prev=d,d.anEdge=b,d.trail=null,d.marked=!1,d.inside=c.inside;var f=b;do f.Lface=d,f=f.Lnext;while(f!==b)},killEdge_:function(a){a.Sym.side<a.side&&(a=a.Sym);var b=a.next,c=a.Sym.next;b.Sym.next=c,c.Sym.next=b},killVertex_:function(a,b){var c=a.anEdge,d=c;do d.Org=b,d=d.Onext;while(d!==c);var e=a.prev,f=a.next;f.prev=e,e.next=f},killFace_:function(a,b){var c=a.anEdge,d=c;do d.Lface=b,d=d.Lnext;while(d!==c);var e=a.prev,f=a.next;f.prev=e,e.next=f},makeEdge:function(){var a=new b,d=new b,e=new c,f=this.makeEdge_(this.eHead);return this.makeVertex_(a,f,this.vHead),this.makeVertex_(d,f.Sym,this.vHead),this.makeFace_(e,f,this.fHead),f},splice:function(a,d){var e=!1,f=!1;if(a!==d){if(d.Org!==a.Org&&(f=!0,this.killVertex_(d.Org,a.Org)),d.Lface!==a.Lface&&(e=!0,this.killFace_(d.Lface,a.Lface)),this.splice_(d,a),!f){var g=new b;this.makeVertex_(g,d,a.Org),a.Org.anEdge=a}if(!e){var h=new c;this.makeFace_(h,d,a.Lface),a.Lface.anEdge=a}}},"delete":function(a){var b=a.Sym,d=!1;if(a.Lface!==a.Rface&&(d=!0,this.killFace_(a.Lface,a.Rface)),a.Onext===a)this.killVertex_(a.Org,null);else if(a.Rface.anEdge=a.Oprev,a.Org.anEdge=a.Onext,this.splice_(a,a.Oprev),!d){var e=new c;this.makeFace_(e,a,a.Lface)}b.Onext===b?(this.killVertex_(b.Org,null),this.killFace_(b.Lface,null)):(a.Lface.anEdge=b.Oprev,b.Org.anEdge=b.Onext,this.splice_(b,b.Oprev)),this.killEdge_(a)},addEdgeVertex:function(a){var c=this.makeEdge_(a),d=c.Sym;this.splice_(c,a.Lnext),c.Org=a.Dst;var e=new b;return this.makeVertex_(e,d,c.Org),c.Lface=d.Lface=a.Lface,c},splitEdge:function(a){var b=this.addEdgeVertex(a),c=b.Sym;return this.splice_(a.Sym,a.Sym.Oprev),this.splice_(a.Sym,c),a.Dst=c.Org,c.Dst.anEdge=c.Sym,c.Rface=a.Rface,c.winding=a.winding,c.Sym.winding=a.Sym.winding,c},connect:function(a,b){var d=!1,e=this.makeEdge_(a),f=e.Sym;if(b.Lface!==a.Lface&&(d=!0,this.killFace_(b.Lface,a.Lface)),this.splice_(e,a.Lnext),this.splice_(f,b),e.Org=a.Dst,f.Org=b.Org,e.Lface=f.Lface=a.Lface,a.Lface.anEdge=f,!d){var g=new c;this.makeFace_(g,e,a.Lface)}return e},zapFace:function(a){var b,c,d,e,f,g=a.anEdge;c=g.Lnext;do b=c,c=b.Lnext,b.Lface=null,null===b.Rface&&(b.Onext===b?this.killVertex_(b.Org,null):(b.Org.anEdge=b.Onext,this.splice_(b,b.Oprev)),d=b.Sym,d.Onext===d?this.killVertex_(d.Org,null):(d.Org.anEdge=d.Onext,this.splice_(d,d.Oprev)),this.killEdge_(b));while(b!=g);e=a.prev,f=a.next,f.prev=e,e.next=f},countFaceVerts_:function(a){var b=a.anEdge,c=0;do c++,b=b.Lnext;while(b!==a.anEdge);return c},mergeConvexFaces:function(a){var b,c,d,e,f,g,h;for(b=this.fHead.next;b!==this.fHead;b=b.next)if(b.inside)for(c=b.anEdge,f=c.Org;d=c.Lnext,e=c.Sym,e&&e.Lface&&e.Lface.inside&&(g=this.countFaceVerts_(b),h=this.countFaceVerts_(e.Lface),a>=g+h-2&&o.vertCCW(c.Lprev.Org,c.Org,e.Lnext.Lnext.Org)&&o.vertCCW(e.Lprev.Org,e.Org,c.Lnext.Lnext.Org)&&(d=e.Lnext,this.delete(e),c=null,e=null)),!c||c.Lnext.Org!==f;)c=d;return!0},check:function(){var a,b,c,d,e,f,g=this.fHead,h=this.vHead,i=this.eHead;for(b=g,b=g;(a=b.next)!==g;b=a){n(a.prev===b),e=a.anEdge;do n(e.Sym!==e),n(e.Sym.Sym===e),n(e.Lnext.Onext.Sym===e),n(e.Onext.Sym.Lnext===e),n(e.Lface===a),e=e.Lnext;while(e!==a.anEdge)}for(n(a.prev===b&&null===a.anEdge),d=h,d=h;(c=d.next)!==h;d=c){n(c.prev===d),e=c.anEdge;do n(e.Sym!==e),n(e.Sym.Sym===e),n(e.Lnext.Onext.Sym===e),n(e.Onext.Sym.Lnext===e),n(e.Org===c),e=e.Onext;while(e!==c.anEdge)}for(n(c.prev===d&&null===c.anEdge),f=i,f=i;(e=f.next)!==i;f=e)n(e.Sym.next===f.Sym),n(e.Sym!==e),n(e.Sym.Sym===e),n(null!==e.Org),n(null!==e.Dst),n(e.Lnext.Onext.Sym===e),n(e.Onext.Sym.Lnext===e);n(e.Sym.next===f.Sym&&e.Sym===this.eHeadSym&&e.Sym.Sym===e&&null===e.Org&&null===e.Dst&&null===e.Lface&&null===e.Rface)}};var o={};o.vertEq=function(a,b){return a.s===b.s&&a.t===b.t},o.vertLeq=function(a,b){return a.s<b.s||a.s===b.s&&a.t<=b.t},o.transLeq=function(a,b){return a.t<b.t||a.t===b.t&&a.s<=b.s},o.edgeGoesLeft=function(a){return o.vertLeq(a.Dst,a.Org)},o.edgeGoesRight=function(a){return o.vertLeq(a.Org,a.Dst)},o.vertL1dist=function(a,b){return Math.abs(a.s-b.s)+Math.abs(a.t-b.t)},o.edgeEval=function(a,b,c){n(o.vertLeq(a,b)&&o.vertLeq(b,c));var d=b.s-a.s,e=c.s-b.s;return d+e>0?e>d?b.t-a.t+(a.t-c.t)*(d/(d+e)):b.t-c.t+(c.t-a.t)*(e/(d+e)):0},o.edgeSign=function(a,b,c){n(o.vertLeq(a,b)&&o.vertLeq(b,c));var d=b.s-a.s,e=c.s-b.s;return d+e>0?(b.t-c.t)*d+(b.t-a.t)*e:0},o.transEval=function(a,b,c){n(o.transLeq(a,b)&&o.transLeq(b,c));var d=b.t-a.t,e=c.t-b.t;return d+e>0?e>d?b.s-a.s+(a.s-c.s)*(d/(d+e)):b.s-c.s+(c.s-a.s)*(e/(d+e)):0},o.transSign=function(a,b,c){n(o.transLeq(a,b)&&o.transLeq(b,c));var d=b.t-a.t,e=c.t-b.t;return d+e>0?(b.s-c.s)*d+(b.s-a.s)*e:0},o.vertCCW=function(a,b,c){return a.s*(b.t-c.t)+b.s*(c.t-a.t)+c.s*(a.t-b.t)>=0},o.interpolate=function(a,b,c,d){return a=0>a?0:a,c=0>c?0:c,c>=a?0==c?(b+d)/2:b+(d-b)*(a/(a+c)):d+(b-d)*(c/(a+c))},o.intersect=function(a,b,c,d,e){var f,g,h;o.vertLeq(a,b)||(h=a,a=b,b=h),o.vertLeq(c,d)||(h=c,c=d,d=h),o.vertLeq(a,c)||(h=a,a=c,c=h,h=b,b=d,d=h),o.vertLeq(c,b)?o.vertLeq(b,d)?(f=o.edgeEval(a,c,b),g=o.edgeEval(c,b,d),0>f+g&&(f=-f,g=-g),e.s=o.interpolate(f,c.s,g,b.s)):(f=o.edgeSign(a,c,b),g=-o.edgeSign(a,d,b),0>f+g&&(f=-f,g=-g),e.s=o.interpolate(f,c.s,g,d.s)):e.s=(c.s+b.s)/2,o.transLeq(a,b)||(h=a,a=b,b=h),o.transLeq(c,d)||(h=c,c=d,d=h),o.transLeq(a,c)||(h=a,a=c,c=h,h=b,b=d,d=h),o.transLeq(c,b)?o.transLeq(b,d)?(f=o.transEval(a,c,b),g=o.transEval(c,b,d),0>f+g&&(f=-f,g=-g),e.t=o.interpolate(f,c.t,g,b.t)):(f=o.transSign(a,c,b),g=-o.transSign(a,d,b),0>f+g&&(f=-f,g=-g),e.t=o.interpolate(f,c.t,g,d.t)):e.t=(c.t+b.t)/2},g.prototype={min:function(){return this.head.next},max:function(){return this.head.prev},insert:function(a){return this.insertBefore(this.head,a)},search:function(a){var b=this.head;do b=b.next;while(null!==b.key&&!this.leq(this.frame,a,b.key));return b},insertBefore:function(a,b){do a=a.prev;while(null!==a.key&&!this.leq(this.frame,a.key,b));var c=new f;return c.key=b,c.next=a.next,a.next.prev=c,c.prev=a,a.next=c,c},"delete":function(a){a.next.prev=a.prev,a.prev.next=a.next}},j.prototype={floatDown_:function(a){var b,c,d,e=this.nodes,f=this.handles;for(b=e[a].handle;;){if(d=a<<1,d<this.size&&this.leq(f[e[d+1].handle].key,f[e[d].handle].key)&&++d,n(d<=this.max),c=e[d].handle,d>this.size||this.leq(f[b].key,f[c].key)){e[a].handle=b,f[b].node=a;break}e[a].handle=c,f[c].node=a,a=d}},floatUp_:function(a){var b,c,d,e=this.nodes,f=this.handles;for(b=e[a].handle;;){if(d=a>>1,c=e[d].handle,0==d||this.leq(f[c].key,f[b].key)){e[a].handle=b,f[b].node=a;break}e[a].handle=c,f[c].node=a,a=d}},init:function(){for(var a=this.size;a>=1;--a)this.floatDown_(a);this.initialized=!0},min:function(){return this.handles[this.nodes[1].handle].key},isEmpty:function(){0===this.size},insert:function(a){var b,c;if(b=++this.size,2*b>this.max){this.max*=2;var d;d=this.nodes.length,this.nodes.length=this.max+1;for(var e=d;e<this.nodes.length;e++)this.nodes[e]=new h;d=this.handles.length,this.handles.length=this.max+1;for(var e=d;e<this.handles.length;e++)this.handles[e]=new i}return 0===this.freeList?c=b:(c=this.freeList,this.freeList=this.handles[c].node),this.nodes[b].handle=c,this.handles[c].node=b,this.handles[c].key=a,this.initialized&&this.floatUp_(b),c},extractMin:function(){var a=this.nodes,b=this.handles,c=a[1].handle,d=b[c].key;return this.size>0&&(a[1].handle=a[this.size].handle,b[a[1].handle].node=1,b[c].key=null,b[c].node=this.freeList,this.freeList=c,--this.size,this.size>0&&this.floatDown_(1)),d},"delete":function(a){var b,c=this.nodes,d=this.handles;n(a>=1&&a<=this.max&&null!==d[a].key),b=d[a].node,c[b].handle=c[this.size].handle,d[c[b].handle].node=b,--this.size,b<=this.size&&(1>=b||this.leq(d[c[b>>1].handle].key,d[c[b].handle].key)?this.floatDown_(b):this.floatUp_(b)),d[a].key=null,d[a].node=this.freeList,this.freeList=a}};var p={};p.regionBelow=function(a){return a.nodeUp.prev.key},p.regionAbove=function(a){return a.nodeUp.next.key},p.debugEvent=function(){},p.addWinding=function(a,b){a.winding+=b.winding,a.Sym.winding+=b.Sym.winding},p.edgeLeq=function(a,b,c){var d,e,f=a.event,g=b.eUp,h=c.eUp;if(g.Dst===f)return h.Dst===f?o.vertLeq(g.Org,h.Org)?o.edgeSign(h.Dst,g.Org,h.Org)<=0:o.edgeSign(g.Dst,h.Org,g.Org)>=0:o.edgeSign(h.Dst,f,h.Org)<=0;if(h.Dst===f)return o.edgeSign(g.Dst,f,g.Org)>=0;var d=o.edgeEval(g.Dst,f,g.Org),e=o.edgeEval(h.Dst,f,h.Org);return d>=e},p.deleteRegion=function(a,b){b.fixUpperEdge&&n(0===b.eUp.winding),b.eUp.activeRegion=null,a.dict.delete(b.nodeUp)},p.fixUpperEdge=function(a,b,c){n(b.fixUpperEdge),a.mesh.delete(b.eUp),b.fixUpperEdge=!1,b.eUp=c,c.activeRegion=b},p.topLeftRegion=function(a,b){var c,d=b.eUp.Org;do b=p.regionAbove(b);while(b.eUp.Org===d);if(b.fixUpperEdge){if(c=a.mesh.connect(p.regionBelow(b).eUp.Sym,b.eUp.Lnext),null===c)return null;p.fixUpperEdge(a,b,c),b=p.regionAbove(b)}return b},p.topRightRegion=function(a){var b=a.eUp.Dst,a=null;do a=p.regionAbove(a);while(a.eUp.Dst===b);return a},p.addRegionBelow=function(a,b,c){var d=new k;return d.eUp=c,d.nodeUp=a.dict.insertBefore(b.nodeUp,d),d.fixUpperEdge=!1,d.sentinel=!1,d.dirty=!1,c.activeRegion=d,d},p.isWindingInside=function(a,b){switch(a.windingRule){case m.WINDING_ODD:return 0!=(1&b);case m.WINDING_NONZERO:return 0!=b;case m.WINDING_POSITIVE:return b>0;case m.WINDING_NEGATIVE:return 0>b;case m.WINDING_ABS_GEQ_TWO:return b>=2||-2>=b}return n(!1),!1},p.computeWinding=function(a,b){b.windingNumber=p.regionAbove(b).windingNumber+b.eUp.winding,b.inside=p.isWindingInside(a,b.windingNumber)},p.finishRegion=function(a,b){var c=b.eUp,d=c.Lface;d.inside=b.inside,d.anEdge=c,p.deleteRegion(a,b)},p.finishLeftRegions=function(a,b,c){for(var d,e,f=null,g=b,e=b.eUp;g!==c;){if(g.fixUpperEdge=!1,f=p.regionBelow(g),d=f.eUp,d.Org!=e.Org){if(!f.fixUpperEdge){p.finishRegion(a,g);break}d=a.mesh.connect(e.Lprev,d.Sym),p.fixUpperEdge(a,f,d)}e.Onext!==d&&(a.mesh.splice(d.Oprev,d),a.mesh.splice(e,d)),p.finishRegion(a,g),e=f.eUp,g=f}return e},p.addRightEdges=function(a,b,c,d,e,f){var g,h,i,j,k=!0;i=c;do n(o.vertLeq(i.Org,i.Dst)),p.addRegionBelow(a,b,i.Sym),i=i.Onext;while(i!==d);for(null===e&&(e=p.regionBelow(b).eUp.Rprev),h=b,j=e;g=p.regionBelow(h),i=g.eUp.Sym,i.Org===j.Org;)i.Onext!==j&&(a.mesh.splice(i.Oprev,i),a.mesh.splice(j.Oprev,i)),g.windingNumber=h.windingNumber-i.winding,g.inside=p.isWindingInside(a,g.windingNumber),h.dirty=!0,!k&&p.checkForRightSplice(a,h)&&(p.addWinding(i,j),p.deleteRegion(a,h),a.mesh.delete(j)),k=!1,h=g,j=i;h.dirty=!0,n(h.windingNumber-i.winding===g.windingNumber),f&&p.walkDirtyRegions(a,h)},p.spliceMergeVertices=function(a,b,c){a.mesh.splice(b,c)},p.vertexWeights=function(a,b,c){var d=o.vertL1dist(b,a),e=o.vertL1dist(c,a),f=.5*e/(d+e),g=.5*d/(d+e);a.coords[0]+=f*b.coords[0]+g*c.coords[0],a.coords[1]+=f*b.coords[1]+g*c.coords[1],a.coords[2]+=f*b.coords[2]+g*c.coords[2]},p.getIntersectData=function(a,b,c,d,e,f){b.coords[0]=b.coords[1]=b.coords[2]=0,b.idx=-1,p.vertexWeights(b,c,d),p.vertexWeights(b,e,f)},p.checkForRightSplice=function(a,b){var c=p.regionBelow(b),d=b.eUp,e=c.eUp;if(o.vertLeq(d.Org,e.Org)){if(o.edgeSign(e.Dst,d.Org,e.Org)>0)return!1;o.vertEq(d.Org,e.Org)?d.Org!==e.Org&&(a.pq.delete(d.Org.pqHandle),p.spliceMergeVertices(a,e.Oprev,d)):(a.mesh.splitEdge(e.Sym),a.mesh.splice(d,e.Oprev),b.dirty=c.dirty=!0)}else{if(o.edgeSign(d.Dst,e.Org,d.Org)<0)return!1;p.regionAbove(b).dirty=b.dirty=!0,a.mesh.splitEdge(d.Sym),a.mesh.splice(e.Oprev,d)}return!0},p.checkForLeftSplice=function(a,b){var c,d=p.regionBelow(b),e=b.eUp,f=d.eUp;if(n(!o.vertEq(e.Dst,f.Dst)),o.vertLeq(e.Dst,f.Dst)){if(o.edgeSign(e.Dst,f.Dst,e.Org)<0)return!1;p.regionAbove(b).dirty=b.dirty=!0,c=a.mesh.splitEdge(e),a.mesh.splice(f.Sym,c),c.Lface.inside=b.inside}else{if(o.edgeSign(f.Dst,e.Dst,f.Org)>0)return!1;b.dirty=d.dirty=!0,c=a.mesh.splitEdge(f),a.mesh.splice(e.Lnext,f.Sym),c.Rface.inside=b.inside}return!0},p.checkForIntersect=function(a,c){var d,e,f,g,h=p.regionBelow(c),i=c.eUp,j=h.eUp,k=i.Org,l=j.Org,m=i.Dst,q=j.Dst,r=new b;if(n(!o.vertEq(q,m)),n(o.edgeSign(m,a.event,k)<=0),n(o.edgeSign(q,a.event,l)>=0),n(k!==a.event&&l!==a.event),n(!c.fixUpperEdge&&!h.fixUpperEdge),k===l)return!1;if(d=Math.min(k.t,m.t),e=Math.max(l.t,q.t),d>e)return!1;if(o.vertLeq(k,l)){if(o.edgeSign(q,k,l)>0)return!1}else if(o.edgeSign(m,l,k)<0)return!1;return p.debugEvent(a),o.intersect(m,k,q,l,r),n(Math.min(k.t,m.t)<=r.t),n(r.t<=Math.max(l.t,q.t)),n(Math.min(q.s,m.s)<=r.s),n(r.s<=Math.max(l.s,k.s)),o.vertLeq(r,a.event)&&(r.s=a.event.s,r.t=a.event.t),f=o.vertLeq(k,l)?k:l,o.vertLeq(f,r)&&(r.s=f.s,r.t=f.t),o.vertEq(r,k)||o.vertEq(r,l)?(p.checkForRightSplice(a,c),!1):!o.vertEq(m,a.event)&&o.edgeSign(m,a.event,r)>=0||!o.vertEq(q,a.event)&&o.edgeSign(q,a.event,r)<=0?q===a.event?(a.mesh.splitEdge(i.Sym),a.mesh.splice(j.Sym,i),c=p.topLeftRegion(a,c),i=p.regionBelow(c).eUp,p.finishLeftRegions(a,p.regionBelow(c),h),p.addRightEdges(a,c,i.Oprev,i,i,!0),TRUE):m===a.event?(a.mesh.splitEdge(j.Sym),a.mesh.splice(i.Lnext,j.Oprev),h=c,c=p.topRightRegion(c),g=p.regionBelow(c).eUp.Rprev,h.eUp=j.Oprev,j=p.finishLeftRegions(a,h,null),p.addRightEdges(a,c,j.Onext,i.Rprev,g,!0),!0):(o.edgeSign(m,a.event,r)>=0&&(p.regionAbove(c).dirty=c.dirty=!0,a.mesh.splitEdge(i.Sym),i.Org.s=a.event.s,i.Org.t=a.event.t),o.edgeSign(q,a.event,r)<=0&&(c.dirty=h.dirty=!0,a.mesh.splitEdge(j.Sym),j.Org.s=a.event.s,j.Org.t=a.event.t),!1):(a.mesh.splitEdge(i.Sym),a.mesh.splitEdge(j.Sym),a.mesh.splice(j.Oprev,i),i.Org.s=r.s,i.Org.t=r.t,i.Org.pqHandle=a.pq.insert(i.Org),p.getIntersectData(a,i.Org,k,m,l,q),p.regionAbove(c).dirty=c.dirty=h.dirty=!0,!1)},p.walkDirtyRegions=function(a,b){for(var c,d,e=p.regionBelow(b);;){for(;e.dirty;)b=e,e=p.regionBelow(e);if(!b.dirty&&(e=b,b=p.regionAbove(b),null==b||!b.dirty))return;if(b.dirty=!1,c=b.eUp,d=e.eUp,c.Dst!==d.Dst&&p.checkForLeftSplice(a,b)&&(e.fixUpperEdge?(p.deleteRegion(a,e),a.mesh.delete(d),e=p.regionBelow(b),d=e.eUp):b.fixUpperEdge&&(p.deleteRegion(a,b),a.mesh.delete(c),b=p.regionAbove(e),c=b.eUp)),c.Org!==d.Org)if(c.Dst===d.Dst||b.fixUpperEdge||e.fixUpperEdge||c.Dst!==a.event&&d.Dst!==a.event)p.checkForRightSplice(a,b);else if(p.checkForIntersect(a,b))return;c.Org===d.Org&&c.Dst===d.Dst&&(p.addWinding(d,c),p.deleteRegion(a,b),a.mesh.delete(c),b=p.regionAbove(e))}},p.connectRightVertex=function(a,b,c){var d,e=c.Onext,f=p.regionBelow(b),g=b.eUp,h=f.eUp,i=!1;return g.Dst!==h.Dst&&p.checkForIntersect(a,b),o.vertEq(g.Org,a.event)&&(a.mesh.splice(e.Oprev,g),b=p.topLeftRegion(a,b),e=p.regionBelow(b).eUp,p.finishLeftRegions(a,p.regionBelow(b),f),i=!0),o.vertEq(h.Org,a.event)&&(a.mesh.splice(c,h.Oprev),c=p.finishLeftRegions(a,f,null),i=!0),i?(p.addRightEdges(a,b,c.Onext,e,e,!0),void 0):(d=o.vertLeq(h.Org,g.Org)?h.Oprev:g,d=a.mesh.connect(c.Lprev,d),p.addRightEdges(a,b,d,d.Onext,d.Onext,!1),d.Sym.activeRegion.fixUpperEdge=!0,p.walkDirtyRegions(a,b),void 0)},p.connectLeftDegenerate=function(a,b,c){var d,e,f,g,h;return d=b.eUp,o.vertEq(d.Org,c)?(n(!1),p.spliceMergeVertices(a,d,c.anEdge),void 0):o.vertEq(d.Dst,c)?(n(!1),b=p.topRightRegion(b),h=p.regionBelow(b),f=h.eUp.Sym,e=g=f.Onext,h.fixUpperEdge&&(n(e!==f),p.deleteRegion(a,h),a.mesh.delete(f),f=e.Oprev),a.mesh.splice(c.anEdge,f),o.edgeGoesLeft(e)||(e=null),p.addRightEdges(a,b,f.Onext,g,e,!0),void 0):(a.mesh.splitEdge(d.Sym),b.fixUpperEdge&&(a.mesh.delete(d.Onext),b.fixUpperEdge=!1),a.mesh.splice(c.anEdge,d),p.sweepEvent(a,c),void 0)},p.connectLeftVertex=function(a,b){var c,d,e,f,g,h,i=new k;if(i.eUp=b.anEdge.Sym,c=a.dict.search(i).key,d=p.regionBelow(c)){if(f=c.eUp,g=d.eUp,0===o.edgeSign(f.Dst,b,f.Org))return p.connectLeftDegenerate(a,c,b),void 0;if(e=o.vertLeq(g.Dst,f.Dst)?c:d,c.inside||e.fixUpperEdge){if(e===c)h=a.mesh.connect(b.anEdge.Sym,f.Lnext);else{var j=a.mesh.connect(g.Dnext,b.anEdge);h=j.Sym}e.fixUpperEdge?p.fixUpperEdge(a,e,h):p.computeWinding(a,p.addRegionBelow(a,c,h)),p.sweepEvent(a,b)}else p.addRightEdges(a,c,b.anEdge,b.anEdge,null,!0)}},p.sweepEvent=function(a,b){a.event=b,p.debugEvent(a);for(var c=b.anEdge;null===c.activeRegion;)if(c=c.Onext,c==b.anEdge)return p.connectLeftVertex(a,b),void 0;var d=p.topLeftRegion(a,c.activeRegion);n(null!==d);var e=p.regionBelow(d),f=e.eUp,g=p.finishLeftRegions(a,e,null);g.Onext===f?p.connectRightVertex(a,d,g):p.addRightEdges(a,d,g.Onext,f,f,!0)},p.addSentinel=function(a,b,c,d){var e=new k,f=a.mesh.makeEdge();f.Org.s=c,f.Org.t=d,f.Dst.s=b,f.Dst.t=d,a.event=f.Dst,e.eUp=f,e.windingNumber=0,e.inside=!1,e.fixUpperEdge=!1,e.sentinel=!0,e.dirty=!1,e.nodeUp=a.dict.insert(e)},p.initEdgeDict=function(a){a.dict=new g(a,p.edgeLeq);var b=a.bmax[0]-a.bmin[0],c=a.bmax[1]-a.bmin[1],d=a.bmin[0]-b,e=a.bmax[0]+b,f=a.bmin[1]-c,h=a.bmax[1]+c;p.addSentinel(a,d,e,f),p.addSentinel(a,d,e,h)},p.doneEdgeDict=function(a){for(var b,c=0;null!==(b=a.dict.min().key);)b.sentinel||(n(b.fixUpperEdge),n(1==++c)),n(0==b.windingNumber),p.deleteRegion(a,b)},p.removeDegenerateEdges=function(a){var b,c,d,e=a.mesh.eHead;for(b=e.next;b!==e;b=c)c=b.next,d=b.Lnext,o.vertEq(b.Org,b.Dst)&&b.Lnext.Lnext!==b&&(p.spliceMergeVertices(a,d,b),a.mesh.delete(b),b=d,d=b.Lnext),d.Lnext===b&&(d!==b&&((d===c||d===c.Sym)&&(c=c.next),a.mesh.delete(d)),(b===c||b===c.Sym)&&(c=c.next),a.mesh.delete(b))},p.initPriorityQ=function(a){var b,c,d,e=0;for(d=a.mesh.vHead,c=d.next;c!==d;c=c.next)e++;for(e+=8,b=a.pq=new j(e,o.vertLeq),d=a.mesh.vHead,c=d.next;c!==d;c=c.next)c.pqHandle=b.insert(c);return c!==d?!1:(b.init(),!0)},p.donePriorityQ=function(a){a.pq=null},p.removeDegenerateFaces=function(a,b){var c,d,e;for(c=b.fHead.next;c!==b.fHead;c=d)d=c.next,e=c.anEdge,n(e.Lnext!==e),e.Lnext.Lnext===e&&(p.addWinding(e.Onext,e),a.mesh.delete(e));return!0},p.computeInterior=function(a){var b,c;if(p.removeDegenerateEdges(a),!p.initPriorityQ(a))return!1;for(p.initEdgeDict(a);null!==(b=a.pq.extractMin());){for(;c=a.pq.min(),null!==c&&o.vertEq(c,b);)c=a.pq.extractMin(),p.spliceMergeVertices(a,b.anEdge,c.anEdge);p.sweepEvent(a,b)}return a.event=a.dict.min().key.eUp.Org,p.debugEvent(a),p.doneEdgeDict(a),p.donePriorityQ(a),p.removeDegenerateFaces(a,a.mesh)?(a.mesh.check(),!0):!1},l.prototype={dot_:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},normalize_:function(a){var b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2];n(b>0),b=Math.sqrt(b),a[0]/=b,a[1]/=b,a[2]/=b},longAxis_:function(a){var b=0;return Math.abs(a[1])>Math.abs(a[0])&&(b=1),Math.abs(a[2])>Math.abs(a[b])&&(b=2),b},computeNormal_:function(a){var b,c,d,e,f,g,h,i=[0,0,0],j=[0,0,0],k=[0,0,0],l=[0,0,0],m=[0,0,0],n=[null,null,null],o=[null,null,null],p=this.mesh.vHead;for(b=p.next,h=0;3>h;++h)e=b.coords[h],j[h]=e,o[h]=b,i[h]=e,n[h]=b;for(b=p.next;b!==p;b=b.next)for(h=0;3>h;++h)e=b.coords[h],e<j[h]&&(j[h]=e,o[h]=b),e>i[h]&&(i[h]=e,n[h]=b);if(h=0,i[1]-j[1]>i[0]-j[0]&&(h=1),i[2]-j[2]>i[h]-j[h]&&(h=2),j[h]>=i[h])return a[0]=0,a[1]=0,a[2]=1,void 0;for(g=0,c=o[h],d=n[h],k[0]=c.coords[0]-d.coords[0],k[1]=c.coords[1]-d.coords[1],k[2]=c.coords[2]-d.coords[2],b=p.next;b!==p;b=b.next)l[0]=b.coords[0]-d.coords[0],l[1]=b.coords[1]-d.coords[1],l[2]=b.coords[2]-d.coords[2],m[0]=k[1]*l[2]-k[2]*l[1],m[1]=k[2]*l[0]-k[0]*l[2],m[2]=k[0]*l[1]-k[1]*l[0],f=m[0]*m[0]+m[1]*m[1]+m[2]*m[2],f>g&&(g=f,a[0]=m[0],a[1]=m[1],a[2]=m[2]);0>=g&&(a[0]=a[1]=a[2]=0,a[this.longAxis_(k)]=1)},checkOrientation_:function(){var a,b,c,d,e=this.mesh.fHead,f=this.mesh.vHead;for(a=0,b=e.next;b!==e;b=b.next)if(d=b.anEdge,!(d.winding<=0))do a+=(d.Org.s-d.Dst.s)*(d.Org.t+d.Dst.t),d=d.Lnext;while(d!==b.anEdge);if(0>a){for(c=f.next;c!==f;c=c.next)c.t=-c.t;this.tUnit[0]=-this.tUnit[0],this.tUnit[1]=-this.tUnit[1],this.tUnit[2]=-this.tUnit[2]}},projectPolygon_:function(){var a,b,c,d,e,f=this.mesh.vHead,g=[0,0,0],h=!1;for(g[0]=this.normal[0],g[1]=this.normal[1],g[2]=this.normal[2],0===g[0]&&0===g[1]&&0===g[2]&&(this.computeNormal_(g),h=!0),b=this.sUnit,c=this.tUnit,d=this.longAxis_(g),b[d]=0,b[(d+1)%3]=1,b[(d+2)%3]=0,c[d]=0,c[(d+1)%3]=0,c[(d+2)%3]=g[d]>0?1:-1,a=f.next;a!==f;a=a.next)a.s=this.dot_(a.coords,b),a.t=this.dot_(a.coords,c);for(h&&this.checkOrientation_(),e=!0,a=f.next;a!==f;a=a.next)e?(this.bmin[0]=this.bmax[0]=a.s,this.bmin[1]=this.bmax[1]=a.t,e=!1):(a.s<this.bmin[0]&&(this.bmin[0]=a.s),a.s>this.bmax[0]&&(this.bmax[0]=a.s),a.t<this.bmin[1]&&(this.bmin[1]=a.t),a.t>this.bmax[1]&&(this.bmax[1]=a.t))},addWinding_:function(a,b){a.winding+=b.winding,a.Sym.winding+=b.Sym.winding},tessellateMonoRegion_:function(a,b){var c,d;for(c=b.anEdge,n(c.Lnext!==c&&c.Lnext.Lnext!==c);o.vertLeq(c.Dst,c.Org);c=c.Lprev);for(;o.vertLeq(c.Org,c.Dst);c=c.Lnext);for(d=c.Lprev;c.Lnext!==d;)if(o.vertLeq(c.Dst,d.Org)){for(;d.Lnext!==c&&(o.edgeGoesLeft(d.Lnext)||o.edgeSign(d.Org,d.Dst,d.Lnext.Dst)<=0);){var e=a.connect(d.Lnext,d);d=e.Sym}d=d.Lprev}else{for(;d.Lnext!=c&&(o.edgeGoesRight(c.Lprev)||o.edgeSign(c.Dst,c.Org,c.Lprev.Org)>=0);){var e=a.connect(c,c.Lprev);c=e.Sym}c=c.Lnext}for(n(d.Lnext!==c);d.Lnext.Lnext!==c;){var e=a.connect(d.Lnext,d);d=e.Sym}return!0},tessellateInterior_:function(a){var b,c;for(b=a.fHead.next;b!==a.fHead;b=c)if(c=b.next,b.inside&&!this.tessellateMonoRegion_(a,b))return!1;return!0},discardExterior_:function(a){var b,c;for(b=a.fHead.next;b!==a.fHead;b=c)c=b.next,b.inside||a.zapFace(b)},setWindingNumber_:function(a,b,c){var d,e;for(d=a.eHead.next;d!==a.eHead;d=e)e=d.next,d.Rface.inside!==d.Lface.inside?d.winding=d.Lface.inside?b:-b:c?a.delete(d):d.winding=0},getNeighbourFace_:function(a){return a.Rface?a.Rface.inside?a.Rface.n:-1:-1},outputPolymesh_:function(a,b,c,d){var e,f,g,h,i,j=0,k=0;for(c>3&&a.mergeConvexFaces(c),e=a.vHead.next;e!==a.vHead;e=e.next)e.n=-1;for(f=a.fHead.next;f!=a.fHead;f=f.next)if(f.n=-1,f.inside){g=f.anEdge,h=0;do e=g.Org,-1===e.n&&(e.n=k,k++),h++,g=g.Lnext;while(g!==f.anEdge);n(c>=h),f.n=j,++j}for(this.elementCount=j,b==m.CONNECTED_POLYGONS&&(j*=2),this.elements=[],this.elements.length=j*c,this.vertexCount=k,this.vertices=[],this.vertices.length=k*d,this.vertexIndices=[],this.vertexIndices.length=k,e=a.vHead.next;e!==a.vHead;e=e.next)if(-1!=e.n){var l=e.n*d;this.vertices[l+0]=e.coords[0],this.vertices[l+1]=e.coords[1],d>2&&(this.vertices[l+2]=e.coords[2]),this.vertexIndices[e.n]=e.idx}var o=0;for(f=a.fHead.next;f!==a.fHead;f=f.next)if(f.inside){g=f.anEdge,h=0;do e=g.Org,this.elements[o++]=e.n,h++,g=g.Lnext;while(g!==f.anEdge);for(i=h;c>i;++i)this.elements[o++]=-1;if(b==m.CONNECTED_POLYGONS){g=f.anEdge;do this.elements[o++]=this.getNeighbourFace_(g),g=g.Lnext;while(g!==f.anEdge);for(i=h;c>i;++i)this.elements[o++]=-1}}},outputContours_:function(a,b){var c,d,e,f=0,g=0;for(this.vertexCount=0,this.elementCount=0,c=a.fHead.next;c!==a.fHead;c=c.next)if(c.inside){e=d=c.anEdge;do this.vertexCount++,d=d.Lnext;while(d!==e);this.elementCount++}this.elements=[],this.elements.length=2*this.elementCount,this.vertices=[],this.vertices.length=this.vertexCount*b,this.vertexIndices=[],this.vertexIndices.length=this.vertexCount;
var h=0,i=0,j=0;for(f=0,c=a.fHead.next;c!==a.fHead;c=c.next)if(c.inside){g=0,e=d=c.anEdge;do this.vertices[h++]=d.Org.coords[0],this.vertices[h++]=d.Org.coords[1],b>2&&(this.vertices[h++]=d.Org.coords[2]),this.vertexIndices[i++]=d.Org.idx,g++,d=d.Lnext;while(d!==e);this.elements[j++]=f,this.elements[j++]=g,f+=g}},addContour:function(a,b){var c,d;for(null===this.mesh&&(this.mesh=new e),2>a&&(a=2),a>3&&(a=3),c=null,d=0;d<b.length;d+=a)null==c?(c=this.mesh.makeEdge(),this.mesh.splice(c,c.Sym)):(this.mesh.splitEdge(c),c=c.Lnext),c.Org.coords[0]=b[d+0],c.Org.coords[1]=b[d+1],c.Org.coords[2]=a>2?b[d+2]:0,c.Org.idx=this.vertexIndexCounter++,c.winding=1,c.Sym.winding=-1},tesselate:function(a,b,c,d,e){if(this.vertices=[],this.elements=[],this.vertexIndices=[],this.vertexIndexCounter=0,e&&(this.normal[0]=e[0],this.normal[1]=e[1],this.normal[2]=e[2]),this.windingRule=a,2>d&&(d=2),d>3&&(d=3),!this.mesh)return!1;this.projectPolygon_(),p.computeInterior(this);var f=this.mesh;return b==m.BOUNDARY_CONTOURS?this.setWindingNumber_(f,1,!0):this.tessellateInterior_(f),f.check(),b==m.BOUNDARY_CONTOURS?this.outputContours_(f,d):this.outputPolymesh_(f,b,c,d),!0}}}("undefined"==typeof window?y.exports:window);var z="Unexpected arguments. Please refer to documentation.",A=function(){var b=a.getVariable(["execution","weldThreshold"]);return void 0===b&&(b=d(1e-5),a.setVariable(["execution","weldThreshold"],b)),b},B={};c.exports.Conversions=B,g(B,"Conversions");var C="undefined"==typeof window?y.exports:window,D=function(a,b){this._original=a,a&&b&&b.forEach(function(b){a[b]&&(this["_"+b]||(this["_"+b]=function(){this._original[b].apply(this._original,arguments)}),this[b]=this["_"+b])},this),this._parameterDefinitions=void 0};D.prototype={_validateParameters:function(a){var b={id:!0,displayName:!0,displayIcon:!1,type:!0,validate:!1,invalid:!1,visible:!1,"default":!0},c={bool:{rangeMin:!1,rangeMax:!1,ticks:!1,steps:!1,displayValue:!1},"int":{rangeMin:!1,rangeMax:!1,ticks:!1,steps:!1,displayValue:!1},"float":{rangeMin:!1,rangeMax:!1,ticks:!1,steps:!1,displayValue:!1},length:{rangeMin:!1,rangeMax:!1,ticks:!1,steps:!1,displayValue:!1,displayUnit:!1},angle:{rangeMin:!1,rangeMax:!1,ticks:!1,steps:!1,displayValue:!1},list:{listValues:!0,listLabels:!1,listImages:!1,listClasses:!1,pageSize:!1},sketch:{},string:{singleLine:!1,maxLength:!1},file:{accept:!0,config:!1,maxSize:!1,"default":!1}};for(var d in c)for(var e in b)void 0===c[d][e]&&(c[d][e]=b[e]);a instanceof Array&&a.forEach(function(a){var b=c[a.type];if(void 0===b)hb.panic("Unknown Parameter Type: ["+a.type+"].  Valid types are: "+Object.keys(c));else{for(var d in b)!0===b[d]&&void 0===a[d]&&hb.panic("Required Attribute ["+d+"] missing for parameter ["+(a.id||a.displayName)+"]");for(var d in a)void 0===b[d]&&hb.panic("Unrecognized Attribute ["+d+"] defined for parameter ["+(a.id||a.displayName)+"].  Valid attributes are: "+Object.keys(b))}})},_deserializeParameters:function(b,c){b.forEach(function(b){var d=a.getVariable(["parameters",b.type,"deserializer"]);if(d)try{c[b.id]=d(c[b.id])}catch(e){hb.warning("A problem occurred while deserializing parameter ["+b.id+"]")}})},_unpackParameters:function(a,c){if(this._original.parameters)if(void 0===this._parameterDefinitions){b.log("Fetching Parameter Definitions");var d=this;this._parameters(function(b){d._parameterDefinitions=b,d._deserializeParameters(d._parameterDefinitions,a),c(a)})}else b.log("Re-using Parameter Definitions"),this._deserializeParameters(this._parameterDefinitions,a),c(a);else c(a)},_parameters:function(a){var b=this;b._original.parameters(function(c){b._validateParameters(c),a(c)})}};var E=["presets","evaluate","preview","validate","configuration","randomize"];E.forEach(function(a){D.prototype["_"+a]=function(){this._original[a].apply(this._original,arguments)}}),g(D,"BaseProxy");var F=function(){this.polygons=[]};if(F.fromPolygons=function(a){var b=new F;return b.polygons=a,b},F.prototype={clone:function(){var a=new F;return a.polygons=this.polygons.map(function(a){return a.clone()}),a},toPolygons:function(){return this.polygons},union:function(a){var b=new F.Node(this.clone().polygons),c=new F.Node(a.clone().polygons);return b.clipTo(c),c.clipTo(b),c.invert(),c.clipTo(b),c.invert(),b.build(c.allPolygons()),F.fromPolygons(b.allPolygons())},subtract:function(a){var b=new F.Node(this.clone().polygons),c=new F.Node(a.clone().polygons);return b.invert(),b.clipTo(c),c.clipTo(b),c.invert(),c.clipTo(b),c.invert(),b.build(c.allPolygons()),b.invert(),F.fromPolygons(b.allPolygons())},intersect:function(a){var b=new F.Node(this.clone().polygons),c=new F.Node(a.clone().polygons);return b.invert(),c.clipTo(b),c.invert(),b.clipTo(c),c.clipTo(b),b.build(c.allPolygons()),b.invert(),F.fromPolygons(b.allPolygons())},inverse:function(){var a=this.clone();return a.polygons.map(function(a){a.flip()}),a}},F.cube=function(a){a=a||{};var b=new F.Vector(a.center||[0,0,0]),c=a.radius?a.radius.length?a.radius:[a.radius,a.radius,a.radius]:[1,1,1];return F.fromPolygons([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(a){return new F.Polygon(a[0].map(function(d){var e=new F.Vector(b.x+c[0]*(2*!!(1&d)-1),b.y+c[1]*(2*!!(2&d)-1),b.z+c[2]*(2*!!(4&d)-1));return new F.Vertex(e,new F.Vector(a[1]))}))}))},F.sphere=function(a){function b(a,b){a*=2*Math.PI,b*=Math.PI;var f=new F.Vector(Math.cos(a)*Math.sin(b),Math.cos(b),Math.sin(a)*Math.sin(b));c.push(new F.Vertex(d.plus(f.times(e)),f))}a=a||{};for(var c,d=new F.Vector(a.center||[0,0,0]),e=a.radius||1,f=a.slices||16,g=a.stacks||8,h=[],i=0;f>i;i++)for(var j=0;g>j;j++)c=[],b(i/f,j/g),j>0&&b((i+1)/f,j/g),g-1>j&&b((i+1)/f,(j+1)/g),b(i/f,(j+1)/g),h.push(new F.Polygon(c));return F.fromPolygons(h)},F.cylinder=function(a){function b(a,b,d){var g=2*b*Math.PI,i=j.times(Math.cos(g)).plus(k.times(Math.sin(g))),l=c.plus(e.times(a)).plus(i.times(f)),m=i.times(1-Math.abs(d)).plus(h.times(d));return new F.Vertex(l,m)}a=a||{};for(var c=new F.Vector(a.start||[0,-1,0]),d=new F.Vector(a.end||[0,1,0]),e=d.minus(c),f=a.radius||1,g=a.slices||16,h=e.unit(),i=Math.abs(h.y)>.5,j=new F.Vector(i,!i,0).cross(h).unit(),k=j.cross(h).unit(),l=new F.Vertex(c,h.negated()),m=new F.Vertex(d,h.unit()),n=[],o=0;g>o;o++){var p=o/g,q=(o+1)/g;n.push(new F.Polygon([l,b(0,p,-1),b(0,q,-1)])),n.push(new F.Polygon([b(0,q,0),b(0,p,0),b(1,p,0),b(1,q,0)])),n.push(new F.Polygon([m,b(1,q,1),b(1,p,1)]))}return F.fromPolygons(n)},F.Vector=function(a,b,c){3==arguments.length?(this.x=a,this.y=b,this.z=c):"x"in a?(this.x=a.x,this.y=a.y,this.z=a.z):(this.x=a[0],this.y=a[1],this.z=a[2])},F.Vector.prototype={clone:function(){return new F.Vector(this.x,this.y,this.z)},negated:function(){return new F.Vector(-this.x,-this.y,-this.z)},plus:function(a){return new F.Vector(this.x+a.x,this.y+a.y,this.z+a.z)},minus:function(a){return new F.Vector(this.x-a.x,this.y-a.y,this.z-a.z)},times:function(a){return new F.Vector(this.x*a,this.y*a,this.z*a)},dividedBy:function(a){return new F.Vector(this.x/a,this.y/a,this.z/a)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lerp:function(a,b){return this.plus(a.minus(this).times(b))},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.dividedBy(this.length())},cross:function(a){return new F.Vector(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)}},F.Vertex=function(a,b){this.pos=new F.Vector(a),this.normal=new F.Vector(b)},F.Vertex.prototype={clone:function(){return new F.Vertex(this.pos.clone(),this.normal.clone())},flip:function(){this.normal=this.normal.negated()},interpolate:function(a,b){return new F.Vertex(this.pos.lerp(a.pos,b),this.normal.lerp(a.normal,b))}},F.Plane=function(a,b){this.normal=a,this.w=b},F.Plane.EPSILON=1e-5,F.Plane.fromPoints=function(a,b,c){var d=b.minus(a).cross(c.minus(a)).unit();return new F.Plane(d,d.dot(a))},F.Plane.prototype={clone:function(){return new F.Plane(this.normal.clone(),this.w)},flip:function(){this.normal=this.normal.negated(),this.w=-this.w},splitPolygon:function(a,b,c,d,e){for(var f=0,g=1,h=2,i=3,j=0,k=[],l=0;l<a.vertices.length;l++){var m=this.normal.dot(a.vertices[l].pos)-this.w,n=m<-F.Plane.EPSILON?h:m>F.Plane.EPSILON?g:f;j|=n,k.push(n)}switch(j){case f:(this.normal.dot(a.plane.normal)>0?b:c).push(a);break;case g:d.push(a);break;case h:e.push(a);break;case i:for(var o=[],p=[],l=0;l<a.vertices.length;l++){var q=(l+1)%a.vertices.length,r=k[l],s=k[q],t=a.vertices[l],u=a.vertices[q];if(r!=h&&o.push(t),r!=g&&p.push(r!=h?t.clone():t),(r|s)==i){var m=(this.w-this.normal.dot(t.pos))/this.normal.dot(u.pos.minus(t.pos)),v=t.interpolate(u,m);o.push(v),p.push(v.clone())}}o.length>=3&&d.push(new F.Polygon(o,a.shared)),p.length>=3&&e.push(new F.Polygon(p,a.shared))}}},F.Polygon=function(a,b){this.vertices=a,this.shared=b,this.plane=F.Plane.fromPoints(a[0].pos,a[1].pos,a[2].pos)},F.Polygon.prototype={clone:function(){var a=this.vertices.map(function(a){return a.clone()});return new F.Polygon(a,this.shared)},flip:function(){this.vertices.reverse().map(function(a){a.flip()}),this.plane.flip()}},F.Node=function(a){this.plane=null,this.front=null,this.back=null,this.polygons=[],a&&this.build(a)},F.Node.prototype={clone:function(){var a=new F.Node;return a.plane=this.plane&&this.plane.clone(),a.front=this.front&&this.front.clone(),a.back=this.back&&this.back.clone(),a.polygons=this.polygons.map(function(a){return a.clone()}),a},invert:function(){for(var a=0;a<this.polygons.length;a++)this.polygons[a].flip();this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var b=this.front;this.front=this.back,this.back=b},clipPolygons:function(a){if(!this.plane)return a.slice();for(var b=[],c=[],d=0;d<a.length;d++)this.plane.splitPolygon(a[d],b,c,b,c);return this.front&&(b=this.front.clipPolygons(b)),c=this.back?this.back.clipPolygons(c):[],b.concat(c)},clipTo:function(a){this.polygons=a.clipPolygons(this.polygons),this.front&&this.front.clipTo(a),this.back&&this.back.clipTo(a)},allPolygons:function(){var a=this.polygons.slice();return this.front&&(a=a.concat(this.front.allPolygons())),this.back&&(a=a.concat(this.back.allPolygons())),a},build:function(a){if(a.length){this.plane||(this.plane=a[0].plane.clone());for(var b=[],c=[],d=0;d<a.length;d++)this.plane.splitPolygon(a[d],this.polygons,this.polygons,b,c);b.length&&(this.front||(this.front=new F.Node),this.front.build(b)),c.length&&(this.back||(this.back=new F.Node),this.back.build(c))}}},!x&&"undefined"!=typeof window){var G={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},H=function(a){this.domDocument=a};H.prototype={root:function(){if(this.domDocument.hasChildNodes())for(var a=this.domDocument.childNodes,b,c=0;c<a.length;c++)if(b=a[c],b.nodeType===G.ELEMENT_NODE)return new J(b);return void 0},get:function(a,b){var c=this.domDocument,d=this.domDocument,e=c.evaluate(a,d,function(a){return b},XPathResult.ANY_TYPE,null),f=e.iterateNext();return f?new J(f):void 0},toString:function(){return XMLSerializer?(new XMLSerializer).serializeToString(this.domDocument):""}};var I=function(a){this.nsuri=a};I.prototype={href:function(){return this.nsuri}};var J=function(a){this.domElement=a};J.prototype={name:function(){return this.domElement.nodeName},type:function(){var a=G;switch(this.domElement.nodeType){case a.ELEMENT_NODE:return"element";case a.ATTRIBUTE_NODE:return"attribute";case a.TEXT_NODE:return"text";case a.CDATA_SECTION_NODE:return"cdata";case a.ENTITY_REFERENCE_NODE:return"entity_ref";case a.ENTITY_NODE:return"entity";case a.PROCESSING_INSTRUCTION_NODE:return"pi";case a.COMMENT_NODE:return"comment";case a.DOCUMENT_NODE:return"document";case a.DOCUMENT_TYPE_NODE:return"document_type";case a.DOCUMENT_FRAGMENT_NODE:return"document_frag";case a.NOTATION_NODE:return"notation"}return""},childNodes:function(){for(var a=[],b=this.domElement.childNodes,c=0,d=b.length;d>c;c++)a.push(new J(b[c]));return a},attrs:function(){for(var a=[],b=this.domElement.attributes,c=0,d=b.length;d>c;c++)a.push(new K(b[c]));return a},attr:function(){if(1===arguments.length){var a=arguments[0];if("object"==typeof a){for(var b in a)this.domElement.setAttribute(b,a[b]);return this}if("string"==typeof a)return this.domElement.getAttribute(a)}else if(2===arguments.length){var c=arguments[0],d=arguments[1];return this.domElement.setAttribute(c,d),this}},node:function(a){var b=this.domElement.ownerDocument,c=b.createElement(a);return this.domElement.appendChild(c),new J(c)},addChild:function(a){return this.domElement.appendChild(a.domElement),this},text:function(){return 0===arguments.length?this.domElement.textContent:(this.domElement.textContent=arguments[0].toString(),this)},namespace:function(){var a=this.domElement.namespaceURI;return new I(a)},get:function(a,b){var c=this.domElement.ownerDocument,d=this.domElement,e=c.evaluate(a,d,function(a){return b},XPathResult.ANY_TYPE,null),f=e.iterateNext();return f?new J(f):void 0}};var K=function(a){this.domAttribute=a};K.prototype={name:function(){return this.domAttribute.name},value:function(){return this.domAttribute.value}};var L=function(){this.domParser=null,window&&window.DOMParser&&(this.domParser=new window.DOMParser)};L.prototype={parseXml:function(a){if(this.domParser){a=a.replace(/<!DOCTYPE svg[^>]*>/,"");var b=this.domParser.parseFromString(a,"text/xml");return new H(b)}return void 0}},x=new L}var M=function(){};M.prototype={debug:function(){}};var N={_logBuffer:a.getVariable(["outcomes","logs"],[]),_pointBuffer:a.getVariable(["outcomes","points"],[]),_lineBuffer:a.getVariable(["outcomes","lines"],[]),_trianglesBuffer:a.getVariable(["outcomes","triangles"],[]),_currentColor:[.9,.25,.15,1],_setColor:function(a){if(Array.isArray(a)&&4===a.length)for(var b=this._currentColor,c=0,d=0,e=a.length;e>d;d++)c=a[d],c=0>c?0:c,c=c>1?1:c,b[d]=c;return this},_addLine:function(a){if(Array.isArray(a)&&6===a.length){var b=a.concat(this._currentColor);this._lineBuffer.push(b)}return this},_addPoint:function(a){if(Array.isArray(a)&&3===a.length){var b=a.concat(this._currentColor);this._pointBuffer.push(b)}return this},_addLog:function(a){return this._logBuffer.push(a),this},_addTriangles:function(a,b){for(var c=a.length,d=b.length,e=[c,d],f=0;c>f;f++)e.push(a[f]);for(var f=0;d>f;f++)e.push(b[f]);for(var f=0,g=this._currentColor.length;g>f;f++)e.push(this._currentColor[f]);return this._trianglesBuffer.push(e),this},_hasNaN:function(a){if(!Array.isArray(a))return!1;for(var b=0,c=a.length;c>b;b++)if(isNaN(a[b]))return!0;return!1}},O={color:function(){var a=void 0;switch(arguments.length){case 1:var b=arguments[0];!Array.isArray(b)||3!==b.length&&4!==b.length||(a=b);break;case 3:case 4:a=Array.prototype.slice.call(arguments)}return a&&!N._hasNaN(a)&&(3===a.length&&a.push(1),N._setColor(a)),this},log:function(a){return a&&"function"==typeof a.toString&&N._addLog(a.toString()),this},line:function(){var a=void 0;switch(arguments.length){case 1:var b=arguments[0];Array.isArray(b)&&6===b.length&&(a=b);break;case 2:var c=arguments[0],d=arguments[1];Array.isArray(c)&&3===c.length&&Array.isArray(d)&&3===d.length&&(a=c.concat(d));break;case 6:a=Array.prototype.slice.call(arguments)}return a&&!N._hasNaN(a)&&N._addLine(a),this},show:function(a){return a&&"function"==typeof a.debug&&a.debug(),this},triangles:function(a,b){var c=a.length;if(a&&c>0)if(b=b||[],a[0]instanceof Y){for(var d=[],e=0;c>e;e++){var f=a[e];d.push(f.x,f.y,f.z)}N._addTriangles(d,b)}else N._addTriangles(a,b);return this},point:function(){var a=void 0;switch(arguments.length){case 1:var b=arguments[0];Array.isArray(b)&&3===b.length&&(a=b);break;case 3:a=Array.prototype.slice.call(arguments)}return a&&!N._hasNaN(a)&&N._addPoint(a),this}};Object.defineProperty(O,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:N}),c.exports.Debug=O,g(O,"Debug");var P={EvenOdd:0,NonZero:1,Positive:2,Negative:3,AbsGreaterOrEqualTwo:4};g(P,"WindingRule"),c.exports.WindingRule=P;var Q=function(){this._vertices=[],this._triangles=[],this._vertexSet={}};Q.prototype={_hash:function(a,b,c){var d=1/A();return Math.floor(a*d+.5)+"#"+Math.floor(b*d+.5)+"#"+Math.floor(c*d+.5)},_addVertex:function(a,b,c){var d=this._hash(a,b,c),e=this._vertexSet[d];return void 0===e&&(this._vertices.push(a,b,c),e=this._vertices.length/3-1,this._vertexSet[d]=e),e},_bounds:function(){for(var a=this._vertices,b=Number.MAX_VALUE,c=Number.MAX_VALUE,d=Number.MAX_VALUE,e=-Number.MAX_VALUE,f=-Number.MAX_VALUE,g=-Number.MAX_VALUE,h,i,j,k=0,l=a.length/3;l>k;k++)h=a[3*k],i=a[3*k+1],j=a[3*k+2],b>h?b=h:h>e&&(e=h),c>i?c=i:i>f&&(f=i),d>j?d=j:j>g&&(g=j);var m=void 0;return e>b&&f>c&&g>d&&(m=[b,c,d,e,f,g]),m},_triangleNormal:function(a,b,c){var d=3*c,e=3*a[d],f=3*a[d+1],g=3*a[d+2],h=b[e],i=b[e+1],j=b[e+2],k=b[f],l=b[f+1],m=b[f+2],n=b[g],o=b[g+1],p=b[g+2],q=k-h,r=l-i,s=m-j,t=n-h,u=o-i,v=p-j,w=r*v-s*u,x=s*t-q*v,y=q*u-r*t,z=Math.sqrt(w*w+x*x+y*y);return z>0&&(w/=z,x/=z,y/=z),[w,x,y]},_isWindingOrderCorrect:function(){function a(a){return 3&1<<a}function b(a,b,c){var d=a[b];return d?d[c]:void 0}function c(a,b,c,d){var e=a[b];e||(e=a[b]={}),e[c]=d}function d(a,b){var c=[],d=a[b];if(d)for(var e in d)c.push(d[e]);for(var e in a)a[e][b]&&c.push(a[e][b]);for(var f=[],g,h=c.length-1;h>=0;h--)g=c[h].t1,-1===f.indexOf(g)&&f.push(g),g=c[h].t2,b&&-1===f.indexOf(g)&&f.push(g);return f}for(var e=this._triangles,f=this._vertices,g={},h=e.length/3,i,j,k,l,m,n={x:Number.MIN_VALUE,v:-1},o,p,q=0;h>q;q++)for(var r=0;3>r;r++)if(j=e[3*q+r],k=e[3*q+a(r)],l=k>j?j:k,m=j>k?j:k,o=f[3*j]>f[3*k]?j:k,p=f[3*o],p>n.x&&(n.x=p,n.v=o),void 0===(i=b(g,l,m)))i={},i.t1=q,i.t1v=r,c(g,l,m,i);else{if(i.complete)return!1;if(i.t2=q,i.t2v=r,i.complete=1,e[3*i.t1+i.t1v]===e[3*i.t2+i.t2v])return!1}if(-1!==n.v){for(var s=d(g,n.v),t=new $(1,0,0),u,v,w,q=s.length-1;q>=0;q--)if(u=this._triangleNormal(e,f,s[q]),v=t.dot(u),-1e-5>v||v>1e-5){w=s[q];break}if(w){var x=3*e[3*w],y=3*e[3*w+1],z=3*e[3*w+2],A={x:(f[x]+f[y]+f[z])/3,y:(f[x+1]+f[y+1]+f[z+1])/3,z:(f[x+2]+f[y+2]+f[z+2])/3},B,C=w,D={x:1,y:0,z:0};p=A.x;for(var E=q-1;E>=0;E--){var F=3*s[E],x=3*e[F],y=3*e[F+1],z=3*e[F+2],G={x:f[x],y:f[x+1],z:f[x+2]},H={x:f[y],y:f[y+1],z:f[y+2]},I={x:f[z],y:f[z+1],z:f[z+2]};B=this._hitTriangle(A,D,G,H,I),B&&B.x>p&&(p=B.x,C=s[E])}if(u=this._triangleNormal(e,f,C),v=t.dot(u),0>v)return!1}}return!0},_addTriangle:function(a,b,c){a!==b&&b!==c&&c!==a&&this._triangles.push(a,b,c)},_removeTriangle:function(a){this._triangles.splice(3*a,3)},_hitTriangle:function(a,b,c,d,e){function g(a){var b=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),c=b>0?1/b:0;a.x*=c,a.y*=c,a.z*=c}function h(a,b,c,d){var e=new $(d.x-c.x,d.y-c.y,d.z-c.z),f=new $(a.x-c.x,a.y-c.y,a.z-c.z),g=new $(b.x-c.x,b.y-c.y,b.z-c.z),h=e.cross(f),i=e.cross(g);return h.dot(i)>=0?!0:!1}var i={x:a.x,y:a.y,z:a.z},j={x:b.x+i.x,y:b.y+i.y,z:b.z+i.z},k,l,m,n,o,p,q,r={x:0,y:0,z:0},s={x:0,y:0,z:0},t={x:0,y:0,z:0},u={x:0,y:0,z:0};if(u.x=(d.y-c.y)*(e.z-c.z)-(d.z-c.z)*(e.y-c.y),u.y=(d.z-c.z)*(e.x-c.x)-(d.x-c.x)*(e.z-c.z),u.z=(d.x-c.x)*(e.y-c.y)-(d.y-c.y)*(e.x-c.x),g(u),k=-u.x*c.x-u.y*c.y-u.z*c.z,p=u.x*(j.x-i.x)+u.y*(j.y-i.y)+u.z*(j.z-i.z),f(p,0))return null;if(q=-(k+u.x*i.x+u.y*i.y+u.z*i.z)/p,0>q)return null;var v={x:0,y:0,z:0};return v.x=i.x+q*(j.x-i.x),v.y=i.y+q*(j.y-i.y),v.z=i.z+q*(j.z-i.z),h(v,e,c,d)&&h(v,c,d,e)&&h(v,d,e,c)?v:null},_bridgeBoundaries:function(a,b){function c(a,b,c,e){var g=function(a,b,c,d){b!==c&&c!==d&&d!==b&&a.push(b,c,d)},h,i,j,k;a.length>=c.length?(h=a,i=b,j=c,k=e):(h=c,i=e,j=a,k=b);var l=h.length/3,m=j.length/3,n=0,o=0,p=function(a){var b=a;return b=n>0&&a==i?i:0>=a?l-1:a-1},q=function(a){var b=a;return b=o>0&&a==k?k:a>=m-1?0:a+1},r=4,s=1/r,t=[],u=[];h.forEach(function(a){t.push(a)}),j.forEach(function(a){t.push(a)});var v=i,w=k,x=p(v),y=q(w),z=v,A=w,B=3*v,C=3*x,D=d(h[B],h[B+1],h[B+2],h[C],h[C+1],h[C+2]);B=3*w,C=3*y;for(var E=d(j[B],j[B+1],j[B+2],j[C],j[C+1],j[C+2]),F=l,G=0;;){var H=1;if(H=f(E,0)?f(D,0)?1:r:D/E,H>r)0!==E?g(u,F+y,F+A,G+v):(g(u,G+z,G+x,F+w),z=x,x=p(x),n++),A=y,y=q(y),o++,B=3*w,C=3*y,E=d(j[B],j[B+1],j[B+2],j[C],j[C+1],j[C+2]);else if(s>H)0!==D?g(u,G+z,G+x,F+w):(g(u,F+y,F+A,G+v),A=y,y=q(y),o++),z=x,x=p(x),n++,B=3*v,C=3*x,D=d(h[B],h[B+1],h[B+2],h[C],h[C+1],h[C+2]);else{B=3*z,C=3*y;var I=d(h[B],h[B+1],h[B+2],j[C],j[C+1],j[C+2]);B=3*x,C=3*A;var J=d(h[B],h[B+1],h[B+2],j[C],j[C+1],j[C+2]);I>J?(g(u,G+z,G+x,F+A),g(u,G+x,F+y,F+A)):(g(u,G+z,G+x,F+y),g(u,G+z,F+y,F+A)),v=x,w=y,z=x,x=p(x),A=y,y=q(y),n++,o++,B=3*v,C=3*x,D=d(h[B],h[B+1],h[B+2],h[C],h[C+1],h[C+2]),B=3*w,C=3*y,E=d(j[B],j[B+1],j[B+2],j[C],j[C+1],j[C+2])}if(n+o>l+m)break}return{vertices:t,indices:u}}var d=function(a,b,c,d,e,f){return(a-d)*(a-d)+(b-e)*(b-e)+(c-f)*(c-f)},e=function(a){var b=a.mesh._impl._vertices,c=a.vertexIndices;c[0]==c[c.length-1]&&c.pop();for(var d=[],e=0,f=c.length;f>e;e++){var g=3*c[e];d.push(b[g],b[g+1],b[g+2])}return d},g=function(a,b){for(var c=b[0],e=b[1],f=b[2],g={index:-1,distance:Number.MAX_VALUE,point:-1},h=0;h<a.length;h++)for(var i=a[h],j=0;j<i.length/3;j++){var k=3*j,l=i[k],m=i[k+1],n=i[k+2],o=d(c,e,f,l,m,n);o<=g.distance&&(g.index=h,g.distance=o,g.point=j)}return g},h=function(a,b){var c,d,e;a.length<=b.length?(c=a,d=b,e=!1):(c=b,d=a,e=!0);for(var h=[];;){if(0===c.length||0===d.length)break;var i=c.pop();if(0!==i.length){var j=g(d,i);if(!(j.index<0)){var k=d[j.index];d.splice(j.index,1),f(j.distance,0)||0!==k.length&&(e?h.push({our:k,ourIndex:j.point,their:i,theirIndex:0}):h.push({our:i,ourIndex:0,their:k,theirIndex:j.point}))}}}return h},i=a.map(function(a){return e(a)}),j=b.map(function(a){return e(a)}),k=h(i,j),l=[];return k.forEach(function(a){var b=c(a.their,a.theirIndex,a.our,a.ourIndex);l.push(b)}),l}};var R=function(){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new Q}),Object.defineProperty(this,"attributes",{writable:!1,enumerable:!0,configurable:!1,value:{}}),Object.defineProperty(this,"change",{writable:!1,enumerable:!0,configurable:!1,value:new q("changed")})};R.prototype={triangle:function(){var a=this._impl;switch(arguments.length){case 1:if(Array.isArray(arguments[0])&&9===arguments[0].length){var b=a._addVertex(arguments[0][0],arguments[0][1],arguments[0][2]),c=a._addVertex(arguments[0][3],arguments[0][4],arguments[0][5]),d=a._addVertex(arguments[0][6],arguments[0][7],arguments[0][8]);a._addTriangle(b,c,d)}else hb.panic(z);break;case 3:if(Array.isArray(arguments[0])&&3===arguments[0].length&&Array.isArray(arguments[1])&&3===arguments[1].length&&Array.isArray(arguments[2])&&3===arguments[2].length){var b=a._addVertex(arguments[0][0],arguments[0][1],arguments[0][2]),c=a._addVertex(arguments[1][0],arguments[1][1],arguments[1][2]),d=a._addVertex(arguments[2][0],arguments[2][1],arguments[2][2]);a._addTriangle(b,c,d)}else hb.panic(z);break;case 9:var b=a._addVertex(arguments[0],arguments[1],arguments[2]),c=a._addVertex(arguments[3],arguments[4],arguments[5]),d=a._addVertex(arguments[6],arguments[7],arguments[8]);a._addTriangle(b,c,d);break;default:hb.panic(z)}return this.change.fire(this),this},quad:function(){var a=this._impl;switch(arguments.length){case 1:if(Array.isArray(arguments[0])&&12===arguments[0].length){var b=a._addVertex(arguments[0][0],arguments[0][1],arguments[0][2]),c=a._addVertex(arguments[0][3],arguments[0][4],arguments[0][5]),d=a._addVertex(arguments[0][6],arguments[0][7],arguments[0][8]),e=a._addVertex(arguments[0][9],arguments[0][10],arguments[0][11]);a._addTriangle(b,c,d),a._addTriangle(b,d,e)}else hb.panic(z);break;case 4:if(Array.isArray(arguments[0])&&3===arguments[0].length&&Array.isArray(arguments[1])&&3===arguments[1].length&&Array.isArray(arguments[2])&&3===arguments[2].length&&Array.isArray(arguments[3])&&3===arguments[3].length){var b=a._addVertex(arguments[0][0],arguments[0][1],arguments[0][2]),c=a._addVertex(arguments[1][0],arguments[1][1],arguments[1][2]),d=a._addVertex(arguments[2][0],arguments[2][1],arguments[2][2]),e=a._addVertex(arguments[3][0],arguments[3][1],arguments[3][2]);a._addTriangle(b,c,d),a._addTriangle(b,d,e)}else hb.panic(z);break;case 12:if("number"==typeof arguments[0]&&"number"==typeof arguments[1]&&"number"==typeof arguments[2]&&"number"==typeof arguments[3]&&"number"==typeof arguments[4]&&"number"==typeof arguments[5]&&"number"==typeof arguments[6]&&"number"==typeof arguments[7]&&"number"==typeof arguments[8]&&"number"==typeof arguments[9]&&"number"==typeof arguments[10]&&"number"==typeof arguments[11]){var b=a._addVertex(arguments[0],arguments[1],arguments[2]),c=a._addVertex(arguments[3],arguments[4],arguments[5]),d=a._addVertex(arguments[6],arguments[7],arguments[8]),e=a._addVertex(arguments[9],arguments[10],arguments[11]);a._addTriangle(b,c,d),a._addTriangle(b,d,e)}else hb.panic(z);break;default:hb.panic(z)}return this.change.fire(this),this},transform:function(a){var b;Array.isArray(a)&&16===a.length?b=new ab(a):a instanceof ab?b=a:hb.panic(z),this._impl._vertexSet={};for(var c=b.elements,d=this._impl,e=d._vertices.length/3,f,g,h,i,j,k,l,m,n=0;e>n;n++)l=3*n,f=d._vertices[l],g=d._vertices[l+1],h=d._vertices[l+2],i=f*c[0]+g*c[4]+h*c[8]+c[12],j=f*c[1]+g*c[5]+h*c[9]+c[13],k=f*c[2]+g*c[6]+h*c[10]+c[14],d._vertices[l]=i,d._vertices[l+1]=j,d._vertices[l+2]=k,m=d._hash(i,j,k),d._vertexSet[m]=n;return this.change.fire(this),this},indexedTriangles:function(a,b){if(Array.isArray(a)&&Array.isArray(b)&&0===a.length%3&&0===b.length%3){for(var c=this._impl,d=a.length,e=b.length,f=[],g=0,h=0;d>g;g+=3,h++){var i=c._addVertex(a[g],a[g+1],a[g+2]);f[h]=i}for(var j=f.length,k=0;e>k;k++){var l=b[k];(l>j-1||0>l)&&hb.panic("The vertex index is out of range"),c._triangles.push(f[l])}}else hb.panic(z);return this.change.fire(this),this},combine:function(a){Array.isArray(a)||(a=[a]);for(var b,c=0;c<a.length;c++)b=a[c],b instanceof R||hb.panic("The supplied data meshes["+c+"] is not a Mesh3D object."),this.indexedTriangles(b._impl._vertices,b._impl._triangles);return this.change.fire(this),this},flipNormals:function(){for(var a=this._impl._triangles,b=a.length,c=0;b>c;c+=3){var d=a[c+1];a[c+1]=a[c+2],a[c+2]=d}return this},clone:function(){var a=new R,b=this._impl._triangles,c=this._impl._vertices,d=this._impl._vertexSet;a._impl._triangles=b.slice(0),a._impl._vertices=c.slice(0);var e=a._impl._vertexSet;for(var f in d)e[f]=d[f];return a},unite:function(a,b){return h("union",this,a,b)},subtract:function(a,b){return h("subtract",this,a,b)},intersect:function(a,b){return h("intersect",this,a,b)},edges:function(){if(void 0!==this.attributes.edges&&void 0!==this.attributes.edges.data)return this.attributes.edges.data;void 0===this.attributes.edges&&this.change.bind(m);var a=[],b=new $,c=new $,d=function(a){var d={edge:a,marked:!1},e=a.sym;if(e)if(S.isPositiveEdge(a))if(e.faces.length>1||a.faces.length>1)d.marked=!0;else{var f=a.faces[0],g=e.faces[0],h=a.body.mesh._impl,i=h._triangleNormal(h._triangles,h._vertices,f),j=h._triangleNormal(h._triangles,h._vertices,g);b.x=i[0],b.y=i[1],b.z=i[2],c.x=j[0],c.y=j[1],c.z=j[2];var k=.819152;b.dot(c)<k&&(d.marked=!0)}else d.marked=!1;else d.marked=!0;return d},e=function(b){b.marked&&a.push(b.edge.v0,b.edge.v1)},f=S.body(this);S.eachEdge(f,S.filterObject(d,e));var g={data:a};return this.attributes.edges=g,a},bounds:function(){if(void 0!==this.attributes.bounds&&void 0!==this.attributes.bounds.data)return this.attributes.bounds.data;void 0===this.attributes.bounds&&this.change.bind(n);var a=this._impl._bounds(),b=void 0;if(a){b=new ob(new Y(a[0],a[1],a[2]),new Y(a[3],a[4],a[5]));var c={data:b};this.attributes.bounds=c}return b},boundaries:function(){if(void 0!==this.attributes.boundaries&&void 0!==this.attributes.boundaries.data)return O.log("cached boundaries data is used"),this.attributes.boundaries.data;void 0===this.attributes.boundaries&&this.change.bind(o);var a=[],b=function(a){var b={edge:a,marked:!1},c=a.sym;return c||(b.marked=!0),b},c=function(b){b.marked&&a.push({v0:b.edge.v0,v1:b.edge.v1})},d=S.body(this);S.eachEdge(d,S.filterObject(b,c));var e=S.edgeBoundaries(d,a),f={data:e};return this.attributes.boundaries=f,e},boundariesByTriangles:function(a){var b=this._impl._vertices,c=this._impl._triangles,d=new R;d._impl._vertices=b.slice(0),d._impl._triangles=[];for(var e=0,f=a.length;f>e;e++){var g=3*a[e];d._impl._triangles.push(c[g],c[g+1],c[g+2])}var h=d.boundaries();return h},trianglesByTriangle:function(a,b){b=b?!0:!1;var c=this._impl._triangles,d=3*a,e={};e[c[d]]=!0,e[c[d+1]]=!0,e[c[d+2]]=!0;var f=S.body(this),g={},h=function(a){g[a]=!0;for(var d=3*a,i=[c[d],c[d+1],c[d+2]],j=2,k=0;3>k;j=k++){var l=i[j],m=i[k],n=e[l],o=e[m],p=b&&n&&o||!b&&(n||o);if(p){var q=S.edgeOfVertices(f,l,m),r=S.edgeOfVertices(f,m,l),s=[];q&&s.push.apply(s,q.faces),r&&s.push.apply(s,r.faces),s.forEach(function(a){g[a]||h(a)})}}};return h(a),delete g[a],Object.keys(g)},trianglesByVertex:function(a){var b=[],c={},d=function(b){var c={edge:b,marked:!1},d=b.sym;return d&&b.v0===a?c.marked=!0:d||b.v1!==a&&b.v0!==a||(c.marked=!0),c},e=function(a){a.marked&&a.edge.faces.forEach(function(a){c[a]||b.push(a),c[a]=!0})},f=S.body(this);return S.eachEdge(f,S.filterObject(d,e)),b},trianglesByEdge:function(a,b){var c=S.body(this),d=S.edgeOfVertices(c,a,b);return d?d.faces:[]},vertexByIndex:function(a){var b=this._impl._vertices;if(a>=b.length/3)return void 0;var c=3*a;return[b[c],b[c+1],b[c+2]]},triangleByIndex:function(a){var b=this._impl._triangles;if(a>=b.length/3)return void 0;var c=3*a,d=[b[c],b[c+1],b[c+2]];return d},select:function(a){var b=function(a,b){return a.distance-b.distance};if(!a||!a.ray)return null;for(var c=[],d=a.ray,e=d.origin,f=d.direction,g=this._impl._triangles,h=this._impl._vertices,i=[],j=0,k=h.length;k>j;j+=3){var l={x:h[j],y:h[j+1],z:h[j+2]};i.push(l)}for(var j=0,m=g.length;m>j;j+=3){var n=g[j],o=g[j+1],p=g[j+2],q=this._impl._hitTriangle(e,f,i[n],i[o],i[p]);if(q){var r=(q.x-e.x)*(q.x-e.x)+(q.y-e.y)*(q.y-e.y)+(q.z-e.z)*(q.z-e.z);c.push({triangle:j/3,point:q,distance:r})}}if(0===c.length)return null;c.sort(b);var s=c[0],t=new tb(this,[s.triangle]);return t.distance=Math.sqrt(s.distance),t.collision=new Y(s.point.x,s.point.y,s.point.z),t.selector=a,a.selections.push(t),t},removeTriangles:function(a){var b=a.triangleIndices.slice(0);b.sort(function(a,b){return a-b});for(var c=b.length-1;c>=0;c--)this._impl._removeTriangle(b[c]);this.change.fire(this)},combineByBoundaries:function(a,b){if(!a)return O.panic("Another mesh is empty."),this;if(this.combine([a]),!b)return O.log("Neither ours and theirs is supplied, this function will fallback to combine."),this;var c=b.ours||[],d=b.theirs||[];if(0===c.length&&0===d.length)return O.log("Neither ours and theirs is supplied, this function will fallback to combine."),this;if(d=0===d.length?a.boundaries():d,0===d.length)return this;var e=this._impl._bridgeBoundaries(c,d),f=this;return e.forEach(function(a){f.indexedTriangles(a.vertices,a.indices)}),this.change.fire(this),this},triangles:function(){return this._impl._triangles.slice(0)},toJSON:function(){var a={};return a.vertices=this._impl._vertices,a.triangles=this._impl._triangles,a},debug:function(){O.triangles(this._impl._vertices,this._impl._triangles)}};var S={body:function(a){if(void 0!==a.attributes.body&&void 0!==a.attributes.body.data)return a.attributes.body.data;void 0===a.attributes.body&&a.change.bind(this._bodyCacheHandler);var b=this._makeBody(a),c={data:b};return a.attributes.body=c,b},filterObject:function(a,b){var c={filter:a,callback:b};return c},eachEdge:function(a,b){var c=a.edgeHash,d=Object.keys(c);d.forEach(function(a){var d=c[a],e=b.filter,f=b.callback,g=e(d);f(g)})},edgeOfVertices:function(a,b,c){return a.edgeHash[this._hashOfEdge({v0:b,v1:c})]},edgeBoundaries:function(a,b){for(var c=function(a){for(var b=[],c=[];;){if(a.length<1)break;var d=[],e=a.pop();d.push(e);for(var f=!1;!f;){for(var g=!1,h=a.length-1;h>=0;h--){var i=a[h];if(i.v0===d[d.length-1].v1){a.splice(h,1),d.push(i),g=!0,i.v1===d[0].v0&&(f=!0);
break}}var j=!1;if(!g){var k=d.pop();c.push(k),a.length>0&&0===d.length&&(j=!0,e=a.pop(),d.push(e))}if(0===a.length&&!j)break}b.push(d)}return b},d=c(b),e=[],f=0;f<d.length;f++){var g=d[f],h=new ub;h.mesh=a.mesh;for(var i=0;i<g.length;i++){var j=g[i];h.vertexIndices.push(j.v0)}e.push(h)}return e},isPositiveEdge:function(a){return a.v0<a.v1},_bodyCacheHandler:function(a){if(a.data instanceof R){var b=a.data;delete b.attributes.body.data}},_makeBody:function(a){var b={mesh:a,edgeHash:{}},c=b.mesh;if(!c)return null;for(var d=c._impl._vertices,e=c._impl._triangles,f=0,g=e.length;g>f;f+=3){for(var h=[e[f],e[f+1],e[f+2]],i=[],j=f/3,k=0;3>k;k++){var l=h[k],m=h[(k+1)%3],n=this._hashOfEdge({v0:l,v1:m}),o=b.edgeHash[n];if(o)o.faces.push(j);else{var o={body:b,v0:l,v1:m,sym:null,faces:[j]};b.edgeHash[n]=o}i.push(o)}for(var p=0,q=i.length;q>p;p++){var o=i[p],r=this._hashOfEdge({v0:o.v1,v1:o.v0}),s=b.edgeHash[r];o.sym=s,s&&(s.sym=o)}}return b},_hashOfEdge:function(a){var b,c,d=a.v0,e=a.v1,f=e>d;return f?(b=d,c=e):(b=e,c=d),b+"-"+c+":"+f}};g(R,"Mesh3D"),c.exports.Mesh3D=R;var T=function(){function a(a){}function b(a){}function c(a,b){return Math.abs(a-b)<1e-6}function d(a){for(var b=[],c=[],d=a._impl._triangles,e=0,f=d.length/3;f>e;e++)c.push([d[3*e],d[3*e+1],d[3*e+2]]);for(var g=a._impl._vertices,e=0,h=g.length/3;h>e;e++)b.push(new $(g[3*e],g[3*e+1],g[3*e+2]));return{faces:c,points:b}}function e(a,b,c){this.guid=a,this.p0=b,this.p1=c,this.faces=[]}function f(){this.edgeMap={}}function g(){this.idToSetMap={},this.pointToIDMap={},this.lastID=0}function h(a,b){var c=a.dot(b),d=Math.abs(Math.abs(c)-1);return 1e-5>d}function i(a,b,c){var d=b.clone().subtract(a),e=c.clone().scale(d.dot(c));return d.subtract(e).length()<1e-5}function j(b,c){var d=[],e;for(e in c){var f=c[e],g=[],j;for(j in f){var k=f[j],l=b.points[k.p0],m=b.points[k.p1],n=null,o,p;k.unitV=m.clone().subtract(l).normalize();for(var q in g){var r=g[q].p0V,s=g[q].unitV;if(h(k.unitV,s)&&i(l,r,s)){n=g[q],o=l.clone().subtract(r).dot(s),p=m.clone().subtract(r).dot(s);break}}n||(o=0,p=m.clone().subtract(l).dot(k.unitV),n={unitV:k.unitV,p0V:l,points:{}},g.push(n)),n.points[k.p0]||(n.points[k.p0]={index:k.p0,distance:o,followingEdges:[]}),n.points[k.p1]||(n.points[k.p1]={index:k.p1,distance:p,followingEdges:[]}),a(n),a(o!=p),p>o?n.points[k.p0].followingEdges.push(k):n.points[k.p1].followingEdges.push(k)}d=d.concat(g)}return d}function k(b,c){var d,e;for(d in b){e=b[d];var f=[],g;for(g in e.points)a(e.points[g].followingEdges.length<=2),f.push(e.points[g]);f.sort(function(a,b){return a.distance-b.distance});var h;for(h=0;h<f.length;++h){var i,j,k=f[h];if(k.followingEdges.length&&(1!=k.followingEdges.length||2!=k.followingEdges[0].faces.length)&&2==k.followingEdges.length){a(2==k.followingEdges.length),a(k.followingEdges[0].faces.length==k.followingEdges[1].faces.length),a(1==k.followingEdges[0].faces.length),a(h+2<f.length);var l=f[h+1],m=k.followingEdges[0],n=k.followingEdges[1];a(m.p0==k.index||m.p1==k.index),a(n.p0==k.index||n.p1==k.index),a(m.p0==l.index||m.p1==l.index||n.p0==l.index||n.p1==l.index);var o,p;n.p0==l.index||n.p1==l.index?(o=m,p=n):(o=n,p=m);var q;q=o.p0==k.index?o.p1:o.p0,a(1==o.faces.length);for(var r=o.faces[0],s=-1,t=0;t<r.length;++t){var u=(t+1)%r.length,v=r[t],w=r[u];if(!(v!=o.p0&&v!=o.p1||w!=o.p0&&w!=o.p1)){s=t;break}}a(-1!=s),r.splice(s+1,0,l.index),p.faces.push(r),k.followingEdges[0]==o?k.followingEdges.splice(0,1):(a(k.followingEdges[1]==o),k.followingEdges.splice(1,1)),a(q!=k.index);var x=c.edgeForPoints(l.index,q);x?x.faces.push(r):(x=c.addEdge(l.index,q,r),l.followingEdges.push(x)),c.deleteEdge(o)}}}}function l(b){for(var d=[],e=0;e<b.faces.length;++e){var f=b.faces[e];if(3!=f.length){a(f.length>3),f.length>4&&(f=f.slice());for(var g=[],h=0;h<f.length;++h){var i=b.points[f[h]],j=b.points[f[(h+1)%f.length]];g.push(j.clone().subtract(i).normalize())}for(var k=[],h=0;h<f.length;++h){var l=g[h].dot(g[(h+1)%g.length]);k.push(l)}for(var m=function(){for(var b=-2,d=-1,e=!1,g=0;g<f.length;++g){var h=k[g];if(-1==d||h>=b||e&&c(1,h))b=h,d=g;else if(e)return g;c(1,h)&&(e=!0)}return a(b>-1),d},n=m();f.length>3;){var o=(n+1)%f.length,p=(n+2)%f.length;d.push([f[n],f[o],f[p]]),f.splice(o,1),f.length>3&&(k.splice(o,1),n=m())}d.push(f)}else d.push(f)}return{points:b.points,faces:d}}function m(a){var c=d(a),e=new f,h;for(h in c.faces)e.addFace(c.faces[h]);var i=e.edgeList(),m=[];for(h in i){var n=i[h];2!=n.faces.length&&m.push(n)}if(!m.length)return b("Design is clean."),void 0;var o=new g,n;for(n in m)o.addEdge(m[n]);var p=o.setList(),q=j(c,p);return b("Found "+m.length+" non-manifold edge(s), "+p.length+" connected set(s), "+q.length+" individual problem sets."),k(q,e),l(c)}function n(a){var c=new Date;b("RepairNonmanifoldEdges begin: input triangles "+a._impl._triangles.length/3);var d=m(a),e;return d?(e=new R,d.faces.map(function(a,b){var c=a.map(function(a){return d.points[a]});e.triangle(c[0].x,c[0].y,c[0].z,c[1].x,c[1].y,c[1].z,c[2].x,c[2].y,c[2].z)})):e=a,b("RepairNonmanifoldEdges end: used "+(new Date-c)+" ms, output triangles "+e._impl._triangles.length/3),e}return f.prototype.edgeForGuid=function(a){return a in this.edgeMap?this.edgeMap[a]:null},f.prototype.guidForEdge=function(a,b){if(a>b){var c=a;a=b,b=c}return a+"edge"+b},f.prototype.edgeForPoints=function(a,b){return this.edgeForGuid(this.guidForEdge(a,b))},f.prototype.addFace=function(a){for(var b=0;b<a.length;++b)this.addEdge(a[b],a[(b+1)%a.length],a)},f.prototype.addEdge=function(b,c,d){a(d);var f=this.guidForEdge(b,c),g=this.edgeForGuid(f);return g||(g=this.edgeMap[f]=new e(f,b,c)),a(g.faces.length<2),g.faces.push(d),g},f.prototype.deleteEdge=function(b){var c=this.guidForEdge(b.p0,b.p1);a(c in this.edgeMap),a(b==this.edgeMap[c]),delete this.edgeMap[c]},f.prototype.edgeList=function(){var a=[];for(var b in this.edgeMap)a.push(this.edgeMap[b]);return a},g.prototype.setList=function(){var a=[];for(var b in this.idToSetMap)a.push(this.idToSetMap[b]);return a},g.prototype.newSetID=function(){return++this.lastID},g.prototype.addEdge=function(a){var b,c;a.p0 in this.pointToIDMap?(c=this.pointToIDMap[a.p0],b=this.idToSetMap[c],b.push(a),a.p1 in this.pointToIDMap?c!=this.pointToIDMap[a.p1]&&this.mergeSetsForEdge(a):this.pointToIDMap[a.p1]=c):a.p1 in this.pointToIDMap?(c=this.pointToIDMap[a.p1],b=this.idToSetMap[c],b.push(a),this.pointToIDMap[a.p0]=c):(c=this.newSetID(),this.idToSetMap[c]=[a],this.pointToIDMap[a.p0]=this.pointToIDMap[a.p1]=c)},g.prototype.mergeSetsForEdge=function(b){var c=this.pointToIDMap[b.p0],d=this.pointToIDMap[b.p1],e=this.idToSetMap[c],f=this.idToSetMap[d];for(var g in f){var h=f[g];a(this.pointToIDMap[h.p0]==c||this.pointToIDMap[h.p0]==d),this.pointToIDMap[h.p0]=c,a(this.pointToIDMap[h.p1]==c||this.pointToIDMap[h.p1]==d),this.pointToIDMap[h.p1]=c,e.push(h)}delete this.idToSetMap[d]},n}(),U={NONMANIFOLD_EDGES:1},V={repair:function(a,b){return-1!==b.indexOf(U.NONMANIFOLD_EDGES)?T(a):void 0}},W=function(a,b){this.index=a||0,this.path=b};W.prototype={remove:function(){return this.path._impl._removeCurve(this.index),this},next:function(){var a=this.path._impl._nextCurve(this.index);return this.path.curveAt(a)},prev:function(){var a=this.path._impl._prevCurve(this.index);return this.path.curveAt(a)},isRemoved:function(){return this.path._impl._isRemoved(this.index)}};var X=function(a,b){this.x=a,this.y=b};X.prototype={clone:function(){return new X(this.x,this.y)},equals:function(a){return f(this.x,a.x)&&f(this.y,a.y)},move:function(a,b){return a instanceof Z?(this.x+=a.x,this.y+=a.y):Array.isArray(a)&&2===a.length?(this.x+=a[0],this.y+=a[1]):"number"==typeof a&&"number"==typeof b?(this.x+=a,this.y+=b):hb.panic(z),this},rotate:function(a,b,c){var d=0,e=0;"number"!=typeof a&&hb.panic(z),void 0!==b&&(b instanceof X?(d=b.x,e=b.y):Array.isArray(b)&&2===b.length?(d=b[0],e=b[1]):"number"==typeof b&&"number"==typeof c?(d=b,e=c):hb.panic(z));var f=Math.cos(a),g=Math.sin(a),h=f*(this.x-d)-g*(this.y-e)+d,i=g*(this.x-d)+f*(this.y-e)+e;return this.x=h,this.y=i,this},distanceTo:function(a){var b=(a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y);return Math.sqrt(b)},scale:function(a,b){if(a instanceof Z)this.x*=a.x,this.y*=a.y;else if(Array.isArray(a)&&2===a.length)this.x*=a[0],this.y*=a[1];else if("number"==typeof a){var c=a;"number"==typeof b&&(c=b),this.x*=a,this.y*=c}else hb.panic(z);return this},transform:function(a){if(Array.isArray(a)&&9===a.length){var b=this.x*a[0]+this.y*a[3]+a[6],c=this.x*a[1]+this.y*a[4]+a[7];this.x=b,this.y=c}else if(a instanceof _){var b=this.x*a.elements[0]+this.y*a.elements[3]+a.elements[6],c=this.x*a.elements[1]+this.y*a.elements[4]+a.elements[7];this.x=b,this.y=c}else hb.panic(z);return this},debug:function(){O.point(this.x,this.y,0)}},g(X,"Point2D"),c.exports.Point2D=X;var Y=function(a,b,c){this.x=a,this.y=b,this.z=c};Y.prototype={clone:function(){return new Y(this.x,this.y,this.z)},equals:function(a){return f(this.x,a.x)&&f(this.y,a.y)&&f(this.z,a.z)},transform:function(a){if(Array.isArray(a)&&16===a.length){var b=this.x*a[0]+this.y*a[4]+this.z*a[8]+a[12],c=this.x*a[1]+this.y*a[5]+this.z*a[9]+a[13],d=this.x*a[2]+this.y*a[6]+this.z*a[10]+a[14];this.x=b,this.y=c,this.z=d}else if(a instanceof ab){var e=a.elements,b=this.x*e[0]+this.y*e[4]+this.z*e[8]+e[12],c=this.x*e[1]+this.y*e[5]+this.z*e[9]+e[13],d=this.x*e[2]+this.y*e[6]+this.z*e[10]+e[14];this.x=b,this.y=c,this.z=d}else hb.panic(z);return this},distanceTo:function(a){var b=(a.x-this.x)*(a.x-this.x)+(a.y-this.y)*(a.y-this.y)+(a.z-this.z)*(a.z-this.z);return Math.sqrt(b)},debug:function(){O.point(this.x,this.y,this.z)}},g(Y,"Point3D"),c.exports.Point3D=Y;var Z=function(a,b){this.x=a,this.y=b};Z.prototype={clone:function(){return new Z(this.x,this.y)},equals:function(a){return f(this.x,a.x)&&f(this.y,a.y)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},rotate:function(a){var b=Math.cos(a),c=Math.sin(a),d=b*this.x-c*this.y,e=c*this.x+b*this.y;return this.x=d,this.y=e,this},normalize:function(){var a=this.length();return 0!==a&&(this.x/=a,this.y/=a),this},angle:function(a){var b=0,c=this.length(),d=a.length();if(0!==c&&0!==d){var e=this.dot(a),f=e/(c*d);b=Math.acos(f);var g=this.cross(a);0>g&&(b=-b)}return b},dot:function(a){return this.x*a.x+this.y*a.y},cross:function(a){return this.x*a.y-this.y*a.x},scale:function(a,b){if(a instanceof Z)this.x*=a.x,this.y*=a.y;else if(Array.isArray(a)&&2===a.length)this.x*=a[0],this.y*=a[1];else if("number"==typeof a){var c=a;"number"==typeof b&&(c=b),this.x*=a,this.y*=c}else hb.panic(z);return this},transform:function(a){if(Array.isArray(a)&&9===a.length){var b=this.x*a[0]+this.y*a[3],c=this.x*a[1]+this.y*a[4];this.x=b,this.y=c}else if(a instanceof _){var b=this.x*a.elements[0]+this.y*a.elements[3],c=this.x*a.elements[1]+this.y*a.elements[4];this.x=b,this.y=c}else hb.panic(z);return this},debug:function(){O.line(0,0,0,this.x,this.y,0)}},g(Z,"Vector2D"),c.exports.Vector2D=Z;var $=function(a,b,c){this.x=a,this.y=b,this.z=c};$.prototype={clone:function(){return new $(this.x,this.y,this.z)},equals:function(a){return f(this.x,a.x)&&f(this.y,a.y)&&f(this.z,a.z)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},transform:function(a){if(Array.isArray(a)&&16===a.length){var b=this.x*a[0]+this.y*a[4]+this.z*a[8],c=this.x*a[1]+this.y*a[5]+this.z*a[9],d=this.x*a[2]+this.y*a[6]+this.z*a[10];this.x=b,this.y=c,this.z=d}else if(a instanceof ab){var e=a.elements,b=this.x*e[0]+this.y*e[4]+this.z*e[8],c=this.x*e[1]+this.y*e[5]+this.z*e[9],d=this.x*e[2]+this.y*e[6]+this.z*e[10];this.x=b,this.y=c,this.z=d}else hb.panic(z);return this},normalize:function(){var a=this.length();return 0!==a&&(this.x/=a,this.y/=a,this.z/=a),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},cross:function(a){var b=[];return Array.isArray(a)&&3===a.length?(b[0]=this.y*a[2]-this.z*a[1],b[1]=this.z*a[0]-this.x*a[2],b[2]=this.x*a[1]-this.y*a[0]):a instanceof $?(b[0]=this.y*a.z-this.z*a.y,b[1]=this.z*a.x-this.x*a.z,b[2]=this.x*a.y-this.y*a.x):hb.panic(z),new $(b[0],b[1],b[2])},dot:function(a){return Array.isArray(a)&&3===a.length?this.x*a[0]+this.y*a[1]+this.z*a[2]:a instanceof $?this.x*a.x+this.y*a.y+this.z*a.z:(hb.panic(z),void 0)},scale:function(a,b,c){if(a instanceof $)this.x*=a.x,this.y*=a.y,this.z*=a.z;else if(Array.isArray(a)&&3===a.length)this.x*=a[0],this.y*=a[1],this.z*=a[2];else if("number"==typeof a){var d=a,e=a;"number"==typeof b&&"number"==typeof c&&(d=b,e=c),this.x*=a,this.y*=d,this.z*=e}else hb.panic(z);return this},subtract:function(a){return Array.isArray(a)&&3===a.length?(this.x-=a[0],this.y-=a[1],this.z-=a[2]):a instanceof $?(this.x-=a.x,this.y-=a.y,this.z-=a.z):hb.panic(z),this},add:function(a){return Array.isArray(a)&&3===a.length?(this.x+=a[0],this.y+=a[1],this.z+=a[2]):a instanceof $?(this.x+=a.x,this.y+=a.y,this.z+=a.z):hb.panic(z),this},debug:function(){O.line(0,0,0,this.x,this.y,this.z)}},g($,"Vector3D"),c.exports.Vector3D=$;var _=function(a){Array.isArray(a)&&9===a.length?this.elements=a:void 0==a?this.elements=[1,0,0,0,1,0,0,0,1]:hb.panic(z)};_.prototype={clone:function(){return new _(this.elements.slice())},equals:function(a){return f(this.elements[0],a.elements[0])&&f(this.elements[1],a.elements[1])&&f(this.elements[2],a.elements[2])&&f(this.elements[3],a.elements[3])&&f(this.elements[4],a.elements[4])&&f(this.elements[5],a.elements[5])&&f(this.elements[6],a.elements[6])&&f(this.elements[7],a.elements[7])&&f(this.elements[8],a.elements[8])},determinant:function(){return this.elements[0]*this.elements[4]*this.elements[8]+this.elements[1]*this.elements[5]*this.elements[6]+this.elements[2]*this.elements[3]*this.elements[7]-this.elements[2]*this.elements[4]*this.elements[6]-this.elements[1]*this.elements[3]*this.elements[8]-this.elements[0]*this.elements[5]*this.elements[7]},invert:function(){var a=this.determinant();if(0!==a){var b=[];b[0]=this.elements[4]*this.elements[8]-this.elements[5]*this.elements[7],b[1]=this.elements[2]*this.elements[7]-this.elements[1]*this.elements[8],b[2]=this.elements[1]*this.elements[5]-this.elements[2]*this.elements[4],b[3]=this.elements[5]*this.elements[6]-this.elements[3]*this.elements[8],b[4]=this.elements[0]*this.elements[8]-this.elements[2]*this.elements[6],b[5]=this.elements[2]*this.elements[3]-this.elements[0]*this.elements[5],b[6]=this.elements[3]*this.elements[7]-this.elements[4]*this.elements[6],b[7]=this.elements[1]*this.elements[6]-this.elements[0]*this.elements[7],b[8]=this.elements[0]*this.elements[4]-this.elements[1]*this.elements[3];for(var c=1/a,d=0;d<this.elements.length;d++)this.elements[d]=c*b[d]}return this},transform:function(a){var b=[];a instanceof _?b=a.elements:Array.isArray(a)&&9===a.length?b=a:hb.panic(z);var c=this.elements.slice();return this.elements[0]=c[0]*b[0]+c[1]*b[3]+c[2]*b[6],this.elements[1]=c[0]*b[1]+c[1]*b[4]+c[2]*b[7],this.elements[2]=c[0]*b[2]+c[1]*b[5]+c[2]*b[8],this.elements[3]=c[3]*b[0]+c[4]*b[3]+c[5]*b[6],this.elements[4]=c[3]*b[1]+c[4]*b[4]+c[5]*b[7],this.elements[5]=c[3]*b[2]+c[4]*b[5]+c[5]*b[8],this.elements[6]=c[6]*b[0]+c[7]*b[3]+c[8]*b[6],this.elements[7]=c[6]*b[1]+c[7]*b[4]+c[8]*b[7],this.elements[8]=c[6]*b[2]+c[7]*b[5]+c[8]*b[8],this},identity:function(){return this.elements=[1,0,0,0,1,0,0,0,1],this},scaling:function(a,b){return a instanceof Z?(this.elements[0]=a.x,this.elements[4]=a.y):Array.isArray(a)&&2===a.length?(this.elements[0]=a[0],this.elements[4]=a[1]):"number"==typeof a&&"number"==typeof b?(this.elements[0]=a,this.elements[4]=b):hb.panic(z),this},translation:function(a,b){return a instanceof Z?(this.elements[6]=a.x,this.elements[7]=a.y):Array.isArray(a)&&2===a.length?(this.elements[6]=a[0],this.elements[7]=a[1]):"number"==typeof a&&"number"==typeof b?(this.elements[6]=a,this.elements[7]=b):hb.panic(z),this},rotation:function(a,b,c){var d=0,e=0;"number"!=typeof a&&hb.panic(z),void 0!==b&&(b instanceof X?(d=b.x,e=b.y):Array.isArray(b)&&2===b.length?(d=b[0],e=b[1]):"number"==typeof b&&"number"==typeof c?(d=b,e=c):hb.panic(z)),(0!==d||0!==e)&&this.transform([1,0,0,0,1,0,-d,-e,1]);var f=Math.cos(a),g=Math.sin(a);return this.transform([f,g,0,-g,f,0,0,0,1]),(0!==d||0!==e)&&this.transform([1,0,0,0,1,0,d,e,1]),this}},g(_,"Matrix2D"),c.exports.Matrix2D=_;var ab=function(a){Array.isArray(a)&&16===a.length?this.elements=a:void 0==a?this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:hb.panic(z)};ab.prototype={clone:function(){return new ab(this.elements.slice())},equals:function(a){return f(this.elements[0],a.elements[0])&&f(this.elements[1],a.elements[1])&&f(this.elements[2],a.elements[2])&&f(this.elements[3],a.elements[3])&&f(this.elements[4],a.elements[4])&&f(this.elements[5],a.elements[5])&&f(this.elements[6],a.elements[6])&&f(this.elements[7],a.elements[7])&&f(this.elements[8],a.elements[8])&&f(this.elements[9],a.elements[9])&&f(this.elements[10],a.elements[10])&&f(this.elements[11],a.elements[11])&&f(this.elements[12],a.elements[12])&&f(this.elements[13],a.elements[13])&&f(this.elements[14],a.elements[14])&&f(this.elements[15],a.elements[15])},determinant:function(){var a=[],b=[],c=this.elements;return b[0]=c[10]*c[15]-c[11]*c[14],b[1]=c[9]*c[15]-c[11]*c[13],b[2]=c[9]*c[14]-c[10]*c[13],b[3]=c[8]*c[15]-c[11]*c[12],b[4]=c[8]*c[14]-c[10]*c[12],b[5]=c[8]*c[13]-c[9]*c[12],a[0]=c[5]*b[0]-c[6]*b[1]+c[7]*b[2],a[1]=c[6]*b[3]-c[4]*b[0]-c[7]*b[4],a[2]=c[4]*b[1]-c[5]*b[3]+c[7]*b[5],a[3]=c[5]*b[4]-c[4]*b[2]-c[6]*b[5],c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3]},invert:function(){var a=[],b=[],c=this.elements;b[0]=c[10]*c[15]-c[11]*c[14],b[1]=c[9]*c[15]-c[11]*c[13],b[2]=c[9]*c[14]-c[10]*c[13],b[3]=c[8]*c[15]-c[11]*c[12],b[4]=c[8]*c[14]-c[10]*c[12],b[5]=c[8]*c[13]-c[9]*c[12],a[0]=c[5]*b[0]-c[6]*b[1]+c[7]*b[2],a[4]=c[6]*b[3]-c[4]*b[0]-c[7]*b[4],a[8]=c[4]*b[1]-c[5]*b[3]+c[7]*b[5],a[12]=c[5]*b[4]-c[4]*b[2]-c[6]*b[5],a[1]=c[2]*b[1]-c[1]*b[0]-c[3]*b[2],a[5]=c[0]*b[0]-c[2]*b[3]+c[3]*b[4],a[9]=c[1]*b[3]-c[0]*b[1]-c[3]*b[5],a[13]=c[0]*b[2]-c[1]*b[4]+c[2]*b[5],b[6]=c[2]*c[7]-c[3]*c[6],b[7]=c[1]*c[7]-c[3]*c[5],b[8]=c[1]*c[6]-c[2]*c[5],b[9]=c[0]*c[7]-c[3]*c[4],b[10]=c[0]*c[6]-c[2]*c[4],b[11]=c[0]*c[5]-c[1]*c[4],a[2]=c[13]*b[6]-c[14]*b[7]+c[15]*b[8],a[6]=c[14]*b[9]-c[12]*b[6]-c[15]*b[10],a[10]=c[12]*b[7]-c[13]*b[9]+c[15]*b[11],a[14]=c[13]*b[10]-c[12]*b[8]-c[14]*b[11],a[3]=c[10]*b[7]-c[9]*b[6]-c[11]*b[8],a[7]=c[8]*b[6]-c[10]*b[9]+c[11]*b[10],a[11]=c[9]*b[9]-c[8]*b[7]-c[11]*b[11],a[15]=c[8]*b[8]-c[9]*b[10]+c[10]*b[11];var d=c[0]*a[0]+c[1]*a[4]+c[2]*a[8]+c[3]*a[12];if(0!==d)for(var e=1/d,f=0;16>f;f++)this.elements[f]=a[f]*e;return this},transform:function(a){var b=[];a instanceof ab?b=a.elements:Array.isArray(a)&&16===a.length?b=a:hb.panic(z);var c=this.elements.slice();return this.elements[0]=c[0]*b[0]+c[1]*b[4]+c[2]*b[8]+c[3]*b[12],this.elements[1]=c[0]*b[1]+c[1]*b[5]+c[2]*b[9]+c[3]*b[13],this.elements[2]=c[0]*b[2]+c[1]*b[6]+c[2]*b[10]+c[3]*b[14],this.elements[3]=c[0]*b[3]+c[1]*b[7]+c[2]*b[11]+c[3]*b[15],this.elements[4]=c[4]*b[0]+c[5]*b[4]+c[6]*b[8]+c[7]*b[12],this.elements[5]=c[4]*b[1]+c[5]*b[5]+c[6]*b[9]+c[7]*b[13],this.elements[6]=c[4]*b[2]+c[5]*b[6]+c[6]*b[10]+c[7]*b[14],this.elements[7]=c[4]*b[3]+c[5]*b[7]+c[6]*b[11]+c[7]*b[15],this.elements[8]=c[8]*b[0]+c[9]*b[4]+c[10]*b[8]+c[11]*b[12],this.elements[9]=c[8]*b[1]+c[9]*b[5]+c[10]*b[9]+c[11]*b[13],this.elements[10]=c[8]*b[2]+c[9]*b[6]+c[10]*b[10]+c[11]*b[14],this.elements[11]=c[8]*b[3]+c[9]*b[7]+c[10]*b[11]+c[11]*b[15],this.elements[12]=c[12]*b[0]+c[13]*b[4]+c[14]*b[8]+c[15]*b[12],this.elements[13]=c[12]*b[1]+c[13]*b[5]+c[14]*b[9]+c[15]*b[13],this.elements[14]=c[12]*b[2]+c[13]*b[6]+c[14]*b[10]+c[15]*b[14],this.elements[15]=c[12]*b[3]+c[13]*b[7]+c[14]*b[11]+c[15]*b[15],this},identity:function(){return this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this},scaling:function(a,b,c){return a instanceof $?(this.elements[0]=a.x,this.elements[5]=a.y,this.elements[10]=a.z):Array.isArray(a)&&3===a.length?(this.elements[0]=a[0],this.elements[5]=a[1],this.elements[10]=a[2]):"number"==typeof a&&"undefined"==typeof b?(this.elements[0]=a,this.elements[5]=a,this.elements[10]=a):"number"==typeof a&&"number"==typeof b&&"number"==typeof c?(this.elements[0]=a,this.elements[5]=b,this.elements[10]=c):hb.panic(z),this},translation:function(a,b,c){return a instanceof $?(this.elements[12]=a.x,this.elements[13]=a.y,this.elements[14]=a.z):Array.isArray(a)&&3===a.length?(this.elements[12]=a[0],this.elements[13]=a[1],this.elements[14]=a[2]):"number"==typeof a&&"undefined"==typeof b?(this.elements[12]=a,this.elements[13]=a,this.elements[14]=a):"number"==typeof a&&"number"==typeof b&&"number"==typeof c?(this.elements[12]=a,this.elements[13]=b,this.elements[14]=c):hb.panic(z),this},rotationX:function(a){"number"!=typeof a&&hb.panic(z);var b=Math.sin(a),c=Math.cos(a);return this.elements[5]=c,this.elements[6]=b,this.elements[9]=-b,this.elements[10]=c,this},rotationY:function(a){"number"!=typeof a&&hb.panic(z);var b=Math.sin(a),c=Math.cos(a);return this.elements[0]=c,this.elements[2]=-b,this.elements[8]=b,this.elements[10]=c,this},rotationZ:function(a){"number"!=typeof a&&hb.panic(z);var b=Math.sin(a),c=Math.cos(a);return this.elements[0]=c,this.elements[1]=b,this.elements[4]=-b,this.elements[5]=c,this},coordinateSystem:function(a,b,c,d){return this.elements[0]=b.x,this.elements[1]=b.y,this.elements[2]=b.z,this.elements[3]=0,this.elements[4]=c.x,this.elements[5]=c.y,this.elements[6]=c.z,this.elements[7]=0,this.elements[8]=d.x,this.elements[9]=d.y,this.elements[10]=d.z,this.elements[11]=0,this.elements[12]=a.x,this.elements[13]=a.y,this.elements[14]=a.z,this.elements[15]=1,this},toJSON:function(){return this.elements}},g(ab,"Matrix3D"),c.exports.Matrix3D=ab;var bb=function(a,b){W.call(this,a,b),Object.defineProperty(this,"start",{get:function(){return this.path._impl._startPointOfCurve(this.index)},set:function(a){return this.path._impl._startPointOfCurve(this.index,a)},enumerable:!0}),Object.defineProperty(this,"end",{get:function(){return this.path._impl._endPointOfCurve(this.index)},set:function(a){return this.path._impl._endPointOfCurve(this.index,a)},enumerable:!0})};bb.prototype=new W,g(bb,"Line2D"),bb.prototype.distanceTo=function(a){var b=function(a,b){return(a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y)},c=this.start,d=this.end,e=b(c,d);if(0===e)return Math.sqrt(b(c,a));var f=((a.x-c.x)*(d.x-c.x)+(a.y-c.y)*(d.y-c.y))/e;return 0>f?Math.sqrt(b(a,c)):f>1?Math.sqrt(b(a,d)):Math.sqrt(b(a,{x:c.x+f*(d.x-c.x),y:c.y+f*(d.y-c.y)}))},bb.prototype.move=function(a,b){return this.start=this.start.move(a,b),this.end=this.end.move(a,b),this},bb.prototype.transform=function(a){return this.start=this.start.transform(a),this.end=this.end.transform(a),this},c.exports.Line2D=bb;var cb=function(a,b){W.call(this,a,b),Object.defineProperty(this,"start",{get:function(){return this.path._impl._startPointOfCurve(this.index)},set:function(a){return this.path._impl._startPointOfCurve(this.index,a)},enumerable:!0}),Object.defineProperty(this,"end",{get:function(){return this.path._impl._endPointOfCurve(this.index)},set:function(a){return this.path._impl._endPointOfCurve(this.index,a)},enumerable:!0}),Object.defineProperty(this,"controlPoints",{get:function(){return this.path._impl._controlPointsOfCurve(this.index)},set:function(a){return this.path._impl._controlPointsOfCurve(this.index,a)},enumerable:!0})};cb.prototype=new W,g(cb,"Bezier2D"),cb.prototype.distanceTo=function(a,b){var c=b?b:A(),d=Number.MAX_VALUE,e={};e.dist=d;var f=this.start,g=this.end,h=this.controlPoints,i=h.length,j={},k={};if(1===i){var l=h[0];j.x=f.x+2/3*(l.x-f.x),j.y=f.y+2/3*(l.y-f.y),k.x=g.x+2/3*(l.x-g.x),k.y=g.y+2/3*(l.y-g.y)}else 2===i?(j=h[0],k=h[1]):hb.panic("Bezier2D has an unsupported number of control points.");return this.path._impl._bezierDistToPoint(e,c,f.x,f.y,j.x,j.y,k.x,k.y,g.x,g.y,a.x,a.y,0),e.dist},cb.prototype.move=function(a,b){this.start=this.start.move(a,b),this.end=this.end.move(a,b);for(var c=this.controlPoints,d=[],e=0;e<c.length;e++)d.push(c[e].move(a,b));return this.controlPoints=d,this},cb.prototype.rotate=function(a,b,c){this.start=this.start.rotate(a,b,c),this.end=this.end.rotate(a,b,c);for(var d=this.controlPoints,e=[],f=0;f<d.length;f++)e.push(d[f].rotate(a,b,c));return this.controlPoints=e,this},cb.prototype.transform=function(a){this.start=this.start.transform(a),this.end=this.end.transform(a);for(var b=this.controlPoints,c=[],d=0;d<b.length;d++)c.push(b[d].transform(a));return this.controlPoints=c,this},c.exports.Bezier2D=cb;var db=function(){this._curveData=[],this._curveStarts=[]};db.prototype={_toPolygons:function(a){for(var b=a||e(),c=[],d=[],f=this._curveData,g={},h=0;h<this._curveStarts.length;h++){var i=this._curveStarts[h];switch(f[i]){case fb.MoveTo||fb.MoveToEx:d.length>2&&c.push(d),d=[],g.x=f[i+1],g.y=f[i+2],d.push(g.x,g.y);break;case fb.LineTo:g.x=f[i+1],g.y=f[i+2],d.push(g.x,g.y);break;case fb.QuadraticCurveTo:var j={},k={},l={},m={};j.x=f[i+1],j.y=f[i+2],m.x=f[i+3],m.y=f[i+4],k.x=g.x+2/3*(j.x-g.x),k.y=g.y+2/3*(j.y-g.y),l.x=m.x+2/3*(j.x-m.x),l.y=m.y+2/3*(j.y-m.y),this._cubicBezierRecursive(d,b,g.x,g.y,k.x,k.y,l.x,l.y,m.x,m.y,0),g.x=m.x,g.y=m.y;break;case fb.BezierCurveTo:this._cubicBezierRecursive(d,b,g.x,g.y,f[i+1],f[i+2],f[i+3],f[i+4],f[i+5],f[i+6],0),g.x=f[i+5],g.y=f[i+6]}}return d.length>0&&c.push(d),c},_distPtToSeg:function(a,b,c,d,e,f){var g=e-c,h=f-d,i=a-c,j=b-d,k=g*g+h*h,l=g*i+h*j;return k>0&&(l/=k),0>l?l=0:l>1&&(l=1),i=c+l*g-a,j=d+l*h-b,i*i+j*j},_cubicBezierRecursive:function(a,b,c,d,e,f,g,h,i,j,k){if(!(k>18)){var l=.5*(c+e),m=.5*(d+f),n=.5*(e+g),o=.5*(f+h),p=.5*(g+i),q=.5*(h+j),r=.5*(l+n),s=.5*(m+o),t=.5*(n+p),u=.5*(o+q),v=.5*(r+t),w=.5*(s+u),x=this._distPtToSeg(v,w,c,d,i,j);x>b*b?(this._cubicBezierRecursive(a,b,c,d,l,m,r,s,v,w,k+1),this._cubicBezierRecursive(a,b,v,w,t,u,p,q,i,j,k+1)):a.push(i,j)}},_bezierDistToPoint:function(a,b,c,d,e,f,g,h,i,j,k,l,m){if(!(m>18)){var n=.5*(c+e),o=.5*(d+f),p=.5*(e+g),q=.5*(f+h),r=.5*(g+i),s=.5*(h+j),t=.5*(n+p),u=.5*(o+q),v=.5*(p+r),w=.5*(q+s),x=.5*(t+v),y=.5*(u+w),z=Math.sqrt((x-k)*(x-k)+(y-l)*(y-l));if(b>z)return a.dist=z,void 0;z<a.dist&&(a.dist=z),this._bezierDistToPoint(a,b,c,d,n,o,t,u,x,y,k,l,m+1),this._bezierDistToPoint(a,b,x,y,v,w,r,s,i,j,k,l,m+1)}},_coincideWithEndPoint:function(a,b){var c=new X(a,b),d=this._curveStarts.length-1;if(d>-1){var e=this._curveStarts[d],f=-1;switch(this._curveData[e]){case fb.LineTo||fb.MoveTo||fb.MoveToEx:f=e+1;break;case fb.QuadraticCurveTo:f=e+3;break;case fb.BezierCurveTo:f=e+5}if(f>-1){var g=new X(this._curveData[f],this._curveData[f+1]);if(c.distanceTo(g)<A())return!0}}return!1},_isRemoved:function(a){if(0>a||a>this._curveStarts.length-1)return!0;var b=this._curveStarts[a],c=this._curveData[b];return c===fb.MoveTo||c===fb.MoveToEx?!0:!1},_removeCurve:function(a){var b=this._curveStarts[a],c=this._curveData;switch(c[b]){case fb.LineTo:c[b]=fb.MoveTo;break;case fb.QuadraticCurveTo:c[b]=fb.MoveToEx,c[b+1]=c[b+3],c[b+2]=c[b+4],c[b+3]=2,c[b+4]=0;break;case fb.BezierCurveTo:c[b]=fb.MoveToEx,c[b+1]=c[b+5],c[b+2]=c[b+6],c[b+3]=4,c[b+4]=0,c[b+5]=0,c[b+6]=0}},_nextCurve:function(a){var b=a?a:-1,c=this._curveStarts.length;if(a>=c)return-1;for(var d=this._curveData,e=b+1;c>e;e++){var b=this._curveStarts[e];if(d[b]===fb.LineTo||d[b]===fb.QuadraticCurveTo||d[b]===fb.BezierCurveTo)return e}return-1},_prevCurve:function(a){var b=this._curveStarts.length,c=a?a:b;if(a>=b||1>a)return-1;for(var d=this._curveData,e=c-1;e>-1;e--){var c=this._curveStarts[e];if(d[c]===fb.LineTo||d[c]===fb.QuadraticCurveTo||d[c]===fb.BezierCurveTo)return e}return-1},_endPosOfCurve:function(a){var b=this._curveStarts[a],c=this._curveData[b],d=-1;return c===fb.LineTo||c===fb.MoveTo||c===fb.MoveToEx?d=b+1:c===fb.QuadraticCurveTo?d=b+3:c===fb.BezierCurveTo&&(d=b+5),d},_isClosed:function(){var a=this._curveStarts.length,b=this._curveData;if(a>1){var c=this._endPosOfCurve(0),d=this._endPosOfCurve(a-1);if(b[c]===b[d]&&b[c+1]===b[d+1])return!0}return!1},_endPointOfCurve:function(a,b){var c=this._endPosOfCurve(a);if(!(0>c||c>this._curveData.length-2)){if(b){var d=this._curveStarts.length;if((0===a||d-1===a)&&this._isClosed()){var e=this._endPosOfCurve(d-1-a);this._curveData[e]=b.x,this._curveData[e+1]=b.y}return this._curveData[c]=b.x,this._curveData[c+1]=b.y,void 0}return new X(this._curveData[c],this._curveData[c+1])}},_startPointOfCurve:function(a,b){var c=a-1;if(!(0>c||c>this._curveStarts.length-1))return this._endPointOfCurve(c,b)},_controlPointsOfCurve:function(a,b){var c=this,d=function(a){var b=c._curveStarts[a],d=c._curveData[b],e=-1,f=0;return d===fb.QuadraticCurveTo?(e=b+1,f=1):d===fb.BezierCurveTo&&(e=b+1,f=2),[e,f]},e=d(a);if(-1!==e[0]){if(!b){for(var f=[],g=e[1],h=0;g>h;h++)f.push(new X(this._curveData[e[0]+2*h],this._curveData[e[0]+2*h+1]));return f}if(b.length===e[1])for(var h=0;h<b.length;h++)this._curveData[e[0]+2*h]=b[h].x,this._curveData[e[0]+2*h+1]=b[h].y}}};var eb=function(a){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new db}),a&&a.data&&a.starts&&(this._impl._curveData=a.data.slice(0),this._impl._curveStarts=a.starts.slice(0))};eb.prototype={moveTo:function(a,b){(2!==arguments.length||"number"!=typeof arguments[0]||"number"!=typeof arguments[1])&&hb.panic(z);var c=this._impl;return c._coincideWithEndPoint(a,b)||(c._curveStarts.push(c._curveData.length),c._curveData.push(fb.MoveTo),c._curveData.push(a,b)),this},lineTo:function(a,b){if(2!==arguments.length||"number"!=typeof arguments[0]||"number"!=typeof arguments[1])return hb.warning(z),this;var c=this._impl;return c._coincideWithEndPoint(a,b)||(c._curveStarts.push(c._curveData.length),c._curveData.push(fb.LineTo),c._curveData.push(a,b)),this},bezierCurveTo:function(a,b,c,d,e,f){(6!==arguments.length||"number"!=typeof arguments[0]||"number"!=typeof arguments[1]||"number"!=typeof arguments[2]||"number"!=typeof arguments[3]||"number"!=typeof arguments[4]||"number"!=typeof arguments[5])&&hb.panic(z);var g=this._impl;return g._coincideWithEndPoint(e,f)||(g._curveStarts.push(g._curveData.length),g._curveData.push(fb.BezierCurveTo),g._curveData.push(a,b,c,d,e,f)),this},quadraticCurveTo:function(a,b,c,d){(4!==arguments.length||"number"!=typeof arguments[0]||"number"!=typeof arguments[1]||"number"!=typeof arguments[2]||"number"!=typeof arguments[3])&&hb.panic(z);var e=this._impl;return e._coincideWithEndPoint(c,d)||(e._curveStarts.push(e._curveData.length),e._curveData.push(fb.QuadraticCurveTo),e._curveData.push(a,b,c,d)),this},close:function(){for(var a=this._impl,b=a._curveStarts.length,c=b-1;c>=0;c--){var d=a._curveStarts[c];if(fb.MoveTo===a._curveData[d]){if(b-1!==c){this.lineTo(a._curveData[d+1],a._curveData[d+2]);break}break}}return this},toPolygons:function(a){return this._impl._toPolygons(a)},curvesByPoint:function(a,b){for(var c=[],d=this.firstCurve();d;){var e=!1,f=d.distanceTo(a);if(b>=f)e=!0;else if(d instanceof cb)for(var g=d.controlPoints,h=g.length,i=0;h>i;i++)if(f=a.distanceTo(g[i]),b>=f){e=!0;break}if(e){var j={dist:f,curve:d};c.push(j)}d=d.next()}c.sort(function(a,b){return b.dist-a.dist});for(var i=0;i<c.length;i++)c[i]=c[i].curve;return c},curveAt:function(a){var b=this._impl;if(0>a||a>b._curveStarts.length-1)return void 0;var c=b._curveStarts[a],d=b._curveData[c],e=void 0;return d===fb.LineTo?e=new bb(a,this):(d===fb.QuadraticCurveTo||d===fb.BezierCurveTo)&&(e=new cb(a,this)),e},firstCurve:function(){var a=this._impl._nextCurve();return this.curveAt(a)},lastCurve:function(){var a=this._impl._prevCurve();return this.curveAt(a)},toJSON:function(){return{data:this._impl._curveData,starts:this._impl._curveStarts}},transform:function(a){var b;Array.isArray(a)&&9===a.length?b=new _(a):a instanceof _?b=a:hb.panic(z);for(var c=new X(0,0),d=this._impl._curveStarts,e=this._impl._curveData,f=0;f<d.length;f++){var g=d[f];switch(e[g]){case fb.LineTo:case fb.MoveTo:case fb.MoveToEx:c.x=e[g+1],c.y=e[g+2],c.transform(b),e[g+1]=c.x,e[g+2]=c.y;break;case fb.QuadraticCurveTo:c.x=e[g+1],c.y=e[g+2],c.transform(b),e[g+1]=c.x,e[g+2]=c.y,c.x=e[g+3],c.y=e[g+4],c.transform(b),e[g+3]=c.x,e[g+4]=c.y;
break;case fb.BezierCurveTo:c.x=e[g+1],c.y=e[g+2],c.transform(b),e[g+1]=c.x,e[g+2]=c.y,c.x=e[g+3],c.y=e[g+4],c.transform(b),e[g+3]=c.x,e[g+4]=c.y,c.x=e[g+5],c.y=e[g+6],c.transform(b),e[g+5]=c.x,e[g+6]=c.y}}return this},clone:function(){var a=new eb;return a._impl._curveData=this._impl._curveData.slice(0),a._impl._curveStarts=this._impl._curveStarts.slice(0),a}};var fb={MoveTo:"M",LineTo:"L",QuadraticCurveTo:"Q",BezierCurveTo:"B",MoveToEx:"E"};g(eb,"Path2D"),c.exports.Path2D=eb;var gb={_warningBuffer:a.getVariable(["outcomes","warnings"],[]),_panicString:void 0,_addWarning:function(a){return this._warningBuffer.push(a),this},_panic:function(b){a.setVariable(["outcomes","panic"],b);var c=a.getVariable(["callbacks","panic"]);return c&&c(b),this}},hb={warning:function(a){return a&&"function"==typeof a.toString&&gb._addWarning(a.toString()),this},panic:function(a){return a&&"function"==typeof a.toString&&gb._panic(a.toString()),this}};Object.defineProperty(hb,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:gb}),c.exports.Plugin=hb,g(hb,"Plugin");var ib={extrude:function(a,b){2===arguments.length&&(Array.isArray(arguments[0])||arguments[0]instanceof rb)&&"number"==typeof arguments[1]||hb.panic(z);var c=yb.extrude({geometry:a,distance:b,start:!0,end:!0,sides:!0}),d=new kb(c);return d},make:function(a){var b=new kb(a);return b}};c.exports.Solid=ib,g(ib,"Solid");var jb=function(a){this._mesh=a},kb=function(a){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new jb(a)}),Object.defineProperty(this,"mesh",{get:function(){return this._impl._mesh},enumerable:!0})};kb.prototype={transform:function(a){return this._impl._mesh.transform(a),this},toJSON:function(){var a=this._impl._mesh,b={};if(a){var c=a.bounds();if(c){var d=c.min,e=c.max;b.Verts=a._impl._vertices,b.Tris=a._impl._triangles,b.Bounds=[d.x,d.y,d.z,e.x,e.y,e.z]}}return b}},g(kb,"Solid3D"),c.exports.Solid3D=kb;var lb=void 0,mb={circleDivisions:function(a){("number"!=typeof a||a<A())&&hb.panic(z);var b=2*Math.acos(a/(a+mb.tolerance())),c=parseInt(Math.ceil(2*Math.PI/b));return c=4*parseInt((c+3)/4),4>c?4:c},tolerance:function(){return e()},boundariesFromContours:function(a,b){var c=void 0==b?P.NonZero:b,d=xb._extractBoundaryContours(a,c);return d},polygonsFromBoundaries:function(a){var b=xb._extractPolygons(a,P.NonZero),c=b.vertices,d=[],e=[],f=0,g=b.elements,h=g.length;for(f=0;h>f;f+=6){d.push(g[f],g[f+1],g[f+2]);for(var i=0;3>i;i++)if(-1==g[f+i+3]){var j=g[f+i],k=g[f+(i+1)%3];e.push(j),e.push(k)}}return{vertices:c,triangleIndices:d,boundaryIndices:e}}};c.exports.Tess=mb,g(mb,"Tess");var nb=function(a,b){this.min=a,this.max=b};nb.prototype={length:function(){return this.max.x-this.min.x},width:function(){return this.max.y-this.min.y},center:function(){return new X(.5*(this.max.x+this.min.x),.5*(this.max.y+this.min.y))},clone:function(){var a=this.min.clone(),b=this.max.clone();return new nb(a,b)},debug:function(){var a=this.min.x,b=this.min.y,c=this.max.x,d=this.max.y;O.line(a,b,0,c,b,0),O.line(c,b,0,c,d,0),O.line(c,d,0,a,d,0),O.line(a,d,0,a,b,0)}},g(nb,"Box2D"),c.exports.Box2D=nb;var ob=function(a,b){this.min=a,this.max=b};ob.prototype={length:function(){return Math.max(this.max.x-this.min.x,0)},width:function(){return Math.max(this.max.y-this.min.y,0)},height:function(){return Math.max(this.max.z-this.min.z,0)},center:function(){return new Y(.5*(this.max.x+this.min.x),.5*(this.max.y+this.min.y),.5*(this.max.z+this.min.z))},clone:function(){var a=this.min.clone(),b=this.max.clone();return new ob(a,b)},debug:function(){var a=this.min.x,b=this.min.y,c=this.min.z,d=this.max.x,e=this.max.y,f=this.max.z;O.line(a,b,c,d,b,c),O.line(d,b,c,d,e,c),O.line(d,e,c,a,e,c),O.line(a,e,c,a,b,c),O.line(a,b,f,d,b,f),O.line(d,b,f,d,e,f),O.line(d,e,f,a,e,f),O.line(a,e,f,a,b,f),O.line(d,b,c,d,b,f),O.line(a,b,f,a,b,c),O.line(d,e,c,d,e,f),O.line(a,e,f,a,e,c)}},g(ob,"Box3D"),c.exports.Box3D=ob;var pb=function(a,b){this.origin=a,this.direction=b};pb.prototype={clone:function(){var a=this.direction.clone(),b=this.origin.clone();return new pb(b,a)},debug:function(){var a=this.direction,b=this.origin;O.line(b.x,b.y,b.z,b.x+a.x,b.y+a.y,b.z+a.z)}},g(pb,"Ray3D"),c.exports.Ray3D=pb;var qb=function(){this.paths=[]};qb.prototype={_bounds:function(){for(var a=Number.MAX_VALUE,b=-Number.MAX_VALUE,c=Number.MAX_VALUE,d=-Number.MAX_VALUE,e=0,f=this.paths.length;f>e;e++)for(var g=this.paths[e].toPolygons(),h=0,i=g.length;i>h;h++)for(var j=g[h],k=0,l=j.length;l>k;k+=2){var m=j[k],n=j[k+1];a>m&&(a=m),m>b&&(b=m),c>n&&(c=n),n>d&&(d=n)}var o=void 0;return b>a&&d>c&&(o=new nb(new X(a,c),new X(b,d))),o}};var rb=function(a){if(Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new qb}),Object.defineProperty(this,"paths",{get:function(){var a=this._impl.paths.slice(0);return a},enumerable:!0}),a)if(Array.isArray(a))for(var b=this._impl.paths,c=0,d=a.length;d>c;c++){var e=a[c];e instanceof eb&&b.push(e)}else if(a instanceof rb)for(var b=a._impl.paths,f=this._impl.paths,c=0;c<b.length;c++)f.push(b[c].clone());else for(var g=0;g<a.paths.length;g++){var h=new eb(a.paths[g]);this._impl.paths.push(h)}};rb.prototype={bounds:function(){return this._impl._bounds()},toPolygons:function(a){for(var b=[],c=this._impl.paths,d=0;d<c.length;d++)for(var e=c[d].toPolygons(a),f=0;f<e.length;f++)b.push(e[f]);return b},toJSON:function(){for(var a=[],b=this._impl.paths,c=0;c<b.length;c++)a.push(b[c].toJSON());return{paths:a}},transform:function(a){for(var b=this._impl.paths,c=0;c<b.length;c++){var d=b[c];d.transform(a)}return this},clone:function(){for(var a=new rb,b=this._impl.paths,c=a._impl.paths,d=0;d<b.length;d++)c.push(b[d].clone());return a},projectBoundary:function(a,b){a instanceof ub&&b instanceof ab||hb.panic(z);var c=a.mesh,d=a.vertexIndices,e=b.elements,f=function(a){var b=c.vertexByIndex(a),d={x:b[0],y:b[1],z:b[2]},f=d.x*e[0]+d.y*e[4]+d.z*e[8]+e[12],g=d.x*e[1]+d.y*e[5]+d.z*e[9]+e[13];return{x:f,y:g}},g=new eb,h=f(d[0]);g.moveTo(h.x,h.y);for(var i=1,j=d.length;j>i;i++)h=f(d[i]),g.lineTo(h.x,h.y);return d[0]!=d[d.length-1]&&(h=f(d[0]),g.lineTo(h.x,h.y)),this._impl.paths.push(g),this},combine:function(a){var b=this._impl.paths;if(Array.isArray(a))for(var c=0,d=a.length;d>c;c++)Array.prototype.push.apply(b,a[c]._impl.paths);else Array.prototype.push.apply(b,a._impl.paths);return this}},Object.defineProperty(rb.prototype,"windingRule",{enumerable:!0,configurable:!1,get:function(){return void 0!==this._impl.windingRule?this._impl.windingRule:P.NonZero},set:function(a){var b=!1;for(var c in P)if(P[c]===a){b=!0;break}b||hb.panic("Invalid windingRule value."),this._impl.windingRule=a}}),g(rb,"Sketch2D"),c.exports.Sketch2D=rb,a.setVariable(["parameters","sketch","deserializer"],function(a){return new rb(a)});var sb=function(){this.selector=null,this.distance=Number.MAX_VALUE,this.collision=null},tb=function(a,b){sb.call(this),this.mesh=a,this.triangleIndices=b};tb.prototype={boundaries:function(){return this.mesh.boundariesByTriangles(this.triangleIndices)},expandByCoplanar:function(a){if(!this.mesh||!this.triangleIndices||0===this.triangleIndices.length)return this;void 0===a&&(a=1e-5);for(var b=this.triangleIndices[0],c=[b],d={},e=[],f=this.mesh,g=f._impl,h=g._vertices,i=g._triangles,j=g._triangleNormal(i,h,b),k=new $(j[0],j[1],j[2]),l=new $,m,n;c.length>0;){m=c.shift(),d[m]=!0,e.push(m);for(var o=f.trianglesByTriangle(m,!0),p=0;p<o.length;p++){var q=o[p];if(!d[q]){var r=g._triangleNormal(i,h,q);l.x=r[0],l.y=r[1],l.z=r[2],k.dot(l)>1-a&&c.push(q),d[q]=!0}}}return this.triangleIndices=e,this},clone:function(){return new tb(this.mesh,this.triangleIndices)},debug:function(){for(var a=[],b=this.triangleIndices,c=this.mesh,d=0;d<b.length;d++){var e=c.triangleByIndex(b[d]),f=c.vertexByIndex(e[0]),g=c.vertexByIndex(e[1]),h=c.vertexByIndex(e[2]);a.push(f[0],f[1],f[2],g[0],g[1],g[2],h[0],h[1],h[2])}O.triangles(a)}},g(tb,"Mesh3DSelection"),c.exports.Mesh3DSelection=tb;var ub=function(){this.vertexIndices=[],this.mesh=null};ub.prototype={debug:function(){if(this.mesh&&!(this.vertexIndices.length<3)){var a=this.mesh._impl._vertices,b=this.vertexIndices.slice(0);b[0]!=b[b.length-1]&&b.push(b[0]);for(var c=0,d=b.length-1;d>c;c++){var e=3*b[c],f=3*b[c+1];O.line(a[e],a[e+1],a[e+2],a[f],a[f+1],a[f+2])}}}},g(ub,"Mesh3DBoundary"),c.exports.Mesh3DBoundary=ub;var vb=function(){};vb.prototype={select:function(a){}};var wb=function(){this.ray=null,this.selections=[]};wb.prototype={selectionsByDistance:function(){var a=function(a,b){return a.distance>b.distance};return this.selections.sort(a),this.selections},debug:function(){this.ray.debug();for(var a=0,b=this.selections.length;b>a;a++)this.selections[a].debug()}},g(wb,"Selector"),c.exports.Selector=wb;var xb={_toContours:function(a){for(var b=[],c=0,d=a.length;d>c;c++)for(var e=a[c],f=e.toPolygons(),g=0,h=f.length;h>g;g++)b.push(f[g]);return b},_extractBoundaryContours:function(a,b){var c=p(),d=c.BOUNDARY_CONTOURS,e=2,f=2,g={contours:a,windingRule:b,elementType:c.BOUNDARY_CONTOURS,polySize:e,vertexSize:f,normal:[0,0,1]},h=c.tesselate(g);if(a=[],!h)return a;for(var i=h.vertexCount,j=h.vertices,k=h.elements,l=j.length,m=k.length,n=e,o=0;m>o;o+=n){for(var q=k[o],r=k[o+1],s=[],t=q*f,u=0;f*r>u;u++)s.push(j[t+u]);a.push(s)}return a},_extractPolygons:function(a,b){var c=p(),d={contours:a,windingRule:b,elementType:c.CONNECTED_POLYGONS,polySize:3,vertexSize:2,normal:[0,0,1]};return c.tesselate(d)},_contourBounds:function(a){for(var b=Number.MAX_VALUE,c=Number.MAX_VALUE,d=-Number.MAX_VALUE,e=-Number.MAX_VALUE,f=0,g=a.length;g>f;f+=2){var h=a[f],i=a[f+1];b=Math.min(b,h),c=Math.min(c,i),d=Math.max(d,h),e=Math.max(e,i)}return[b,c,d,e]},_contourContainment:function(a,b){function c(a,b,c){for(var d=!1,e=verts.length/2,f=0,g=e-1;e>f;g=f++){var h=c[2*f],i=c[2*f+1],j=c[2*g],k=c[2*g+1],l=i>b!=k>b&&(j-h)*(b-i)/(k-i)+h>a;l&&(d=!d)}return d}function d(a,b,c,d,e,f,g,h){var i=[c-a,d-b],j=[g-e,h-f],k=[e-a,f-b],l=k[0]*i[1]-k[1]*i[0],m=k[0]*j[1]-k[1]*j[0],n=i[0]*j[1]-i[1]*j[0];if(0==l&&0==n)return 0>e-a!=0>e-c!=0>g-a!=0>g-c||0>f-b!=0>f-d!=0>h-b!=0>h-d;if(0==n)return!1;var o=l/n,p=m/n;return p>=0&&1>=p&&o>=0&&1>=o}function e(a,b,c,d,e,f,g,h){return a>e&&b>f&&g>c&&h>d?1:-1}for(var f=this._contourBounds(a),g=0,h=b.length;h>g;g++){var i=b[g],j=this._contourBounds(i),k=e(f[0],f[1],f[2],f[3],j[0],j[1],j[2],j[3]);if(!(1==k&&c(j[0],j[1],a)&&c(j[0],j[3],a)&&c(j[2],j[3],a)&&c(j[2],j[1],a)))for(var l=0,m=a.length;m>l;l+=2)for(var n=0,o=i.length;o>n;n+=2){var p=d(a[l],a[l+1],a[l+2],a[l+3],i[n],i[n+1],i[n+2],i[n+3]);if(p)return-1}}return 1},_extrudeFromPolygons:function(a,b,c,d,e,f,g,h){for(var i=[],j=[],k=Math.max(0,d),l=Math.min(0,d),m=2,n=3,o=b.length,p=c.length,q=2*n,r=0;o>r;r+=m)i.push(b[r],b[r+1],k);if(0>d&&e||d>=0&&f)for(var s=0;p>s;s+=q)h?j.push(c[s+2],c[s+1],c[s]):j.push(c[s],c[s+1],c[s+2]);for(var r=0;o>r;r+=m)i.push(b[r],b[r+1],l);if(0>d&&f||d>=0&&e)for(var s=0;p>s;s+=q)h?j.push(c[s]+a,c[s+1]+a,c[s+2]+a):j.push(c[s+2]+a,c[s+1]+a,c[s]+a);if(g)for(var s=0;p>s;s+=q)for(var t=0;3>t;t++)if(-1==c[s+t+3]){var u=c[s+t],v=c[s+(t+1)%3];h?(j.push(v,v+a,u+a),j.push(u,v,u+a)):(j.push(u+a,v+a,v),j.push(u+a,v,u))}return{vertices:i,indices:j}},_emboss:function(a,b,c){var d=this,e=p(),f={_extrudeInBorder:function(a,b,c){for(var e=d._extractPolygons(b,P.EvenOdd),f=this._extrudePolygons(e,c),g=0;g<a.length;g++)b.push(a[g]);e=d._extractPolygons(b,P.EvenOdd);var h=this._toPolygons(e);return[{vertices:f.vertices,indices:f.indices},{vertices:h.vertices,indices:h.indices}]},_toPolygons:function(a){if(!a)return{vertices:[],indices:[]};for(var b=a.vertices,c=a.elements,d=[],e=[],f=2,g=3,h=b.length,i=c.length,j=2*g,k=0;h>k;k+=f)d.push(b[k],b[k+1],0);for(var l=0;i>l;l+=j)e.push(c[l],c[l+1],c[l+2]);return{vertices:d,indices:e}},_extrudePolygons:function(a,b){if(!a)return{vertices:[],indices:[]};var c=a.vertexCount,e=a.vertices,f=a.elements;return d._extrudeFromPolygons(c,e,f,b,!1,!0,!0,0>b)}};return f._extrudeInBorder(a,b,c)}},yb={extrude:function(a){var b=a.geometry,c=a.distance,d=a.start,e=a.end,f=a.sides,g,h;b instanceof rb?(g=b.paths,h=b.windingRule):Array.isArray(b)&&b.length>0&&b[0]instanceof eb&&(g=b),void 0===g&&hb.panic("The input geometry is invalid.");var i=xb._toContours(g);0===i.length&&hb.panic("No valid contours found on input geometry."),void 0===h&&(h=P.NonZero),i=xb._extractBoundaryContours(i,h),0===i.length&&hb.panic("No valid contours found on input geometry.");var j=xb._extractPolygons(i,P.NonZero),k=j.vertexCount,l=j.vertices,m=j.elements;0===m.length&&hb.panic("The input geometry does not have valid profiles.");var n=xb._extrudeFromPolygons(k,l,m,c,d,e,f);return(new R).indexedTriangles(n.vertices,n.indices)},emboss:function(a){var b=a.boundary,c=a.design,d=a.distance;b instanceof rb||hb.panic("The input boundary is not a Sketch2D object.");var e=xb._toContours(b.paths);c instanceof rb||hb.panic("The input design is not a Sketch2D object.");var f=xb._toContours(c.paths);f.length<1&&hb.panic("The input design is invalid."),e=xb._extractBoundaryContours(e,b.windingRule),f=xb._extractBoundaryContours(f,c.windingRule),0===f.length&&hb.panic("No valid contours found on input design.");var g=xb._emboss(e,f,d),h=new R;return g.forEach(function(a){h.indexedTriangles(a.vertices,a.indices)}),h}};g(yb,"Creation"),c.exports.Creation=yb,B.toSketch2DFromSVG=function(a){if(!a||a.length<5)return O.log("parseSVG: input string is empty (data len "+a.byteLength+")"),void 0;if(a=a.replace(/^[\s\uFEFF\xA0]+/g,""),0===a.length)return O.log("parseSVG: input string has only whitespace"),void 0;var b=a.substr(0,5);if("<?xml"!==b)return O.log("parseSVG: input string is not XML (missing header)"),void 0;var c=new zb,d=c.buildSvg(),e=new c.Context(d,x,eb),f=d.loadXml(e,a);return f||hb.panic("Failed to parse the svg data."),0==e.paths.length&&hb.panic("The imported SVG data seems to be empty."),new rb(e.paths)},B.toSketch2DFromText=function(a,b,c){if(!a||!b)return void 0;if(0===a.replace(/^\s+|\s+$/g,"").length)return void 0;if("string"==typeof b){if(c&&("number"!=typeof c||f(c,0)||0>c))return void 0;b=new Eb(b,c)}for(var d=[],e=0,g=(new _).identity(),h=0,i=a.length;i>h;h++){var j=a[h],k=b.glyphPaths(j);if(e&&k.length){g.translation(e,0);for(var l=0,m=k.length;m>l;l++)k[l].transform(g)}Array.prototype.push.apply(d,k),e+=b.glyphAdvance(j)}return new rb(d)},B.toMesh3DFromSTL=function(a){a instanceof DataView||hb.panic("The input STL data is not a DataView object.");var b=new R;return Ab.parseBinarySTL(a,b)?b:Ab.parseAsciiSTL(a,b)?b:void 0},B.toAsciiSTLFromMesh3D=function(a){a instanceof R||hb.panic("The input data is not a Mesh3D object.");var b=a._impl._vertices,c=a._impl._triangles,d="";d+="solid ascii\n";for(var e=c.length,f=0;e>f;f+=3){var g=3*c[f],h=3*c[f+1],i=3*c[f+2],j=a._impl._triangleNormal(c,b,f);d+="  facet normal "+j[0]+" "+j[1]+" "+j[2]+"\n",d+="    outer loop\n",d+="      vertex "+b[g]+" "+b[g+1]+" "+b[g+2]+"\n",d+="      vertex "+b[h]+" "+b[h+1]+" "+b[h+2]+"\n",d+="      vertex "+b[i]+" "+b[i+1]+" "+b[i+2]+"\n",d+="    endloop\n",d+="  endfacet\n"}return d+="endsolid\n"},B.toBinarySTLFromMesh3D=function(a){a instanceof R||hb.panic("The input data is not a Mesh3D object.");for(var b=a._impl._vertices,c=a._impl._triangles,d=new ArrayBuffer(84+50*(c.length/3)),e=new DataView(d),f=0;80>f;f++)e.setInt8(f,0);var g=!0;e.setUint32(80,c.length/3,g);for(var h=84,i,j,k=c.length,f=0;k>f;f+=3){i=a._impl._triangleNormal(c,b,f/3),e.setFloat32(h,i[0],g),h+=4,e.setFloat32(h,i[1],g),h+=4,e.setFloat32(h,i[2],g),h+=4;for(var l=0;3>l;l++)j=3*c[f+l],e.setFloat32(h,b[j],g),h+=4,e.setFloat32(h,b[j+1],g),h+=4,e.setFloat32(h,b[j+2],g),h+=4;e.setUint16(h,0,g),h+=2}return d},B.toBase64FromArrayBuffer=function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=new Uint8Array(a),e=d.byteLength,f=e%3,g=e-f,h,i,j,k,l,m=0;g>m;m+=3)l=d[m]<<16|d[m+1]<<8|d[m+2],h=(16515072&l)>>18,i=(258048&l)>>12,j=(4032&l)>>6,k=63&l,b+=c[h]+c[i]+c[j]+c[k];return 1==f?(l=d[g],h=(252&l)>>2,i=(3&l)<<4,b+=c[h]+c[i]+"=="):2==f&&(l=d[g]<<8|d[g+1],h=(64512&l)>>10,i=(1008&l)>>4,j=(15&l)<<2,b+=c[h]+c[i]+c[j]+"="),b},B.toArrayBufferFromBase64=function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=b.indexOf(a.charAt(a.length-1)),d=b.indexOf(a.charAt(a.length-2)),e=3*(a.length/4);64==c&&e--,64==d&&e--;var f=new ArrayBuffer(e),g=new Uint8Array(f),h,i,j,k,l,m,n,o=0,p=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,""),o=0;e>o;o+=3)k=b.indexOf(a.charAt(p++)),l=b.indexOf(a.charAt(p++)),m=b.indexOf(a.charAt(p++)),n=b.indexOf(a.charAt(p++)),h=k<<2|l>>4,i=(15&l)<<4|m>>2,j=(3&m)<<6|n,g[o]=h,64!=m&&(g[o+1]=i),64!=n&&(g[o+2]=j);return f};var zb=function(){function a(b){this.ok=!1,"#"==b.charAt(0)&&(b=b.substr(1,6)),b=b.replace(/ /g,""),b=b.toLowerCase();var c={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var d in c)b==d&&(b=c[d]);for(var e=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(a){return[parseInt(a[1]),parseInt(a[2]),parseInt(a[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}],f=0;f<e.length;f++){var g=e[f].re,h=e[f].process,i=g.exec(b);if(i){var j=h(i);this.r=j[0],this.g=j[1],this.b=j[2],this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var a=this.r.toString(16),b=this.g.toString(16),c=this.b.toString(16);return 1==a.length&&(a="0"+a),1==b.length&&(b="0"+b),1==c.length&&(c="0"+c),"#"+a+b+c},this.getHelpXML=function(){for(var b=new Array,d=0;d<e.length;d++)for(var f=e[d].example,g=0;g<f.length;g++)b[b.length]=f[g];for(var h in c)b[b.length]=h;var i=document.createElement("ul");i.setAttribute("id","rgbcolor-examples");for(var d=0;d<b.length;d++)try{var j=document.createElement("li"),k=new a(b[d]),l=document.createElement("div");l.style.cssText="margin: 3px; border: 1px solid black; background:"+k.toHex()+"; "+"color:"+k.toHex(),l.appendChild(document.createTextNode("test"));var m=document.createTextNode(" "+b[d]+" -> "+k.toRGB()+" -> "+k.toHex());j.appendChild(l),j.appendChild(m),i.appendChild(j)}catch(n){}return i}}function b(a,b,c){this.xmlParser=b,this.Path2D=c,this.paths=[],this.transformStack=[],this.styleStack=[],this.transformation=d.create(),this.bbox=new a.BoundingBox,this.lastPt=[0,0],d.identity(this.transformation),this.setDefaults=function(){this.strokeStyle="#000000",this.fillStyle="#000000",this.globalAlpha=1,this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.miterLimit=10,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0,this.shadowColor="rgba(0,0,0,0)",this.globalCompositeOperation="source-over",this.font="10px sans-serif",this.textAlign="start",this.textBaseline="alphabetic"},this.setDefaults(),this.getStyleObj=function(){var a={};return a.strokeStyle=this.strokeStyle,a.fillStyle=this.fillStyle,a.globalAlpha=this.globalAlpha,a.lineWidth=this.lineWidth,a.lineCap=this.lineCap,a.lineJoin=this.lineJoin,a.miterLimit=this.miterLimit,a.shadowOffsetX=this.shadowOffsetX,a.shadowOffsetY=this.shadowOffsetY,a.shadowBlur=this.shadowBlur,a.shadowColor=this.shadowColor,a.globalCompositeOperation=this.globalCompositeOperation,a.font=this.font,a.textAlign=this.textAlign,a.textBaseline=this.textBaseline,a},this.curPath=function(){return this.paths[this.paths.length-1]},this.save=function(a,b){var c=d.create();d.set(c,this.transformation),this.transformStack.push(c);var e=this.getStyleObj();this.styleStack.push(e)},this.restore=function(a,b){this.transformation=this.transformStack.pop();var c=this.transformation,d=this.styleStack.pop()},this.beginPath=function(){this.paths.push(new this.Path2D)},this.closePath=function(){var a=this.curPath();a.close()},this.clip=function(){O.log("! clip not implemented")},this.stroke=function(){},this.fill=function(){},this.moveTo=function(a,b){var c=[a,b];d.transformPoint(c,this.transformation,c);var e=this.curPath();e.moveTo(c[0],-c[1]),this.bbox.addPoint(c[0],-c[1]),this.lastPt[0]=c[0],this.lastPt[1]=-c[1]},this.lineTo=function(a,b){var c=[a,b];d.transformPoint(c,this.transformation,c);var e=this.curPath();e.lineTo(c[0],-c[1]),this.bbox.addPoint(c[0],-c[1]),this.lastPt[0]=c[0],this.lastPt[1]=-c[1]},this.quadraticCurveTo=function(a,b,c,e){var f=[c,e];d.transformPoint(f,this.transformation,f);var g=[a,b];d.transformPoint(g,this.transformation,g);var h=this.curPath();h.quadraticCurveTo(g[0],-g[1],f[0],-f[1]),this.bbox.addQuadraticCurve(this.lastPt[0],this.lastPt[1],g[0],-g[1],f[0],-f[1]),this.lastPt[0]=f[0],this.lastPt[1]=-f[1]},this.bezierCurveTo=function(a,b,c,e,f,g){var h=[f,g];d.transformPoint(h,this.transformation,h);var i=[a,b];d.transformPoint(i,this.transformation,i);var j=[c,e];d.transformPoint(j,this.transformation,j);var k=this.curPath();k.bezierCurveTo(i[0],-i[1],j[0],-j[1],h[0],-h[1]),this.bbox.addBezierCurve(this.lastPt[0],this.lastPt[1],i[0],-i[1],j[0],-j[1],h[0],-h[1]),this.lastPt[0]=h[0],this.lastPt[1]=-h[1]},this.rotate=function(a){var b=d.create([Math.cos(a),Math.sin(a),0,-Math.sin(a),Math.cos(a),0,0,0,1]);d.multiply(this.transformation,this.transformation,b)},this.scale=function(a,b){var c=d.create([a,0,0,0,b,0,0,0,1]);d.multiply(this.transformation,this.transformation,c)},this.setTransform=function(a,b,c,e,f,g){var h=d.create([a,c,f,b,e,g,0,0,1]);d.transpose(h,h),this.transformation=h},this.translate=function(a,b){var c=d.create([1,0,0,0,1,0,a,b,1]);d.multiply(this.transformation,this.transformation,c)},this.transform=function(a,b,c,e,f,g){var h=d.create([a,b,0,c,e,0,f,g,1]);d.multiply(this.transformation,this.transformation,h)},this.arc=function(a,b,c,d,e,f){function g(a){return a*a}for(var h=Math.ceil(4*(Math.abs(e-d)/Math.PI)),i=0;h>i;i++){var j=c,k=c,l=d+i*(e-d)/h,m=d+(i+1)*(e-d)/h,n=Math.sin(m-l)*(Math.sqrt(4+3*g(Math.tan((m-l)/2)))-1)/3,o=0,p=Math.cos(o),q=Math.sin(o),r=a+j*p*Math.cos(l)-k*q*Math.sin(l),s=b+j*q*Math.cos(l)+k*p*Math.sin(l),t=a+j*p*Math.cos(m)-k*q*Math.sin(m),u=b+j*q*Math.cos(m)+k*p*Math.sin(m),v=r+n*(-j*p*Math.sin(l)-k*q*Math.cos(l)),w=s+n*(-j*q*Math.sin(l)+k*p*Math.cos(l)),x=t-n*(-j*p*Math.sin(m)-k*q*Math.cos(m)),y=u-n*(-j*q*Math.sin(m)+k*p*Math.cos(m));this.bezierCurveTo(v,w,x,y,t,u)}}}function c(){var b={};return b.opts={},b.FRAMERATE=30,b.MAX_VIRTUAL_PIXELS=3e4,b.init=function(a){b.Definitions={},b.Styles={},b.Animations=[],b.Images=[],b.ctx=a,b.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(a,b){this.viewPorts.push({width:a,height:b})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(a){return null!=a&&"number"==typeof a?a:"x"==a?this.width():"y"==a?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},b.init(),b.trim=function(a){return a.replace(/^\s+|\s+$/g,"")},b.compressSpaces=function(a){return a.replace(/[\s\r\t\n]+/gm," ")},b.Property=function(c,d){this.name=c,this.value=d,this.hasValue=function(){return null!=this.value&&""!==this.value},this.numValue=function(){if(!this.hasValue())return 0;var a=parseFloat(this.value);return(this.value+"").match(/%$/)&&(a/=100),a},this.valueOrDefault=function(a){return this.hasValue()?this.value:a},this.numValueOrDefault=function(a){return this.hasValue()?this.numValue():a};var e=this;this.Color={addOpacity:function(c){var d=e.value;if(null!=c&&""!=c){var f=new a(e.value);f.ok&&(d="rgba("+f.r+", "+f.g+", "+f.b+", "+c+")")}return new b.Property(e.name,d)}},this.Definition={getDefinition:function(){var a=e.value.replace(/^(url\()?#([^\)]+)\)?$/,"$2");return b.Definitions[a]},isUrl:function(){return 0==e.value.indexOf("url(")},getFillStyle:function(a){var b=this.getDefinition();return null}},this.Length={DPI:function(a){return 96},EM:function(a){var c=12,d=new b.Property("fontSize",b.Font.Parse(b.ctx.font).fontSize);return d.hasValue()&&(c=d.Length.toPixels(a)),c},toPixels:function(a){if(!e.hasValue())return 0;var c=e.value+"";return c.match(/em$/)?e.numValue()*this.EM(a):c.match(/ex$/)?e.numValue()*this.EM(a)/2:c.match(/px$/)?e.numValue():c.match(/pt$/)?1.25*e.numValue():c.match(/pc$/)?15*e.numValue():c.match(/cm$/)?e.numValue()*this.DPI(a)/2.54:c.match(/mm$/)?e.numValue()*this.DPI(a)/25.4:c.match(/in$/)?e.numValue()*this.DPI(a):c.match(/%$/)?e.numValue()*b.ViewPort.ComputeSize(a):e.numValue()}},this.Time={toMilliseconds:function(){if(!e.hasValue())return 0;var a=e.value+"";return a.match(/s$/)?1e3*e.numValue():a.match(/ms$/)?e.numValue():e.numValue()}},this.Angle={toRadians:function(){if(!e.hasValue())return 0;var a=e.value+"";return a.match(/deg$/)?e.numValue()*(Math.PI/180):a.match(/grad$/)?e.numValue()*(Math.PI/200):a.match(/rad$/)?e.numValue():e.numValue()*(Math.PI/180)}}},b.Font=new function(){this.Styles=["normal","italic","oblique","inherit"],this.Variants=["normal","small-caps","inherit"],this.Weights=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900","inherit"],this.CreateFont=function(a,c,d,e,f,g){var h=null!=g?this.Parse(g):this.CreateFont("","","","","",b.ctx.font);return{fontFamily:f||h.fontFamily,fontSize:e||h.fontSize,fontStyle:a||h.fontStyle,fontWeight:d||h.fontWeight,fontVariant:c||h.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ")}}};var a=this;this.Parse=function(c){for(var d={},e=b.trim(b.compressSpaces(c||"")).split(" "),f={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},g="",h=0;h<e.length;h++)f.fontStyle||-1==a.Styles.indexOf(e[h])?f.fontVariant||-1==a.Variants.indexOf(e[h])?f.fontWeight||-1==a.Weights.indexOf(e[h])?f.fontSize?"inherit"!=e[h]&&(g+=e[h]):("inherit"!=e[h]&&(d.fontSize=e[h].split("/")[0]),f.fontStyle=f.fontVariant=f.fontWeight=f.fontSize=!0):("inherit"!=e[h]&&(d.fontWeight=e[h]),f.fontStyle=f.fontVariant=f.fontWeight=!0):("inherit"!=e[h]&&(d.fontVariant=e[h]),f.fontStyle=f.fontVariant=!0):("inherit"!=e[h]&&(d.fontStyle=e[h]),f.fontStyle=!0);return""!=g&&(d.fontFamily=g),d}},b.ToNumberArray=function(a){for(var c=b.trim(b.compressSpaces((a||"").replace(/,/g," "))).split(" "),d=0;d<c.length;d++)c[d]=parseFloat(c[d]);return c},b.Point=function(a,b){this.x=a,this.y=b,this.angleTo=function(a){return Math.atan2(a.y-this.y,a.x-this.x)},this.applyTransform=function(a){var b=this.x*a[0]+this.y*a[2]+a[4],c=this.x*a[1]+this.y*a[3]+a[5];this.x=b,this.y=c}},b.CreatePoint=function(a){var c=b.ToNumberArray(a);return new b.Point(c[0],c[1])},b.CreatePath=function(a){for(var c=b.ToNumberArray(a),d=[],e=0;e<c.length;e+=2)d.push(new b.Point(c[e],c[e+1]));return d},b.BoundingBox=function(a,b,c,d){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(a,b){null!=a&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=a,this.x2=a),a<this.x1&&(this.x1=a),a>this.x2&&(this.x2=a)),null!=b&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=b,this.y2=b),b<this.y1&&(this.y1=b),b>this.y2&&(this.y2=b))},this.addX=function(a){this.addPoint(a,null)},this.addY=function(a){this.addPoint(null,a)},this.addBoundingBox=function(a){this.addPoint(a.x1,a.y1),this.addPoint(a.x2,a.y2)},this.addQuadraticCurve=function(a,b,c,d,e,f){var g=a+2/3*(c-a),h=b+2/3*(d-b),i=g+1/3*(e-a),j=h+1/3*(f-b);this.addBezierCurve(a,b,g,i,h,j,e,f)},this.addBezierCurve=function(a,b,c,d,e,f,g,h){var i=[a,b],j=[c,d],k=[e,f],l=[g,h];this.addPoint(i[0],i[1]),this.addPoint(l[0],l[1]);for(var m=0;1>=m;m++){var n=function(a){return Math.pow(1-a,3)*i[m]+3*Math.pow(1-a,2)*a*j[m]+3*(1-a)*Math.pow(a,2)*k[m]+Math.pow(a,3)*l[m]},o=6*i[m]-12*j[m]+6*k[m],p=-3*i[m]+9*j[m]-9*k[m]+3*l[m],q=3*j[m]-3*i[m];if(0!=p){var r=Math.pow(o,2)-4*q*p;if(!(0>r)){var s=(-o+Math.sqrt(r))/(2*p);s>0&&1>s&&(0==m&&this.addX(n(s)),1==m&&this.addY(n(s)));var t=(-o-Math.sqrt(r))/(2*p);t>0&&1>t&&(0==m&&this.addX(n(t)),1==m&&this.addY(n(t)))}}else{if(0==o)continue;var u=-q/o;u>0&&1>u&&(0==m&&this.addX(n(u)),1==m&&this.addY(n(u)))}}},this.isPointInBox=function(a,b){return this.x1<=a&&a<=this.x2&&this.y1<=b&&b<=this.y2},this.addPoint(a,b),this.addPoint(c,d)},b.Transform=function(a){var c=this;this.Type={},this.Type.translate=function(a){this.p=b.CreatePoint(a),this.apply=function(a){a.translate(this.p.x||0,this.p.y||0)},this.applyToPoint=function(a){a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(a){var c=b.ToNumberArray(a);this.angle=new b.Property("angle",c[0]),this.cx=c[1]||0,this.cy=c[2]||0,this.apply=function(a){a.translate(this.cx,this.cy),a.rotate(this.angle.Angle.toRadians()),a.translate(-this.cx,-this.cy)},this.applyToPoint=function(a){var b=this.angle.Angle.toRadians();a.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),a.applyTransform([Math.cos(b),Math.sin(b),-Math.sin(b),Math.cos(b),0,0]),a.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])
}},this.Type.scale=function(a){this.p=b.CreatePoint(a),this.apply=function(a){a.scale(this.p.x||1,this.p.y||this.p.x||1)},this.applyToPoint=function(a){a.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(a){this.m=b.ToNumberArray(a),this.apply=function(a){a.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(a){a.applyTransform(this.m)}},this.Type.SkewBase=function(a){this.base=c.Type.matrix,this.base(a),this.angle=new b.Property("angle",a)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(a){this.base=c.Type.SkewBase,this.base(a),this.m=[1,0,Math.tan(this.angle.Angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(a){this.base=c.Type.SkewBase,this.base(a),this.m=[1,Math.tan(this.angle.Angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].apply(a)},this.applyToPoint=function(a){for(var b=0;b<this.transforms.length;b++)this.transforms[b].applyToPoint(a)};for(var d=b.trim(b.compressSpaces(a)).split(/\s(?=[a-z])/),e=0;e<d.length;e++){var f=d[e].split("(")[0],g=d[e].split("(")[1].replace(")",""),h=new this.Type[f](g);this.transforms.push(h)}},b.AspectRatio=function(a,c,d,e,f,g,h,i,j,k){c=b.compressSpaces(c),c=c.replace(/^defer\s/,"");var l=c.split(" ")[0]||"xMidYMid",m=c.split(" ")[1]||"meet",n=d/e,o=f/g,p=Math.min(n,o),q=Math.max(n,o);"meet"==m&&(e*=p,g*=p),"slice"==m&&(e*=q,g*=q),j=new b.Property("refX",j),k=new b.Property("refY",k),j.hasValue()&&k.hasValue()?a.translate(-p*j.Length.toPixels("x"),-p*k.Length.toPixels("y")):(l.match(/^xMid/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&a.translate(d/2-e/2,0),l.match(/YMid$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&a.translate(0,f/2-g/2),l.match(/^xMax/)&&("meet"==m&&p==o||"slice"==m&&q==o)&&a.translate(d-e,0),l.match(/YMax$/)&&("meet"==m&&p==n||"slice"==m&&q==n)&&a.translate(0,f-g)),"none"==l?a.scale(n,o):"meet"==m?a.scale(p,p):"slice"==m&&a.scale(q,q),a.translate(null==h?0:-h,null==i?0:-i)},b.Element={},b.Element.ElementBase=function(a){if(this.attributes={},this.styles={},this.children=[],this.attribute=function(a,c){var d=this.attributes[a];return null!=d?d:(d=new b.Property(a,""),c===!0&&(this.attributes[a]=d),d)},this.style=function(a,c){var d=this.styles[a];if(null!=d)return d;var e=this.attribute(a);if(null!=e&&e.hasValue())return e;var f=this.parent;if(null!=f){var g=f.style(a);if(null!=g&&g.hasValue())return g}return d=new b.Property(a,""),c===!0&&(this.styles[a]=d),d},this.render=function(a){if("none"!=this.style("display").value&&"hidden"!=this.attribute("visibility").value&&0!=this.style("fill-opacity").numValueOrDefault(1)&&0!=this.style("stroke-opacity").numValueOrDefault(1)){if(a.save(),this.setContext(a),this.attribute("mask").hasValue()){var b=this.attribute("mask").Definition.getDefinition();null!=b&&b.apply(a,this)}else if(this.style("filter").hasValue()){var c=this.style("filter").Definition.getDefinition();null!=c&&c.apply(a,this)}else this.renderChildren(a);this.clearContext(a),a.restore()}},this.setContext=function(a){},this.clearContext=function(a){},this.renderChildren=function(a){for(var b=0;b<this.children.length;b++)this.children[b].render(a)},this.addChild=function(a,c){var d=a;c&&(d=b.CreateElement(a)),d.parent=this,this.children.push(d)},this.getBoundingBox=function(){for(var a=new b.BoundingBox,c=0;c<this.children.length;c++)a.addBoundingBox(this.children[c].getBoundingBox());return a},a&&"element"==a.type()){for(var c=a.name(),d=a.childNodes(),e=0,f=d.length;f>e;e++){var g=d[e];if("element"==g.type()&&this.addChild(g,!0),"text"==a.name()&&"text"==g.type()){var h=g.text()||g.nodeValue||g.text||"";h&&""!=b.trim(b.compressSpaces(h))&&this.addChild(new b.Element.tspan(g),!1)}}for(var i=a.attrs(),e=0;e<i.length;e++){var j=i[e],k=j.name(),l=j.value();this.attributes[k]=new b.Property(k,l)}var m=b.Styles[c];if(null!=m)for(var n in m)this.styles[n]=m[n];if(this.attribute("class").hasValue())for(var o=b.compressSpaces(this.attribute("class").value).split(" "),p=0;p<o.length;p++){if(m=b.Styles["."+o[p]],null!=m)for(var n in m)this.styles[n]=m[n];if(m=b.Styles[c+"."+o[p]],null!=m)for(var n in m)this.styles[n]=m[n]}if(this.attribute("style").hasValue())for(var m=this.attribute("style").value.split(";"),e=0;e<m.length;e++)if(""!=b.trim(m[e])){var q=m[e].split(":"),n=b.trim(q[0]),r=b.trim(q[1]);this.styles[n]=new b.Property(n,r)}this.attribute("id").hasValue()&&null==b.Definitions[this.attribute("id").value]&&(b.Definitions[this.attribute("id").value]=this)}},b.Element.RenderedElementBase=function(a){this.base=b.Element.ElementBase,this.base(a),this.setContext=function(a){if(this.style("fill").Definition.isUrl()){var c=this.style("fill").Definition.getFillStyle(this);null!=c&&(a.fillStyle=c)}else if(this.style("fill").hasValue()){var d=this.style("fill");this.style("fill-opacity").hasValue()&&(d=d.Color.addOpacity(this.style("fill-opacity").value)),a.fillStyle="none"==d.value?"rgba(0,0,0,0)":d.value}if(this.style("stroke").Definition.isUrl()){var c=this.style("stroke").Definition.getFillStyle(this);null!=c&&(a.strokeStyle=c)}else if(this.style("stroke").hasValue()){var e=this.style("stroke");this.style("stroke-opacity").hasValue()&&(e=e.Color.addOpacity(this.style("stroke-opacity").value)),a.strokeStyle="none"==e.value?"rgba(0,0,0,0)":e.value}if(this.style("stroke-width").hasValue()&&(a.lineWidth=this.style("stroke-width").Length.toPixels()),this.style("stroke-linecap").hasValue()&&(a.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(a.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(a.miterLimit=this.style("stroke-miterlimit").value),"undefined"!=typeof a.font&&(a.font=b.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").Length.toPixels()+"px":"",this.style("font-family").value).toString()),this.attribute("transform").hasValue()){var f=new b.Transform(this.attribute("transform").value);f.apply(a)}this.style("opacity").hasValue()&&(a.globalAlpha=this.style("opacity").numValue())}},b.Element.RenderedElementBase.prototype=new b.Element.ElementBase,b.Element.PathElementBase=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.path=function(a){return null!=a&&a.beginPath(),new b.BoundingBox},this.renderChildren=function(a){this.path(a),""!=a.fillStyle&&a.fill(),""!=a.strokeStyle&&a.stroke();var b=this.getMarkers();if(null!=b){if(this.style("marker-start").Definition.isUrl()){var c=this.style("marker-start").Definition.getDefinition();c.render(a,b[0][0],b[0][1])}if(this.style("marker-mid").Definition.isUrl())for(var c=this.style("marker-mid").Definition.getDefinition(),d=1;d<b.length-1;d++)c.render(a,b[d][0],b[d][1]);if(this.style("marker-end").Definition.isUrl()){var c=this.style("marker-end").Definition.getDefinition();c.render(a,b[b.length-1][0],b[b.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},b.Element.PathElementBase.prototype=new b.Element.RenderedElementBase,b.Element.svg=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.baseClearContext=this.clearContext,this.clearContext=function(a){this.baseClearContext(a),b.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(a){a.strokeStyle="rgba(0,0,0,0)",a.lineCap="butt",a.lineJoin="miter",a.miterLimit=4,this.baseSetContext(a),this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&a.translate(this.attribute("x").Length.toPixels("x"),this.attribute("y").Length.toPixels("y"));var c=b.ViewPort.width(),d=b.ViewPort.height();if("undefined"==typeof this.root&&this.attribute("width").hasValue()&&this.attribute("height").hasValue()){c=this.attribute("width").Length.toPixels("x"),d=this.attribute("height").Length.toPixels("y");var e=0,f=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(e=-this.attribute("refX").Length.toPixels("x"),f=-this.attribute("refY").Length.toPixels("y")),a.beginPath(),a.moveTo(e,f),a.lineTo(c,f),a.lineTo(c,d),a.lineTo(e,d),a.closePath(),a.clip()}if(b.ViewPort.SetCurrent(c,d),this.attribute("viewBox").hasValue()){var g=b.ToNumberArray(this.attribute("viewBox").value),h=g[0],i=g[1];c=g[2],d=g[3],b.AspectRatio(a,this.attribute("preserveAspectRatio").value,b.ViewPort.width(),c,b.ViewPort.height(),d,h,i,this.attribute("refX").value,this.attribute("refY").value),b.ViewPort.RemoveCurrent(),b.ViewPort.SetCurrent(g[2],g[3])}}},b.Element.svg.prototype=new b.Element.RenderedElementBase,b.Element.rect=function(a){this.base=b.Element.PathElementBase,this.base(a),this.path=function(a){var c=this.attribute("x").Length.toPixels("x"),d=this.attribute("y").Length.toPixels("y"),e=this.attribute("width").Length.toPixels("x"),f=this.attribute("height").Length.toPixels("y"),g=this.attribute("rx").Length.toPixels("x"),h=this.attribute("ry").Length.toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(h=g),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(g=h),null!=a&&(a.beginPath(),a.moveTo(c+g,d),a.lineTo(c+e-g,d),a.quadraticCurveTo(c+e,d,c+e,d+h),a.lineTo(c+e,d+f-h),a.quadraticCurveTo(c+e,d+f,c+e-g,d+f),a.lineTo(c+g,d+f),a.quadraticCurveTo(c,d+f,c,d+f-h),a.lineTo(c,d+h),a.quadraticCurveTo(c,d,c+g,d),a.closePath()),new b.BoundingBox(c,d,c+e,d+f)}},b.Element.rect.prototype=new b.Element.PathElementBase,b.Element.circle=function(a){this.base=b.Element.PathElementBase,this.base(a),this.path=function(a){var c=4*((Math.sqrt(2)-1)/3),d=this.attribute("cx").Length.toPixels("x"),e=this.attribute("cy").Length.toPixels("y"),f=this.attribute("r").Length.toPixels("x"),g=this.attribute("r").Length.toPixels("y");return null!=a&&(a.beginPath(),a.moveTo(d,e-g),a.bezierCurveTo(d+c*f,e-g,d+f,e-c*g,d+f,e),a.bezierCurveTo(d+f,e+c*g,d+c*f,e+g,d,e+g),a.bezierCurveTo(d-c*f,e+g,d-f,e+c*g,d-f,e),a.bezierCurveTo(d-f,e-c*g,d-c*f,e-g,d,e-g),a.closePath()),new b.BoundingBox(d-f,e-g,d+f,e+g)}},b.Element.circle.prototype=new b.Element.PathElementBase,b.Element.ellipse=function(a){this.base=b.Element.PathElementBase,this.base(a),this.path=function(a){var c=4*((Math.sqrt(2)-1)/3),d=this.attribute("rx").Length.toPixels("x"),e=this.attribute("ry").Length.toPixels("y"),f=this.attribute("cx").Length.toPixels("x"),g=this.attribute("cy").Length.toPixels("y");return null!=a&&(a.beginPath(),a.moveTo(f,g-e),a.bezierCurveTo(f+c*d,g-e,f+d,g-c*e,f+d,g),a.bezierCurveTo(f+d,g+c*e,f+c*d,g+e,f,g+e),a.bezierCurveTo(f-c*d,g+e,f-d,g+c*e,f-d,g),a.bezierCurveTo(f-d,g-c*e,f-c*d,g-e,f,g-e),a.closePath()),new b.BoundingBox(f-d,g-e,f+d,g+e)}},b.Element.ellipse.prototype=new b.Element.PathElementBase,b.Element.line=function(a){this.base=b.Element.PathElementBase,this.base(a),this.getPoints=function(){return[new b.Point(this.attribute("x1").Length.toPixels("x"),this.attribute("y1").Length.toPixels("y")),new b.Point(this.attribute("x2").Length.toPixels("x"),this.attribute("y2").Length.toPixels("y"))]},this.path=function(a){var c=this.getPoints();return null!=a&&(a.beginPath(),a.moveTo(c[0].x,c[0].y),a.lineTo(c[1].x,c[1].y)),new b.BoundingBox(c[0].x,c[0].y,c[1].x,c[1].y)},this.getMarkers=function(){var a=this.getPoints(),b=a[0].angleTo(a[1]);return[[a[0],b],[a[1],b]]}},b.Element.line.prototype=new b.Element.PathElementBase,b.Element.polyline=function(a){this.base=b.Element.PathElementBase,this.base(a),this.points=b.CreatePath(this.attribute("points").value),this.path=function(a){var c=new b.BoundingBox(this.points[0].x,this.points[0].y);null!=a&&(a.beginPath(),a.moveTo(this.points[0].x,this.points[0].y));for(var d=1;d<this.points.length;d++)c.addPoint(this.points[d].x,this.points[d].y),null!=a&&a.lineTo(this.points[d].x,this.points[d].y);return c},this.getMarkers=function(){for(var a=[],b=0;b<this.points.length-1;b++)a.push([this.points[b],this.points[b].angleTo(this.points[b+1])]);return a.push([this.points[this.points.length-1],a[a.length-1][1]]),a}},b.Element.polyline.prototype=new b.Element.PathElementBase,b.Element.polygon=function(a){this.base=b.Element.polyline,this.base(a),this.basePath=this.path,this.path=function(a){var b=this.basePath(a);return null!=a&&(a.lineTo(this.points[0].x,this.points[0].y),a.closePath()),b}},b.Element.polygon.prototype=new b.Element.polyline,b.Element.path=function(a){this.base=b.Element.PathElementBase,this.base(a);var c=this.attribute("d").value;c=c.replace(/,/gm," "),c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),c=c.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),c=c.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),c=c.replace(/([0-9])([+\-])/gm,"$1 $2"),c=c.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),c=c.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),c=b.compressSpaces(c),c=b.trim(c),this.PathParser=new function(a){this.tokens=a.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new b.Point(0,0),this.control=new b.Point(0,0),this.current=new b.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:null!=this.tokens[this.i+1].match(/^[A-Za-z]$/)},this.isRelativeCommand=function(){return this.command==this.command.toLowerCase()},this.getToken=function(){return this.i=this.i+1,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var a=new b.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(a)},this.getAsControlPoint=function(){var a=this.getPoint();return this.control=a,a},this.getAsCurrentPoint=function(){var a=this.getPoint();return this.current=a,a},this.getReflectedControlPoint=function(){if("c"!=this.previousCommand.toLowerCase()&&"s"!=this.previousCommand.toLowerCase()&&"q"!=this.previousCommand.toLowerCase()&&"t"!=this.previousCommand.toLowerCase())return this.current;var a=new b.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return a},this.makeAbsolute=function(a){return this.isRelativeCommand()&&(a.x=this.current.x+a.x,a.y=this.current.y+a.y),a},this.addMarker=function(a,b,c){null!=c&&this.angles.length>0&&null==this.angles[this.angles.length-1]&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(c)),this.addMarkerAngle(a,null==b?null:b.angleTo(a))},this.addMarkerAngle=function(a,b){this.points.push(a),this.angles.push(b)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var a=0;a<this.angles.length;a++)if(null==this.angles[a])for(var b=a+1;b<this.angles.length;b++)if(null!=this.angles[b]){this.angles[a]=this.angles[b];break}return this.angles}}(c),this.path=function(a){var c=this.PathParser;c.reset();var d=new b.BoundingBox;for(null!=a&&a.beginPath();!c.isEnd();)switch(c.nextCommand(),c.command.toUpperCase()){case"M":var e=c.getAsCurrentPoint();for(c.addMarker(e),d.addPoint(e.x,e.y),null!=a&&a.moveTo(e.x,e.y),c.start=c.current;!c.isCommandOrEnd();){var e=c.getAsCurrentPoint();c.addMarker(e,c.start),d.addPoint(e.x,e.y),null!=a&&a.lineTo(e.x,e.y)}break;case"L":for(;!c.isCommandOrEnd();){var f=c.current,e=c.getAsCurrentPoint();c.addMarker(e,f),d.addPoint(e.x,e.y),null!=a&&a.lineTo(e.x,e.y)}break;case"H":for(;!c.isCommandOrEnd();){var g=new b.Point((c.isRelativeCommand()?c.current.x:0)+c.getScalar(),c.current.y);c.addMarker(g,c.current),c.current=g,d.addPoint(c.current.x,c.current.y),null!=a&&a.lineTo(c.current.x,c.current.y)}break;case"V":for(;!c.isCommandOrEnd();){var g=new b.Point(c.current.x,(c.isRelativeCommand()?c.current.y:0)+c.getScalar());c.addMarker(g,c.current),c.current=g,d.addPoint(c.current.x,c.current.y),null!=a&&a.lineTo(c.current.x,c.current.y)}break;case"C":for(;!c.isCommandOrEnd();){var h=c.current,i=c.getPoint(),j=c.getAsControlPoint(),k=c.getAsCurrentPoint();c.addMarker(k,j,i),d.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=a&&a.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"S":for(;!c.isCommandOrEnd();){var h=c.current,i=c.getReflectedControlPoint(),j=c.getAsControlPoint(),k=c.getAsCurrentPoint();c.addMarker(k,j,i),d.addBezierCurve(h.x,h.y,i.x,i.y,j.x,j.y,k.x,k.y),null!=a&&a.bezierCurveTo(i.x,i.y,j.x,j.y,k.x,k.y)}break;case"Q":for(;!c.isCommandOrEnd();){var h=c.current,j=c.getAsControlPoint(),k=c.getAsCurrentPoint();c.addMarker(k,j,j),d.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=a&&a.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"T":for(;!c.isCommandOrEnd();){var h=c.current,j=c.getReflectedControlPoint();c.control=j;var k=c.getAsCurrentPoint();c.addMarker(k,j,j),d.addQuadraticCurve(h.x,h.y,j.x,j.y,k.x,k.y),null!=a&&a.quadraticCurveTo(j.x,j.y,k.x,k.y)}break;case"A":for(;!c.isCommandOrEnd();){var h=c.current,l=c.getScalar(),m=c.getScalar(),n=c.getScalar()*(Math.PI/180),o=c.getScalar(),p=c.getScalar(),k=c.getAsCurrentPoint(),q=new b.Point(Math.cos(n)*(h.x-k.x)/2+Math.sin(n)*(h.y-k.y)/2,-Math.sin(n)*(h.x-k.x)/2+Math.cos(n)*(h.y-k.y)/2),r=Math.pow(q.x,2)/Math.pow(l,2)+Math.pow(q.y,2)/Math.pow(m,2);r>1&&(l*=Math.sqrt(r),m*=Math.sqrt(r));var s=(o==p?-1:1)*Math.sqrt((Math.pow(l,2)*Math.pow(m,2)-Math.pow(l,2)*Math.pow(q.y,2)-Math.pow(m,2)*Math.pow(q.x,2))/(Math.pow(l,2)*Math.pow(q.y,2)+Math.pow(m,2)*Math.pow(q.x,2)));isNaN(s)&&(s=0);var t=new b.Point(s*l*q.y/m,s*-m*q.x/l),u=new b.Point((h.x+k.x)/2+Math.cos(n)*t.x-Math.sin(n)*t.y,(h.y+k.y)/2+Math.sin(n)*t.x+Math.cos(n)*t.y),v=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2))},w=function(a,b){return(a[0]*b[0]+a[1]*b[1])/(v(a)*v(b))},x=function(a,b){return(a[0]*b[1]<a[1]*b[0]?-1:1)*Math.acos(w(a,b))},y=x([1,0],[(q.x-t.x)/l,(q.y-t.y)/m]),z=[(q.x-t.x)/l,(q.y-t.y)/m],A=[(-q.x-t.x)/l,(-q.y-t.y)/m],B=x(z,A);w(z,A)<=-1&&(B=Math.PI),w(z,A)>=1&&(B=0),0==p&&B>0&&(B-=2*Math.PI),1==p&&0>B&&(B+=2*Math.PI);var C=new b.Point(u.x-l*Math.cos((y+B)/2),u.y-m*Math.sin((y+B)/2));if(c.addMarkerAngle(C,(y+B)/2+(0==p?1:-1)*Math.PI/2),c.addMarkerAngle(k,B+(0==p?1:-1)*Math.PI/2),d.addPoint(k.x,k.y),null!=a){var w=l>m?l:m,D=l>m?1:l/m,E=l>m?m/l:1;a.translate(u.x,u.y),a.rotate(n),a.scale(D,E),a.arc(0,0,w,y,y+B,1-p),a.scale(1/D,1/E),a.rotate(-n),a.translate(-u.x,-u.y)}}break;case"Z":null!=a&&a.closePath(),c.current=c.start}return d},this.getMarkers=function(){for(var a=this.PathParser.getMarkerPoints(),b=this.PathParser.getMarkerAngles(),c=[],d=0;d<a.length;d++)c.push([a[d],b[d]]);return c}},b.Element.path.prototype=new b.Element.PathElementBase,b.Element.marker=function(a){this.base=b.Element.ElementBase,this.base(a),this.baseRender=this.render,this.render=function(a,c,d){a.translate(c.x,c.y),"auto"==this.attribute("orient").valueOrDefault("auto")&&a.rotate(d),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&a.scale(a.lineWidth,a.lineWidth),a.save();var e=new b.Element.svg;e.attributes.viewBox=new b.Property("viewBox",this.attribute("viewBox").value),e.attributes.refX=new b.Property("refX",this.attribute("refX").value),e.attributes.refY=new b.Property("refY",this.attribute("refY").value),e.attributes.width=new b.Property("width",this.attribute("markerWidth").value),e.attributes.height=new b.Property("height",this.attribute("markerHeight").value),e.attributes.fill=new b.Property("fill",this.attribute("fill").valueOrDefault("black")),e.attributes.stroke=new b.Property("stroke",this.attribute("stroke").valueOrDefault("none")),e.children=this.children,e.render(a),a.restore(),"strokeWidth"==this.attribute("markerUnits").valueOrDefault("strokeWidth")&&a.scale(1/a.lineWidth,1/a.lineWidth),"auto"==this.attribute("orient").valueOrDefault("auto")&&a.rotate(-d),a.translate(-c.x,-c.y)}},b.Element.marker.prototype=new b.Element.ElementBase,b.Element.defs=function(a){this.base=b.Element.ElementBase,this.base(a),this.render=function(a){}},b.Element.defs.prototype=new b.Element.ElementBase,b.Element.font=function(a){this.base=b.Element.ElementBase,this.base(a),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var c=0;c<this.children.length;c++){var d=this.children[c];"font-face"==d.type?(this.fontFace=d,d.style("font-family").hasValue()&&(b.Definitions[d.style("font-family").value]=this)):"missing-glyph"==d.type?this.missingGlyph=d:"glyph"==d.type&&(""!=d.arabicForm?(this.isRTL=!0,this.isArabic=!0,"undefined"==typeof this.glyphs[d.unicode]&&(this.glyphs[d.unicode]=[]),this.glyphs[d.unicode][d.arabicForm]=d):this.glyphs[d.unicode]=d)}},b.Element.font.prototype=new b.Element.ElementBase,b.Element.fontface=function(a){this.base=b.Element.ElementBase,this.base(a),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},b.Element.fontface.prototype=new b.Element.ElementBase,b.Element.missingglyph=function(a){this.base=b.Element.path,this.base(a),this.horizAdvX=0},b.Element.missingglyph.prototype=new b.Element.path,b.Element.glyph=function(a){this.base=b.Element.path,this.base(a),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},b.Element.glyph.prototype=new b.Element.path,b.Element.text=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a),this.style("dominant-baseline").hasValue()&&(a.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(a.textBaseline=this.style("alignment-baseline").value)},this.renderChildren=function(a){for(var b=this.style("text-anchor").valueOrDefault("start"),c=this.attribute("x").Length.toPixels("x"),d=this.attribute("y").Length.toPixels("y"),e=0;e<this.children.length;e++){var f=this.children[e];f.attribute("x").hasValue()?f.x=f.attribute("x").Length.toPixels("x"):(f.attribute("dx").hasValue()&&(c+=f.attribute("dx").Length.toPixels("x")),f.x=c);var g=f.measureText(a);if("start"!=b&&(0==e||f.attribute("x").hasValue())){for(var h=g,i=e+1;i<this.children.length;i++){var j=this.children[i];if(j.attribute("x").hasValue())break;h+=j.measureText(a)}f.x-="end"==b?h:h/2}c=f.x+g,f.attribute("y").hasValue()?f.y=f.attribute("y").Length.toPixels("y"):(f.attribute("dy").hasValue()&&(d+=f.attribute("dy").Length.toPixels("y")),f.y=d),d=f.y,f.render(a)}}},b.Element.text.prototype=new b.Element.RenderedElementBase,b.Element.TextElementBase=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.getGlyph=function(a,b,c){var d=b[c],e=null;if(a.isArabic){var f="isolated";(0==c||" "==b[c-1])&&c<b.length-2&&" "!=b[c+1]&&(f="terminal"),c>0&&" "!=b[c-1]&&c<b.length-2&&" "!=b[c+1]&&(f="medial"),c>0&&" "!=b[c-1]&&(c==b.length-1||" "==b[c+1])&&(f="initial"),"undefined"!=typeof a.glyphs[d]&&(e=a.glyphs[d][f],null==e&&"glyph"==a.glyphs[d].type&&(e=a.glyphs[d]))}else e=a.glyphs[d];return null==e&&(e=a.missingGlyph),e},this.renderChildren=function(a){var c=this.parent.style("font-family").Definition.getDefinition();if(null==c)""!=a.strokeStyle&&a.strokeText(b.compressSpaces(this.getText()),this.x,this.y),""!=a.fillStyle&&a.fillText(b.compressSpaces(this.getText()),this.x,this.y);else{var d=this.parent.style("font-size").numValueOrDefault(b.Font.Parse(b.ctx.font).fontSize),e=this.parent.style("font-style").valueOrDefault(b.Font.Parse(b.ctx.font).fontStyle),f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=b.ToNumberArray(this.parent.attribute("dx").value),h=0;h<f.length;h++){var i=this.getGlyph(c,f,h),j=d/c.fontFace.unitsPerEm;a.translate(this.x,this.y),a.scale(j,-j);var k=a.lineWidth;a.lineWidth=a.lineWidth*c.fontFace.unitsPerEm/d,"italic"==e&&a.transform(1,0,.4,1,0,0),i.render(a),"italic"==e&&a.transform(1,0,-.4,1,0,0),a.lineWidth=k,a.scale(1/j,-1/j),a.translate(-this.x,-this.y),this.x+=d*(i.horizAdvX||c.horizAdvX)/c.fontFace.unitsPerEm,"undefined"==typeof g[h]||isNaN(g[h])||(this.x+=g[h])}}},this.getText=function(){},this.measureText=function(a){var c=this.parent.style("font-family").Definition.getDefinition();if(null!=c){var d=this.parent.style("font-size").numValueOrDefault(b.Font.Parse(b.ctx.font).fontSize),e=0,f=this.getText();c.isRTL&&(f=f.split("").reverse().join(""));for(var g=b.ToNumberArray(this.parent.attribute("dx").value),h=0;h<f.length;h++){var i=this.getGlyph(c,f,h);e+=(i.horizAdvX||c.horizAdvX)*d/c.fontFace.unitsPerEm,"undefined"==typeof g[h]||isNaN(g[h])||(e+=g[h])}return e}var j=b.compressSpaces(this.getText());if(!a.measureText)return 10*j.length;a.save(),this.setContext(a);var k=a.measureText(j).width;return a.restore(),k}},b.Element.TextElementBase.prototype=new b.Element.RenderedElementBase,b.Element.tspan=function(a){this.base=b.Element.TextElementBase,this.base(a),this.text=a.text()||"",this.getText=function(){return this.text}},b.Element.tspan.prototype=new b.Element.TextElementBase,b.Element.g=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.getBoundingBox=function(){for(var a=new b.BoundingBox,c=0;c<this.children.length;c++)a.addBoundingBox(this.children[c].getBoundingBox());return a}},b.Element.g.prototype=new b.Element.RenderedElementBase,b.Element.symbol=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.baseSetContext=this.setContext,this.setContext=function(a){if(this.baseSetContext(a),this.attribute("viewBox").hasValue()){var c=b.ToNumberArray(this.attribute("viewBox").value),d=c[0],e=c[1];width=c[2],height=c[3],b.AspectRatio(a,this.attribute("preserveAspectRatio").value,this.attribute("width").Length.toPixels("x"),width,this.attribute("height").Length.toPixels("y"),height,d,e),b.ViewPort.SetCurrent(c[2],c[3])}}},b.Element.symbol.prototype=new b.Element.RenderedElementBase,b.Element.style=function(a){this.base=b.Element.ElementBase,this.base(a);var c=a.childNodes()[0].nodeValue+(a.childNodes().length>1?a.childNodes()[1].nodeValue:"");c=c.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),c=b.compressSpaces(c);for(var d=c.split("}"),e=0;e<d.length;e++)if(""!=b.trim(d[e]))for(var f=d[e].split("{"),g=f[0].split(","),h=f[1].split(";"),i=0;i<g.length;i++){var j=b.trim(g[i]);if(""!=j){for(var k={},l=0;l<h.length;l++){var m=h[l].indexOf(":"),n=h[l].substr(0,m),o=h[l].substr(m+1,h[l].length-m);null!=n&&null!=o&&(k[b.trim(n)]=new b.Property(b.trim(n),b.trim(o)))}if(b.Styles[j]=k,"@font-face"==j)for(var p=k["font-family"].value.replace(/"/g,""),q=k.src.value.split(","),r=0;r<q.length;r++)if(q[r].indexOf('format("svg")')>0)for(var s=q[r].indexOf("url"),t=q[r].indexOf(")",s),u=q[r].substr(s+5,t-s-6),v=b.parseXml(b.ajax(u)),w=v.getElementsByTagName("font"),x=0;x<w.length;x++){var y=b.CreateElement(w[x]);b.Definitions[p]=y}}}},b.Element.style.prototype=new b.Element.ElementBase,b.Element.use=function(a){this.base=b.Element.RenderedElementBase,this.base(a),this.baseSetContext=this.setContext,this.setContext=function(a){this.baseSetContext(a),this.attribute("x").hasValue()&&a.translate(this.attribute("x").Length.toPixels("x"),0),this.attribute("y").hasValue()&&a.translate(0,this.attribute("y").Length.toPixels("y"))},this.getDefinition=function(){var a=this.attribute("xlink:href").Definition.getDefinition();return this.attribute("width").hasValue()&&(a.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(a.attribute("height",!0).value=this.attribute("height").value),a},this.path=function(a){var b=this.getDefinition();null!=b&&b.path(a)},this.renderChildren=function(a){var b=this.getDefinition();null!=b&&b.render(a)}},b.Element.use.prototype=new b.Element.RenderedElementBase,b.Element.clipPath=function(a){this.base=b.Element.ElementBase,this.base(a),this.apply=function(a){for(var b=0;b<this.children.length;b++)this.children[b].path&&(this.children[b].path(a),a.clip())},this.render=function(a){O.log("no op")}},b.Element.clipPath.prototype=new b.Element.ElementBase,b.Element.title=function(a){},b.Element.title.prototype=new b.Element.ElementBase,b.Element.desc=function(a){},b.Element.desc.prototype=new b.Element.ElementBase,b.missingElements=[],b.Element.MISSING=function(a){-1===b.missingElements.indexOf(a.name())&&b.missingElements.push(a.name())},b.Element.MISSING.prototype=new b.Element.ElementBase,b.CreateElement=function(a){var c=a.name().replace(/^[^:]+:/,"");c=c.replace(/\-/g,"");var d=null;return d="undefined"!=typeof b.Element[c]?new b.Element[c](a):new b.Element.MISSING(a),d.type=a.name(),d},b.loadXml=function(a,c){var d=a.xmlParser,e=d.parseXml(c);return b.loadXmlDoc(a,e)},b.loadXmlDoc=function(a,c){if(b.init(a),!c||!c.root)return!1;var d=b.CreateElement(c.root());d.root=!0;var e=100,f=100;return d.style("width").hasValue()&&(e=d.style("width").Length.toPixels("x")),d.style("height").hasValue()&&(f=d.style("height").Length.toPixels("y")),b.ViewPort.Clear(),b.ViewPort.SetCurrent(e,f),d.render(a),!0},b}var d={};d.create=function(a){var b=new Array(9);return a&&(b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8]),b},d.set=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a},d.identity=function(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},d.transpose=function(a,b){if(b==a){var c=b[1],d=b[2],e=b[5];return b[1]=b[3],b[2]=b[6],b[3]=c,b[5]=b[7],b[6]=d,b[7]=e,b}return a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8],a},d.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},d.transformPoint=function(a,b,c){var d=c[0],e=c[1];return a[0]=b[0]*d+b[3]*e+b[6],a[1]=b[1]*d+b[4]*e+b[7],a},this.buildSvg=c,this.Context=b},Ab={parseAsciiSTL:function(a,b){for(var c=!1,d=0,e=a.byteLength,f=[0,0,0,0,0,0,0,0,0],g=0;e>d;){for(var h="";e>d;){var i=a.getUint8(d);if(d++,(10===i||13===i)&&h.length>0)break;h+=String.fromCharCode(i>127?65533:i)}h=h.replace(/\s+/g," "),h=h.trim();var j=h.split(" ");if(!c){if(j.length<1||"solid"!==j[0])return O.log("parseAsciiSTL: could not find header on first line"),!1;c=!0}if(4===j.length&&"vertex"===j[0]){var k=parseFloat(j[1]),l=parseFloat(j[2]),m=parseFloat(j[3]);if(isNaN(k)||isNaN(l)||isNaN(m))return O.log("parseAsciiSTL(): Invalid floating point value: ["+j[1]+","+j[2]+","+j[3]+"]"),!1;f[3*g+0]=k,f[3*g+1]=l,f[3*g+2]=m,g++,g>=3&&(b.triangle(f),g=0)}}return!0},parseBinarySTL:function(a,b){if(a.byteLength<84)return!1;var c=80,d=a.getUint32(c,!0),e=84+50*d;if(a.byteLength<e)return!1;c+=4;for(var f=[0,0,0,0,0,0,0,0,0],g=0,h=0;d>h;h++){c+=12;for(var i=0;3>i;i++)g=3*i,f[g]=a.getFloat32(c,!0),f[g+1]=a.getFloat32(c+4,!0),f[g+2]=a.getFloat32(c+8,!0),c+=12;b.triangle(f),c+=2}return!0}};q.prototype={constructor:q,bind:function(a){a&&this._listeners.push(a)},unbind:function(a){if(a){for(var b=this._listeners.length,c=0;b>c;c++)if(this._listeners[c]===a){this._listeners.splice(c,1);break}}else this._listeners=[]},fire:function(a,b){var c=this._listeners.length;if(c>0){var d=new r;d._target=this._target||this,d._type=this._type,d._data=a,b&&(d._originalEvent=b);for(var e=0;c>e;e++)this._listeners[e].call(this,d)}}},r.prototype={constructor:r},c.exports.EventSource=q,g(q,"EventSource");var Bb=function(a,b){this._json=a,b instanceof ab&&(this.localToParent=b)};Bb.prototype={_localToParent:function(){if(0===arguments.length)return this.localToParent?this.localToParent:this._localToWorld();
if(this.localToParent){var a=arguments[0],b;a instanceof ab?b=a:Array.isArray(a)&&16===a.length?b=new ab(a):hb.panic(z);var c=b.clone().transform(this.localToParent.invert());this.localToParent=b.clone();var d=function(a,b){var c=b.clone().transform(new ab(a.TM));a.TM=c.elements;for(var e=a.children,f=0,g=e.length;g>f;f++)d(a.children[f],b)};d(this._json,c)}else this._localToWorld(arguments[0])},_localToWorld:function(){if(0===arguments.length)return this._json?new ab(this._json.TM):void 0;if(this._json){var a=arguments[0],b;a instanceof ab?b=a.elements:Array.isArray(a)&&16===a.length?b=a:hb.panic(z),this._json.TM=b}}};var Cb=function(a,b){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new Bb(a,b)})};Cb.prototype={toJSON:function(){return this._impl._json},shapeByPath:function(a){if(Array.isArray(a)||hb.panic(z),a.length<1)return this;for(var b=this._impl._json,c=0,d=a.length,e,f;b&&d>c;){if(!b.children||b.children.length<=a[c])return void 0;f=b,b=b.children[a[c]],c++,c===d&&(e=b)}if(e){var g=new ab(f.TM.slice(0)),h=new ab(e.TM.slice(0)),i=h.transform(g.invert());return new Cb(e,i)}return void 0},assignGenerator:function(a){var b=this._impl._json;b&&(b.children=[],b.geom.params||(b.geom.params={}),b.pluginType="library",b.pluginId=a.libraryId,b.pluginRev=a.libraryRev,b.params=a.params,b.scale=[1,1,1])},setGeneratorParameter:function(a,b){var c=this._impl._json;c&&c.geom&&(c.geom.params||(c.geom.params={}),c.geom.params[a]=b)},setModifierParameter:function(a,b,c){0>a&&hb.panic(z);var d=this._impl._json;d&&d.mods&&(a>=d.mods.length&&hb.panic(z),d.mods[a].params||(d.mods[a].params={}),d.mods[a].params[b]=c)}},Object.defineProperty(Cb.prototype,"localToParent",{get:function(){return this._impl._localToParent()},set:function(a){return this._impl._localToParent(a)}}),g(Cb,"Shape"),c.exports.Shape=Cb;var Db=function(){var a=function(a,b){var c=a.get("xmlns:font-face",b.href());c.attr({"font-family":a.attr("id")});var d=a.get("xmlns:missing-glyph",b.href());d||(d=a.node("missing-glyph"));var e=d.attr("d");if(!e){for(var f=["?"," "],g=void 0,h=0;h<f.length;h++){var i='xmlns:glyph[@unicode="'+f[h]+'"]';if(g=a.get(i,b.href()))break}g&&(d.attr({"horiz-adv-x":g.attr("horiz-adv-x")}),d.attr({d:g.attr("d")}))}};return function(b){var c=x.parseXml(b);c&&c.root||hb.panic("The input is not a valid SVG font.");var d=c.root().namespace(),e=c.get("/xmlns:svg/xmlns:defs/xmlns:font",d.href()),f=e.attr("id");a(e,d);var g=new zb,h=g.buildSvg(),i=new g.Context(h,x,eb);h.init(i),h.CreateElement(c.root());var j=h.Definitions[f];j||hb.panic("The input is not a valid SVG font."),h.ViewPort.Clear(),h.ViewPort.SetCurrent(100,100),this._fontFamily=f,this._font=j,this._svg=h,this._context=i}}();Db.prototype=function(){var a=function(a,b){return a.glyphs[b]||a.missingGlyph};return{_glyphAdvance:function(b,c){var d=a(this._font,b);return c*(d.horizAdvX||this._font.horizAdvX)/this._font.fontFace.unitsPerEm},_glyphPaths:function(b,c){var d=this._context,e=this._font,f=a(this._font,b);d.save();var g=c/e.fontFace.unitsPerEm;d.translate(0,c),d.scale(g,-g),f.render(d);var h=d.paths;return d.paths=[],d.restore(),h}}}();var Eb=function(a,b){this.size=b||25,Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new Db(a)})};Eb.prototype={glyphAdvance:function(a){return"string"!=typeof a||1!==a.length?void 0:this._impl._glyphAdvance(a,this.size)},glyphPaths:function(a){return"string"!=typeof a||1!==a.length?void 0:this._impl._glyphPaths(a,this.size)}},g(Eb,"Font"),c.exports.Font=Eb,s.prototype=new D,s.prototype._evaluate=function(a,b){var c=this._original;this._unpackParameters(a,function(d){c.evaluate(a,b)})},a.setVariable(["proxies","shapeGenerator"],function(a){if(a.__proxy)return a.__proxy;var b=new s(a);return a.__proxy=b,b}),g(s,"ShapeGeneratorProxy"),t.prototype=new D,t.prototype._evaluate=function(a,b){a.shape instanceof Cb||(a.shape="string"==typeof a.shape?new Cb(JSON.parse(a.shape)):new Cb(a.shape));var c=this._original;this._unpackParameters(a.params,function(d){a.params=d,c.evaluate(a,b)})},a.setVariable(["proxies","shapeConfigurator"],function(a){if(a.__proxy)return a.__proxy;var b=new t(a);return a.__proxy=b,b}),g(t,"ShapeConfiguratorProxy"),u.prototype=new D,u.prototype._evaluate=function(a,b){try{var c=[],d=a.instances;d.forEach(function(a){var b;if(a instanceof w)b=a;else{var d,e;"string"==typeof a&&(a=JSON.parse(a));var d=new ab(a.localToParent),e=new R;e.indexedTriangles(a.mesh.vertices,a.mesh.triangles),b=new w(d,e);for(var f=Object.keys(a),g=0;g<f.length;g++){var h=f[g];"mesh"!==h&&"localToParent"!==h&&(b[h]=a[h])}}c.push(b)}),a.instances.length=0,a.instances=c}catch(e){hb.warning("A problem occurred while deserializing context.instances")}var f=this._original;this._unpackParameters(a.params,function(c){a.params=c,f.evaluate(a,b)})},a.setVariable(["proxies","shapeModifier"],function(a){if(a.__proxy)return a.__proxy;var b=new u(a);return a.__proxy=b,b}),g(u,"ShapeModifierProxy"),w.prototype={toJSON:function(){var a={};return a.localToParent=this._impl._localToParent.toJSON(),a.mesh=this._impl._mesh.toJSON(),a}},Object.defineProperty(w.prototype,"localToParent",{set:function(a){this._impl._localToParent=a},get:function(){return this._impl._localToParent},enumerable:!0}),Object.defineProperty(w.prototype,"mesh",{get:function(){return this._impl._mesh},enumerable:!0}),g(w,"Instance"),c.exports.Instance=w;var Fb="##key",Gb=function(){var a=1;return function(b){if(!b[Fb]){var c="##uniqueKey"+(a++).toString();Object.defineProperty(b,Fb,{writable:!1,enumerable:!1,configurable:!1,value:c})}return b[Fb]}}(),Hb=function(){this._data={}};Hb.prototype={_add:function(a){if("object"!=typeof a)return!1;var b=Gb(a);return this._data[b]?!1:(this._data[b]=a,!0)},_remove:function(a){if("object"!=typeof a)return!1;var b=a[Fb];return b&&this._data[b]?(delete this._data[b],!0):!1},_clear:function(){this._data={}},_size:function(){return Object.keys(this._data).length},_toArray:function(){var a=this._data,b=Object.keys(a),c=b.length,d,e=[];for(d=0;c>d;d++)e.push(a[b[d]]);return e}};var Ib=function(){Object.defineProperty(this,"_impl",{writable:!1,enumerable:!1,configurable:!1,value:new Hb}),this.itemAdded=new q("itemadded"),this.itemRemoved=new q("itemremoved")};Ib.prototype={add:function(a){return this._impl._add(a)&&this.itemAdded.fire(a),this},remove:function(a){return this._impl._remove(a)?(this.itemRemoved.fire(a),!0):!1},clear:function(){for(var a=this._impl._data,b=Object.keys(a),c=b.length,d=0;c>d;d++)this.remove(a[b[d]]);return this._impl._clear(),this},size:function(){return this._impl._size()},toArray:function(){return this._impl._toArray()}},c.exports.RefSet=Ib,g(Ib,"RefSet")};a.creativePlatformLibrary1vxKXGNaLtrrev0=c}("undefined"==typeof exports?window:exports);
//# sourceMappingURL=library.min.map

//
// This class has dependence to https://www.tinkercad.com/apiservlibs/library.min.js
//
var library = {
    exports: {}
};

creativePlatformLibrary1vxKXGNaLtrrev0(creativePlatformRuntime.environment, library);
window.CoreLibrary = library.exports;